


<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Metrics &mdash; Catalyst 21.12rc1 documentation</title>
  

  
  
  
  

  

  
  
    

  

  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <!-- <link rel="stylesheet" href="../_static/pygments.css" type="text/css" /> -->
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Runners" href="runners.html" />
    <link rel="prev" title="Loggers" href="loggers.html" /> 

  
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-167094275-1"></script>
  <script src="../_static/js/googleanalytics.min.js"></script>
  
  <script src="../_static/js/modernizr.min.js"></script>

  <!-- Preload the theme fonts -->

<link rel="preload" href="../_static/fonts/FreightSans/freight-sans-book.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="../_static/fonts/FreightSans/freight-sans-medium.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="../_static/fonts/IBMPlexMono/IBMPlexMono-Medium.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="../_static/fonts/FreightSans/freight-sans-bold.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="../_static/fonts/FreightSans/freight-sans-medium-italic.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="../_static/fonts/IBMPlexMono/IBMPlexMono-SemiBold.woff2" as="font" type="font/woff2" crossorigin="anonymous">

<!-- Preload the katex fonts -->

<link rel="preload" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/fonts/KaTeX_Math-Italic.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/fonts/KaTeX_Main-Regular.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/fonts/KaTeX_Main-Bold.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/fonts/KaTeX_Size1-Regular.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/fonts/KaTeX_Size4-Regular.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/fonts/KaTeX_Size2-Regular.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/fonts/KaTeX_Size3-Regular.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/fonts/KaTeX_Caligraphic-Regular.woff2" as="font" type="font/woff2" crossorigin="anonymous">
</head>

<div class="container-fluid header-holder tutorials-header" id="header-holder">
  <div class="container">
    <div class="header-container">
      <a class="header-logo" href="https://catalyst-team.com/" aria-label="Catalyst"></a>

      <div class="main-menu">
        <ul>

          <li>
            <a href="https://github.com/catalyst-team/catalyst">Catalyst</a>
          </li>
          <li>
            <a href="https://github.com/catalyst-team/codestyle">Codestyle</a>
          </li>
          <li>
            <a href="https://github.com/catalyst-team/dl-course">Course</a>
          </li>

        </ul>
      </div>

      <a class="main-menu-open-button" href="#" data-behavior="open-mobile-menu"></a>
    </div>

  </div>
</div>


<body class="catalyst-body">

   

    

    <div class="table-of-contents-link-wrapper">
      <span>Table of Contents</span>
      <a href="#" class="toggle-table-of-contents" data-behavior="toggle-table-of-contents"></a>
    </div>

    <nav data-toggle="wy-nav-shift" class="catalyst-left-menu" id="catalyst-left-menu">
      <div class="catalyst-side-scroll">
        <div class="catalyst-menu catalyst-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          <div class="catalyst-left-menu-search">
            

            
              
              
                <div class="version">
                  <a href="https://catalyst-team.github.io/catalyst/versions.html">21.12</a>
                </div>
              
            

            


  


<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search Docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

            
          </div>

          
            
            
              
            
            
              <p><span class="caption-text">Getting started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../index.html">Catalyst</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting_started/quickstart.html">Quickstart 101</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/catalyst-team/catalyst#minimal-examples">Minimal examples</a></li>
<li class="toctree-l1"><a class="reference external" href="https://medium.com/pytorch/catalyst-a-pytorch-framework-for-accelerated-deep-learning-r-d-ad9621e4ca88?source=friends_link&amp;sk=885b4409aecab505db0a63b06f19dcef">Catalyst — Accelerated Deep Learning R&amp;D</a></li>
</ul>
<p><span class="caption-text">Tutorials</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/ddp.html">Distributed training tutorial</a></li>
</ul>
<p><span class="caption-text">Core</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../core/callback.html">Callback</a></li>
<li class="toctree-l1"><a class="reference internal" href="../core/engine.html">Engine</a></li>
<li class="toctree-l1"><a class="reference internal" href="../core/logger.html">Logger</a></li>
<li class="toctree-l1"><a class="reference internal" href="../core/metric.html">Metric</a></li>
<li class="toctree-l1"><a class="reference internal" href="../core/runner.html">Runner</a></li>
</ul>
<p><span class="caption-text">FAQ</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../faq/intro.html">How to make X?</a></li>
<li class="toctree-l1"><a class="reference internal" href="../faq/architecture.html">Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../faq/checkpointing.html">Checkpointing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../faq/config_api.html">Config API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../faq/dataflow.html">Dataflow</a></li>
<li class="toctree-l1"><a class="reference internal" href="../faq/dp.html">Dataparallel training (cpu, single/multi-gpu)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../faq/debugging.html">Debugging</a></li>
<li class="toctree-l1"><a class="reference internal" href="../faq/ddp.html">Distributed training (multi-gpu, multi-node)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../faq/early_stopping.html">Early stopping</a></li>
<li class="toctree-l1"><a class="reference internal" href="../faq/engines.html">Engines</a></li>
<li class="toctree-l1"><a class="reference internal" href="../faq/inference.html">Inference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../faq/logging.html">Logging</a></li>
<li class="toctree-l1"><a class="reference internal" href="../faq/mixed_precision.html">Mixed precision training</a></li>
<li class="toctree-l1"><a class="reference internal" href="../faq/multi_components.html">Multiple components</a></li>
<li class="toctree-l1"><a class="reference internal" href="../faq/multi_keys.html">Multiple input and output keys</a></li>
<li class="toctree-l1"><a class="reference internal" href="../faq/multi_stage.html">Multistage runs (and finetuning)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../faq/optuna.html">Optuna integration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../faq/settings.html">Settings</a></li>
</ul>
<p><span class="caption-text">API</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="callbacks.html">Callbacks</a></li>
<li class="toctree-l1"><a class="reference internal" href="contrib.html">Contrib</a></li>
<li class="toctree-l1"><a class="reference internal" href="core.html">Core</a></li>
<li class="toctree-l1"><a class="reference internal" href="data.html">Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="engines.html">Engines</a></li>
<li class="toctree-l1"><a class="reference internal" href="loggers.html">Loggers</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Metrics</a></li>
<li class="toctree-l1"><a class="reference internal" href="runners.html">Runners</a></li>
<li class="toctree-l1"><a class="reference internal" href="utils.html">Utils</a></li>
</ul>
<p><span class="caption-text">Contribution guide</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://github.com/catalyst-team/catalyst/blob/master/CONTRIBUTING.md">How to start</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/catalyst-team/codestyle">Codestyle</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/catalyst-team/catalyst#acknowledgments">Acknowledgments</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <div class="catalyst-container">
      <div class="catalyst-page-level-bar" id="catalyst-page-level-bar">
        <div class="catalyst-breadcrumbs-wrapper">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="catalyst-breadcrumbs">
    
      <li>
        <a href="../index.html">
          
            Docs
          
        </a> &gt;
      </li>

        
      <li>Metrics</li>
    
    
      <li class="catalyst-breadcrumbs-aside">
        
            
            
              <a href="https://github.com/catalyst-team/catalyst/blob/master/docs/api/metrics.rst" class="fa fa-github"> Edit on GitHub</a>
            
          
        
      </li>
    
  </ul>

  
</div>
        </div>

        <div class="catalyst-shortcuts-wrapper" id="catalyst-shortcuts-wrapper">
          Shortcuts
        </div>
      </div>

      <section data-toggle="wy-nav-shift" id="catalyst-content-wrap" class="catalyst-content-wrap">
        <div class="catalyst-content-left">
          
          <div class="rst-content">
          
            <div role="main" class="main-content" itemscope="itemscope" itemtype="http://schema.org/Article">
             <article itemprop="articleBody" id="catalyst-article" class="catalyst-article">
              
  <section id="metrics">
<h1>Metrics<a class="headerlink" href="#metrics" title="Permalink to this headline">¶</a></h1>
<div class="toctree-wrapper compound">
</div>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><p><a class="reference internal" href="#metric-interfaces" id="id14">Metric Interfaces</a></p>
<ul>
<li><p><a class="reference internal" href="#imetric" id="id15">IMetric</a></p></li>
<li><p><a class="reference internal" href="#icallbackbatchmetric" id="id16">ICallbackBatchMetric</a></p></li>
<li><p><a class="reference internal" href="#icallbackloadermetric" id="id17">ICallbackLoaderMetric</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#metric-sub-interfaces" id="id18">Metric Sub-Interfaces</a></p>
<ul>
<li><p><a class="reference internal" href="#accumulativemetric" id="id19">AccumulativeMetric</a></p></li>
<li><p><a class="reference internal" href="#additivemetric" id="id20">AdditiveMetric</a></p></li>
<li><p><a class="reference internal" href="#functionalbatchmetric" id="id21">FunctionalBatchMetric</a></p></li>
<li><p><a class="reference internal" href="#functionalloadermetric" id="id22">FunctionalLoaderMetric</a></p></li>
<li><p><a class="reference internal" href="#regionbasedmetric" id="id23">RegionBasedMetric</a></p></li>
<li><p><a class="reference internal" href="#topkmetric" id="id24">TopKMetric</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#metric-api" id="id25">Metric API</a></p>
<ul>
<li><p><a class="reference internal" href="#accuracymetric" id="id26">AccuracyMetric</a></p></li>
<li><p><a class="reference internal" href="#aucmetric" id="id27">AUCMetric</a></p></li>
<li><p><a class="reference internal" href="#binaryprecisionrecallf1metric" id="id28">BinaryPrecisionRecallF1Metric</a></p></li>
<li><p><a class="reference internal" href="#confusionmatrixmetric" id="id29">ConfusionMatrixMetric</a></p></li>
<li><p><a class="reference internal" href="#cmcmetric" id="id30">CMCMetric</a></p></li>
<li><p><a class="reference internal" href="#dicemetric" id="id31">DiceMetric</a></p></li>
<li><p><a class="reference internal" href="#hitratemetric" id="id32">HitrateMetric</a></p></li>
<li><p><a class="reference internal" href="#ioumetric" id="id33">IOUMetric</a></p></li>
<li><p><a class="reference internal" href="#mapmetric" id="id34">MAPMetric</a></p></li>
<li><p><a class="reference internal" href="#multiclassprecisionrecallf1supportmetric" id="id35">MulticlassPrecisionRecallF1SupportMetric</a></p></li>
<li><p><a class="reference internal" href="#multilabelaccuracymetric" id="id36">MultilabelAccuracyMetric</a></p></li>
<li><p><a class="reference internal" href="#multilabelprecisionrecallf1supportmetric" id="id37">MultilabelPrecisionRecallF1SupportMetric</a></p></li>
<li><p><a class="reference internal" href="#mrrmetric" id="id38">MRRMetric</a></p></li>
<li><p><a class="reference internal" href="#ndcgmetric" id="id39">NDCGMetric</a></p></li>
<li><p><a class="reference internal" href="#r2squared" id="id40">R2Squared</a></p></li>
<li><p><a class="reference internal" href="#reidcmcmetric" id="id41">ReidCMCMetric</a></p></li>
<li><p><a class="reference internal" href="#trevskymetric" id="id42">TrevskyMetric</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#functional-api" id="id43">Functional API</a></p>
<ul>
<li><p><a class="reference internal" href="#module-catalyst.metrics.functional._accuracy" id="id44">Accuracy</a></p></li>
<li><p><a class="reference internal" href="#module-catalyst.metrics.functional._auc" id="id45">AUC</a></p></li>
<li><p><a class="reference internal" href="#module-catalyst.metrics.functional._average_precision" id="id46">Average Precision</a></p></li>
<li><p><a class="reference internal" href="#module-catalyst.metrics.functional._classification" id="id47">Classification</a></p></li>
<li><p><a class="reference internal" href="#module-catalyst.metrics.functional._cmc_score" id="id48">CMC Score</a></p></li>
<li><p><a class="reference internal" href="#module-catalyst.metrics.functional._f1_score" id="id49">F1 score</a></p></li>
<li><p><a class="reference internal" href="#module-catalyst.metrics.functional._focal" id="id50">Focal</a></p></li>
<li><p><a class="reference internal" href="#module-catalyst.metrics.functional._hitrate" id="id51">Hitrate</a></p></li>
<li><p><a class="reference internal" href="#module-catalyst.metrics.functional._mrr" id="id52">MRR</a></p></li>
<li><p><a class="reference internal" href="#module-catalyst.metrics.functional._ndcg" id="id53">NDCG</a></p></li>
<li><p><a class="reference internal" href="#module-catalyst.metrics.functional._precision" id="id54">Precision</a></p></li>
<li><p><a class="reference internal" href="#id13" id="id55">R2Squared</a></p></li>
<li><p><a class="reference internal" href="#module-catalyst.metrics.functional._recall" id="id56">Recall</a></p></li>
<li><p><a class="reference internal" href="#module-catalyst.metrics.functional._segmentation" id="id57">Segmentation</a></p></li>
<li><p><a class="reference internal" href="#module-catalyst.metrics.functional._misc" id="id58">Misc</a></p></li>
</ul>
</li>
</ul>
</div>
<span class="target" id="module-catalyst.metrics"></span><section id="metric-interfaces">
<h2><a class="toc-backref" href="#id14">Metric Interfaces</a><a class="headerlink" href="#metric-interfaces" title="Permalink to this headline">¶</a></h2>
<section id="imetric">
<h3><a class="toc-backref" href="#id15">IMetric</a><a class="headerlink" href="#imetric" title="Permalink to this headline">¶</a></h3>
<dl class="class">
<dt id="catalyst.metrics._metric.IMetric">
<em class="property">class </em><code class="sig-prename descclassname">catalyst.metrics._metric.</code><code class="sig-name descname">IMetric</code><span class="sig-paren">(</span><em class="sig-param">compute_on_call: bool = True</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/catalyst/metrics/_metric.html#IMetric"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#catalyst.metrics._metric.IMetric" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">abc.ABC</span></code></p>
<p>Interface for all Metrics.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>compute_on_call</strong> – Computes and returns metric value during metric call.
Used for per-batch logging.
default: <code class="docutils literal notranslate"><span class="pre">True</span></code></p>
</dd>
</dl>
<dl class="method">
<dt id="catalyst.metrics._metric.IMetric.compute">
<em class="property">abstract </em><code class="sig-name descname">compute</code><span class="sig-paren">(</span><span class="sig-paren">)</span> &#x2192; Any<a class="reference internal" href="../_modules/catalyst/metrics/_metric.html#IMetric.compute"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#catalyst.metrics._metric.IMetric.compute" title="Permalink to this definition">¶</a></dt>
<dd><p>Computes the metric based on it’s accumulated state.</p>
<p>By default, this is called at the end of each loader
(<cite>on_loader_end</cite> event).</p>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p>computed value, # noqa: DAR202
it’s better to return key-value</p>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p>Any</p>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="catalyst.metrics._metric.IMetric.reset">
<em class="property">abstract </em><code class="sig-name descname">reset</code><span class="sig-paren">(</span><span class="sig-paren">)</span> &#x2192; None<a class="reference internal" href="../_modules/catalyst/metrics/_metric.html#IMetric.reset"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#catalyst.metrics._metric.IMetric.reset" title="Permalink to this definition">¶</a></dt>
<dd><p>Resets the metric to it’s initial state.</p>
<p>By default, this is called at the start of each loader
(<cite>on_loader_start</cite> event).</p>
</dd></dl>

<dl class="method">
<dt id="catalyst.metrics._metric.IMetric.update">
<em class="property">abstract </em><code class="sig-name descname">update</code><span class="sig-paren">(</span><em class="sig-param">*args</em>, <em class="sig-param">**kwargs</em><span class="sig-paren">)</span> &#x2192; Any<a class="reference internal" href="../_modules/catalyst/metrics/_metric.html#IMetric.update"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#catalyst.metrics._metric.IMetric.update" title="Permalink to this definition">¶</a></dt>
<dd><p>Updates the metrics state using the passed data.</p>
<p>By default, this is called at the end of each batch
(<cite>on_batch_end</cite> event).</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>*args</strong> – some args :)</p></li>
<li><p><strong>**kwargs</strong> – some kwargs ;)</p></li>
</ul>
</dd>
</dl>
</dd></dl>

</dd></dl>

</section>
<section id="icallbackbatchmetric">
<h3><a class="toc-backref" href="#id16">ICallbackBatchMetric</a><a class="headerlink" href="#icallbackbatchmetric" title="Permalink to this headline">¶</a></h3>
<dl class="class">
<dt id="catalyst.metrics._metric.ICallbackBatchMetric">
<em class="property">class </em><code class="sig-prename descclassname">catalyst.metrics._metric.</code><code class="sig-name descname">ICallbackBatchMetric</code><span class="sig-paren">(</span><em class="sig-param">compute_on_call: bool = True</em>, <em class="sig-param">prefix: str = None</em>, <em class="sig-param">suffix: str = None</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/catalyst/metrics/_metric.html#ICallbackBatchMetric"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#catalyst.metrics._metric.ICallbackBatchMetric" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#catalyst.metrics._metric.IMetric" title="catalyst.metrics._metric.IMetric"><code class="xref py py-class docutils literal notranslate"><span class="pre">catalyst.metrics._metric.IMetric</span></code></a></p>
<p>Interface for all batch-based Metrics.</p>
<dl class="method">
<dt id="catalyst.metrics._metric.ICallbackBatchMetric.compute_key_value">
<em class="property">abstract </em><code class="sig-name descname">compute_key_value</code><span class="sig-paren">(</span><span class="sig-paren">)</span> &#x2192; Dict[str, float]<a class="reference internal" href="../_modules/catalyst/metrics/_metric.html#ICallbackBatchMetric.compute_key_value"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#catalyst.metrics._metric.ICallbackBatchMetric.compute_key_value" title="Permalink to this definition">¶</a></dt>
<dd><p>Computes the metric based on it’s accumulated state.</p>
<p>By default, this is called at the end of each loader
(<cite>on_loader_end</cite> event).</p>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p>computed value in key-value format.  # noqa: DAR202</p>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p>Dict</p>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="catalyst.metrics._metric.ICallbackBatchMetric.update_key_value">
<em class="property">abstract </em><code class="sig-name descname">update_key_value</code><span class="sig-paren">(</span><em class="sig-param">*args</em>, <em class="sig-param">**kwargs</em><span class="sig-paren">)</span> &#x2192; Dict[str, float]<a class="reference internal" href="../_modules/catalyst/metrics/_metric.html#ICallbackBatchMetric.update_key_value"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#catalyst.metrics._metric.ICallbackBatchMetric.update_key_value" title="Permalink to this definition">¶</a></dt>
<dd><p>Updates the metric based with new input.</p>
<p>By default, this is called at the end of each loader
(<cite>on_loader_end</cite> event).</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>*args</strong> – some args</p></li>
<li><p><strong>**kwargs</strong> – some kwargs</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>computed value in key-value format.  # noqa: DAR202</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>Dict</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

</section>
<section id="icallbackloadermetric">
<h3><a class="toc-backref" href="#id17">ICallbackLoaderMetric</a><a class="headerlink" href="#icallbackloadermetric" title="Permalink to this headline">¶</a></h3>
<dl class="class">
<dt id="catalyst.metrics._metric.ICallbackLoaderMetric">
<em class="property">class </em><code class="sig-prename descclassname">catalyst.metrics._metric.</code><code class="sig-name descname">ICallbackLoaderMetric</code><span class="sig-paren">(</span><em class="sig-param">compute_on_call: bool = True</em>, <em class="sig-param">prefix: str = None</em>, <em class="sig-param">suffix: str = None</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/catalyst/metrics/_metric.html#ICallbackLoaderMetric"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#catalyst.metrics._metric.ICallbackLoaderMetric" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#catalyst.metrics._metric.IMetric" title="catalyst.metrics._metric.IMetric"><code class="xref py py-class docutils literal notranslate"><span class="pre">catalyst.metrics._metric.IMetric</span></code></a></p>
<p>Interface for all loader-based Metrics.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>compute_on_call</strong> – Computes and returns metric value during metric call.
Used for per-batch logging.
default: <code class="docutils literal notranslate"><span class="pre">True</span></code></p></li>
<li><p><strong>prefix</strong> – metrics prefix</p></li>
<li><p><strong>suffix</strong> – metrics suffix</p></li>
</ul>
</dd>
</dl>
<dl class="method">
<dt id="catalyst.metrics._metric.ICallbackLoaderMetric.compute_key_value">
<em class="property">abstract </em><code class="sig-name descname">compute_key_value</code><span class="sig-paren">(</span><span class="sig-paren">)</span> &#x2192; Dict[str, float]<a class="reference internal" href="../_modules/catalyst/metrics/_metric.html#ICallbackLoaderMetric.compute_key_value"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#catalyst.metrics._metric.ICallbackLoaderMetric.compute_key_value" title="Permalink to this definition">¶</a></dt>
<dd><p>Computes the metric based on it’s accumulated state.</p>
<p>By default, this is called at the end of each loader
(<cite>on_loader_end</cite> event).</p>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p>computed value in key-value format.  # noqa: DAR202</p>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p>Dict</p>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="catalyst.metrics._metric.ICallbackLoaderMetric.reset">
<em class="property">abstract </em><code class="sig-name descname">reset</code><span class="sig-paren">(</span><em class="sig-param">num_batches: int</em>, <em class="sig-param">num_samples: int</em><span class="sig-paren">)</span> &#x2192; None<a class="reference internal" href="../_modules/catalyst/metrics/_metric.html#ICallbackLoaderMetric.reset"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#catalyst.metrics._metric.ICallbackLoaderMetric.reset" title="Permalink to this definition">¶</a></dt>
<dd><p>Resets the metric to it’s initial state.</p>
<p>By default, this is called at the start of each loader
(<cite>on_loader_start</cite> event).</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>num_batches</strong> – number of expected batches.</p></li>
<li><p><strong>num_samples</strong> – number of expected samples.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="catalyst.metrics._metric.ICallbackLoaderMetric.update">
<em class="property">abstract </em><code class="sig-name descname">update</code><span class="sig-paren">(</span><em class="sig-param">*args</em>, <em class="sig-param">**kwargs</em><span class="sig-paren">)</span> &#x2192; None<a class="reference internal" href="../_modules/catalyst/metrics/_metric.html#ICallbackLoaderMetric.update"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#catalyst.metrics._metric.ICallbackLoaderMetric.update" title="Permalink to this definition">¶</a></dt>
<dd><p>Updates the metrics state using the passed data.</p>
<p>By default, this is called at the end of each batch
(<cite>on_batch_end</cite> event).</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>*args</strong> – some args :)</p></li>
<li><p><strong>**kwargs</strong> – some kwargs ;)</p></li>
</ul>
</dd>
</dl>
</dd></dl>

</dd></dl>

</section>
</section>
<section id="metric-sub-interfaces">
<h2><a class="toc-backref" href="#id18">Metric Sub-Interfaces</a><a class="headerlink" href="#metric-sub-interfaces" title="Permalink to this headline">¶</a></h2>
<section id="accumulativemetric">
<h3><a class="toc-backref" href="#id19">AccumulativeMetric</a><a class="headerlink" href="#accumulativemetric" title="Permalink to this headline">¶</a></h3>
<dl class="class">
<dt id="catalyst.metrics._accumulative.AccumulativeMetric">
<em class="property">class </em><code class="sig-prename descclassname">catalyst.metrics._accumulative.</code><code class="sig-name descname">AccumulativeMetric</code><span class="sig-paren">(</span><em class="sig-param">keys: Iterable[str] = None</em>, <em class="sig-param">compute_on_call: bool = True</em>, <em class="sig-param">prefix: Optional[str] = None</em>, <em class="sig-param">suffix: Optional[str] = None</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/catalyst/metrics/_accumulative.html#AccumulativeMetric"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#catalyst.metrics._accumulative.AccumulativeMetric" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#catalyst.metrics._metric.ICallbackLoaderMetric" title="catalyst.metrics._metric.ICallbackLoaderMetric"><code class="xref py py-class docutils literal notranslate"><span class="pre">catalyst.metrics._metric.ICallbackLoaderMetric</span></code></a></p>
<p>This metric accumulates all the input data along loader</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>keys</strong> – list of keys to accumulate data from batch</p></li>
<li><p><strong>compute_on_call</strong> – if True, allows compute metric’s value on call</p></li>
<li><p><strong>prefix</strong> – metric prefix</p></li>
<li><p><strong>suffix</strong> – metric suffix</p></li>
</ul>
</dd>
</dl>
<dl class="method">
<dt id="catalyst.metrics._accumulative.AccumulativeMetric.compute">
<code class="sig-name descname">compute</code><span class="sig-paren">(</span><span class="sig-paren">)</span> &#x2192; Dict[str, torch.Tensor]<a class="reference internal" href="../_modules/catalyst/metrics/_accumulative.html#AccumulativeMetric.compute"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#catalyst.metrics._accumulative.AccumulativeMetric.compute" title="Permalink to this definition">¶</a></dt>
<dd><p>Return accumulated data</p>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p>dict of accumulated data</p>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="catalyst.metrics._accumulative.AccumulativeMetric.compute_key_value">
<code class="sig-name descname">compute_key_value</code><span class="sig-paren">(</span><span class="sig-paren">)</span> &#x2192; Dict[str, torch.Tensor]<a class="reference internal" href="../_modules/catalyst/metrics/_accumulative.html#AccumulativeMetric.compute_key_value"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#catalyst.metrics._accumulative.AccumulativeMetric.compute_key_value" title="Permalink to this definition">¶</a></dt>
<dd><p>Return accumulated data</p>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p>dict of accumulated data</p>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="catalyst.metrics._accumulative.AccumulativeMetric.reset">
<code class="sig-name descname">reset</code><span class="sig-paren">(</span><em class="sig-param">num_batches: int</em>, <em class="sig-param">num_samples: int</em><span class="sig-paren">)</span> &#x2192; None<a class="reference internal" href="../_modules/catalyst/metrics/_accumulative.html#AccumulativeMetric.reset"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#catalyst.metrics._accumulative.AccumulativeMetric.reset" title="Permalink to this definition">¶</a></dt>
<dd><p>Reset metrics fields</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>num_batches</strong> – expected number of batches</p></li>
<li><p><strong>num_samples</strong> – expected number of samples to accumulate</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="catalyst.metrics._accumulative.AccumulativeMetric.update">
<code class="sig-name descname">update</code><span class="sig-paren">(</span><em class="sig-param">**kwargs</em><span class="sig-paren">)</span> &#x2192; None<a class="reference internal" href="../_modules/catalyst/metrics/_accumulative.html#AccumulativeMetric.update"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#catalyst.metrics._accumulative.AccumulativeMetric.update" title="Permalink to this definition">¶</a></dt>
<dd><p>Update accumulated data with new batch</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>**kwargs</strong> – tensors that should be accumulates</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

</section>
<section id="additivemetric">
<h3><a class="toc-backref" href="#id20">AdditiveMetric</a><a class="headerlink" href="#additivemetric" title="Permalink to this headline">¶</a></h3>
<dl class="class">
<dt id="catalyst.metrics._additive.AdditiveMetric">
<em class="property">class </em><code class="sig-prename descclassname">catalyst.metrics._additive.</code><code class="sig-name descname">AdditiveMetric</code><span class="sig-paren">(</span><em class="sig-param">compute_on_call: bool = True</em>, <em class="sig-param">mode: str = 'numpy'</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/catalyst/metrics/_additive.html#AdditiveMetric"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#catalyst.metrics._additive.AdditiveMetric" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#catalyst.metrics._metric.IMetric" title="catalyst.metrics._metric.IMetric"><code class="xref py py-class docutils literal notranslate"><span class="pre">catalyst.metrics._metric.IMetric</span></code></a></p>
<p>This metric computes mean and std values of input data.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>compute_on_call</strong> – if True, computes and returns metric value during metric call</p></li>
<li><p><strong>mode</strong> – expected dtype returned by the metric, <code class="docutils literal notranslate"><span class="pre">&quot;numpy&quot;</span></code> or <code class="docutils literal notranslate"><span class="pre">&quot;torch&quot;</span></code></p></li>
</ul>
</dd>
<dt class="field-even">Raises</dt>
<dd class="field-even"><p><strong>ValueError</strong> – if mode is not supported</p>
</dd>
</dl>
<p>Examples:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">catalyst</span> <span class="kn">import</span> <span class="n">metrics</span>

<span class="n">values</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">]</span>
<span class="n">num_samples_list</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">]</span>
<span class="n">true_values</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mf">1.666667</span><span class="p">,</span> <span class="mf">2.333333</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mf">3.666667</span><span class="p">]</span>

<span class="n">metric</span> <span class="o">=</span> <span class="n">metrics</span><span class="o">.</span><span class="n">AdditiveMetric</span><span class="p">()</span>
<span class="k">for</span> <span class="n">value</span><span class="p">,</span> <span class="n">num_samples</span><span class="p">,</span> <span class="n">true_value</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="n">num_samples_list</span><span class="p">,</span> <span class="n">true_values</span><span class="p">):</span>
    <span class="n">metric</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="n">value</span><span class="p">,</span> <span class="n">num_samples</span><span class="o">=</span><span class="n">num_samples</span><span class="p">)</span>
    <span class="n">mean</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">metric</span><span class="o">.</span><span class="n">compute</span><span class="p">()</span>
    <span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">mean</span><span class="p">,</span> <span class="n">true_value</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">torch</span> <span class="kn">import</span> <span class="n">nn</span><span class="p">,</span> <span class="n">optim</span>
<span class="kn">from</span> <span class="nn">torch.nn</span> <span class="kn">import</span> <span class="n">functional</span> <span class="k">as</span> <span class="n">F</span>
<span class="kn">from</span> <span class="nn">torch.utils.data</span> <span class="kn">import</span> <span class="n">DataLoader</span>
<span class="kn">from</span> <span class="nn">catalyst</span> <span class="kn">import</span> <span class="n">dl</span><span class="p">,</span> <span class="n">metrics</span>
<span class="kn">from</span> <span class="nn">catalyst.data</span> <span class="kn">import</span> <span class="n">ToTensor</span>
<span class="kn">from</span> <span class="nn">catalyst.contrib.datasets</span> <span class="kn">import</span> <span class="n">MNIST</span>

<span class="n">model</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Sequential</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Flatten</span><span class="p">(),</span> <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="mi">28</span> <span class="o">*</span> <span class="mi">28</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
<span class="n">optimizer</span> <span class="o">=</span> <span class="n">optim</span><span class="o">.</span><span class="n">Adam</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="p">(),</span> <span class="n">lr</span><span class="o">=</span><span class="mf">0.02</span><span class="p">)</span>

<span class="n">loaders</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;train&quot;</span><span class="p">:</span> <span class="n">DataLoader</span><span class="p">(</span>
        <span class="n">MNIST</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">(),</span> <span class="n">train</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">download</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">ToTensor</span><span class="p">()),</span>
        <span class="n">batch_size</span><span class="o">=</span><span class="mi">32</span>
    <span class="p">),</span>
    <span class="s2">&quot;valid&quot;</span><span class="p">:</span> <span class="n">DataLoader</span><span class="p">(</span>
        <span class="n">MNIST</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">(),</span> <span class="n">train</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span>
        <span class="n">batch_size</span><span class="o">=</span><span class="mi">32</span>
    <span class="p">),</span>
<span class="p">}</span>

<span class="k">class</span> <span class="nc">CustomRunner</span><span class="p">(</span><span class="n">dl</span><span class="o">.</span><span class="n">Runner</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">predict_batch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">batch</span><span class="p">):</span>
        <span class="c1"># model inference step</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">(</span><span class="n">batch</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">on_loader_start</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">runner</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">on_loader_start</span><span class="p">(</span><span class="n">runner</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">meters</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">key</span><span class="p">:</span> <span class="n">metrics</span><span class="o">.</span><span class="n">AdditiveMetric</span><span class="p">(</span><span class="n">compute_on_call</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;loss&quot;</span><span class="p">,</span> <span class="s2">&quot;accuracy01&quot;</span><span class="p">,</span> <span class="s2">&quot;accuracy03&quot;</span><span class="p">]</span>
        <span class="p">}</span>

    <span class="k">def</span> <span class="nf">handle_batch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">batch</span><span class="p">):</span>
        <span class="c1"># model train/valid step</span>
        <span class="c1"># unpack the batch</span>
        <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">batch</span>
        <span class="c1"># run model forward pass</span>
        <span class="n">logits</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="c1"># compute the loss</span>
        <span class="n">loss</span> <span class="o">=</span> <span class="n">F</span><span class="o">.</span><span class="n">cross_entropy</span><span class="p">(</span><span class="n">logits</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
        <span class="c1"># compute other metrics of interest</span>
        <span class="n">accuracy01</span><span class="p">,</span> <span class="n">accuracy03</span> <span class="o">=</span> <span class="n">metrics</span><span class="o">.</span><span class="n">accuracy</span><span class="p">(</span><span class="n">logits</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">topk</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
        <span class="c1"># log metrics</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">batch_metrics</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
            <span class="p">{</span><span class="s2">&quot;loss&quot;</span><span class="p">:</span> <span class="n">loss</span><span class="p">,</span> <span class="s2">&quot;accuracy01&quot;</span><span class="p">:</span> <span class="n">accuracy01</span><span class="p">,</span> <span class="s2">&quot;accuracy03&quot;</span><span class="p">:</span> <span class="n">accuracy03</span><span class="p">}</span>
        <span class="p">)</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;loss&quot;</span><span class="p">,</span> <span class="s2">&quot;accuracy01&quot;</span><span class="p">,</span> <span class="s2">&quot;accuracy03&quot;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">meters</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">batch_metrics</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">item</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">batch_size</span><span class="p">)</span>
        <span class="c1"># run model backward pass</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_train_loader</span><span class="p">:</span>
            <span class="n">loss</span><span class="o">.</span><span class="n">backward</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">optimizer</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">optimizer</span><span class="o">.</span><span class="n">zero_grad</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">on_loader_end</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">runner</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;loss&quot;</span><span class="p">,</span> <span class="s2">&quot;accuracy01&quot;</span><span class="p">,</span> <span class="s2">&quot;accuracy03&quot;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">loader_metrics</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">meters</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">compute</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">on_loader_end</span><span class="p">(</span><span class="n">runner</span><span class="p">)</span>

<span class="n">runner</span> <span class="o">=</span> <span class="n">CustomRunner</span><span class="p">()</span>
<span class="c1"># model training</span>
<span class="n">runner</span><span class="o">.</span><span class="n">train</span><span class="p">(</span>
    <span class="n">model</span><span class="o">=</span><span class="n">model</span><span class="p">,</span>
    <span class="n">optimizer</span><span class="o">=</span><span class="n">optimizer</span><span class="p">,</span>
    <span class="n">loaders</span><span class="o">=</span><span class="n">loaders</span><span class="p">,</span>
    <span class="n">logdir</span><span class="o">=</span><span class="s2">&quot;./logs&quot;</span><span class="p">,</span>
    <span class="n">num_epochs</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
    <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">valid_loader</span><span class="o">=</span><span class="s2">&quot;valid&quot;</span><span class="p">,</span>
    <span class="n">valid_metric</span><span class="o">=</span><span class="s2">&quot;loss&quot;</span><span class="p">,</span>
    <span class="n">minimize_valid_metric</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Please follow the <a class="reference external" href="https://github.com/catalyst-team/catalyst#minimal-examples">minimal examples</a> sections for more use cases.</p>
</div>
<dl class="method">
<dt id="catalyst.metrics._additive.AdditiveMetric.compute">
<code class="sig-name descname">compute</code><span class="sig-paren">(</span><span class="sig-paren">)</span> &#x2192; Tuple[float, float]<a class="reference internal" href="../_modules/catalyst/metrics/_additive.html#AdditiveMetric.compute"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#catalyst.metrics._additive.AdditiveMetric.compute" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns mean and std values of all the input data</p>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p>tuple of mean and std values</p>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="catalyst.metrics._additive.AdditiveMetric.reset">
<code class="sig-name descname">reset</code><span class="sig-paren">(</span><span class="sig-paren">)</span> &#x2192; None<a class="reference internal" href="../_modules/catalyst/metrics/_additive.html#AdditiveMetric.reset"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#catalyst.metrics._additive.AdditiveMetric.reset" title="Permalink to this definition">¶</a></dt>
<dd><p>Reset all fields</p>
</dd></dl>

<dl class="method">
<dt id="catalyst.metrics._additive.AdditiveMetric.update">
<code class="sig-name descname">update</code><span class="sig-paren">(</span><em class="sig-param">value: float</em>, <em class="sig-param">num_samples: int</em><span class="sig-paren">)</span> &#x2192; float<a class="reference internal" href="../_modules/catalyst/metrics/_additive.html#AdditiveMetric.update"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#catalyst.metrics._additive.AdditiveMetric.update" title="Permalink to this definition">¶</a></dt>
<dd><p>Update mean metric value and std with new value.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>value</strong> – value to update mean and std with</p></li>
<li><p><strong>num_samples</strong> – number of value samples that metrics should be updated with</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>last value</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

</section>
<section id="functionalbatchmetric">
<h3><a class="toc-backref" href="#id21">FunctionalBatchMetric</a><a class="headerlink" href="#functionalbatchmetric" title="Permalink to this headline">¶</a></h3>
<dl class="class">
<dt id="catalyst.metrics._functional_metric.FunctionalBatchMetric">
<em class="property">class </em><code class="sig-prename descclassname">catalyst.metrics._functional_metric.</code><code class="sig-name descname">FunctionalBatchMetric</code><span class="sig-paren">(</span><em class="sig-param">metric_fn: Callable</em>, <em class="sig-param">metric_key: str</em>, <em class="sig-param">compute_on_call: bool = True</em>, <em class="sig-param">prefix: str = None</em>, <em class="sig-param">suffix: str = None</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/catalyst/metrics/_functional_metric.html#FunctionalBatchMetric"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#catalyst.metrics._functional_metric.FunctionalBatchMetric" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#catalyst.metrics._metric.ICallbackBatchMetric" title="catalyst.metrics._metric.ICallbackBatchMetric"><code class="xref py py-class docutils literal notranslate"><span class="pre">catalyst.metrics._metric.ICallbackBatchMetric</span></code></a></p>
<p>Class for custom <strong>batch-based</strong> metrics in a functional way.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>metric_fn</strong> – metric function, that get outputs, targets and return score as torch.Tensor</p></li>
<li><p><strong>metric_key</strong> – metric name</p></li>
<li><p><strong>compute_on_call</strong> – Computes and returns metric value during metric call.
Used for per-batch logging. default: True</p></li>
<li><p><strong>prefix</strong> – metric prefix</p></li>
<li><p><strong>suffix</strong> – metric suffix</p></li>
</ul>
</dd>
</dl>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Loader metrics calculated as average over all batch metrics.</p>
</div>
<p>Examples:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">torch</span>
<span class="kn">from</span> <span class="nn">catalyst</span> <span class="kn">import</span> <span class="n">metrics</span>
<span class="kn">import</span> <span class="nn">sklearn.metrics</span>

<span class="n">outputs</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
<span class="n">targets</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([</span><span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>

<span class="n">metric</span> <span class="o">=</span> <span class="n">metrics</span><span class="o">.</span><span class="n">FunctionalBatchMetric</span><span class="p">(</span>
    <span class="n">metric_fn</span><span class="o">=</span><span class="n">sklearn</span><span class="o">.</span><span class="n">metrics</span><span class="o">.</span><span class="n">accuracy_score</span><span class="p">,</span>
    <span class="n">metric_key</span><span class="o">=</span><span class="s2">&quot;sk_accuracy&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">metric</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>

<span class="n">metric</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">batch_size</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">outputs</span><span class="p">),</span> <span class="n">y_pred</span><span class="o">=</span><span class="n">outputs</span><span class="p">,</span> <span class="n">y_true</span><span class="o">=</span><span class="n">targets</span><span class="p">)</span>
<span class="n">metric</span><span class="o">.</span><span class="n">compute</span><span class="p">()</span>
<span class="c1"># (0.5, 0.0)  # mean, std</span>

<span class="n">metric</span><span class="o">.</span><span class="n">compute_key_value</span><span class="p">()</span>
<span class="c1"># {&#39;sk_accuracy&#39;: 0.5, &#39;sk_accuracy/mean&#39;: 0.5, &#39;sk_accuracy/std&#39;: 0.0}</span>
</pre></div>
</div>
</dd></dl>

</section>
<section id="functionalloadermetric">
<h3><a class="toc-backref" href="#id22">FunctionalLoaderMetric</a><a class="headerlink" href="#functionalloadermetric" title="Permalink to this headline">¶</a></h3>
<dl class="class">
<dt id="catalyst.metrics._functional_metric.FunctionalLoaderMetric">
<em class="property">class </em><code class="sig-prename descclassname">catalyst.metrics._functional_metric.</code><code class="sig-name descname">FunctionalLoaderMetric</code><span class="sig-paren">(</span><em class="sig-param">metric_fn: Callable</em>, <em class="sig-param">metric_key: str</em>, <em class="sig-param">accumulative_fields: Iterable[str] = None</em>, <em class="sig-param">compute_on_call: bool = True</em>, <em class="sig-param">prefix: str = None</em>, <em class="sig-param">suffix: str = None</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/catalyst/metrics/_functional_metric.html#FunctionalLoaderMetric"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#catalyst.metrics._functional_metric.FunctionalLoaderMetric" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#catalyst.metrics._metric.ICallbackLoaderMetric" title="catalyst.metrics._metric.ICallbackLoaderMetric"><code class="xref py py-class docutils literal notranslate"><span class="pre">catalyst.metrics._metric.ICallbackLoaderMetric</span></code></a></p>
<p>Class for custom <strong>loader-based</strong> metrics in a functional way.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>metric_fn</strong> – metric function, that get outputs, targets and return score as torch.Tensor</p></li>
<li><p><strong>metric_key</strong> – metric name</p></li>
<li><p><strong>accumulative_fields</strong> – list of keys to accumulate data from batch</p></li>
<li><p><strong>compute_on_call</strong> – if True, allows compute metric’s value on call</p></li>
<li><p><strong>prefix</strong> – metric prefix</p></li>
<li><p><strong>suffix</strong> – metric suffix</p></li>
</ul>
</dd>
</dl>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Metrics are calculated over all samples.</p>
</div>
<p>Examples:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">partial</span>
<span class="kn">import</span> <span class="nn">torch</span>
<span class="kn">from</span> <span class="nn">catalyst</span> <span class="kn">import</span> <span class="n">metrics</span>
<span class="kn">import</span> <span class="nn">sklearn.metrics</span>

<span class="n">targets</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([</span><span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
<span class="n">outputs</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">rand</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">targets</span><span class="p">),</span> <span class="n">targets</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">softmax</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

<span class="n">metric</span> <span class="o">=</span> <span class="n">metrics</span><span class="o">.</span><span class="n">FunctionalLoaderMetric</span><span class="p">(</span>
    <span class="n">metric_fn</span><span class="o">=</span><span class="n">partial</span><span class="p">(</span>
        <span class="n">sklearn</span><span class="o">.</span><span class="n">metrics</span><span class="o">.</span><span class="n">roc_auc_score</span><span class="p">,</span> <span class="n">average</span><span class="o">=</span><span class="s2">&quot;macro&quot;</span><span class="p">,</span> <span class="n">multi_class</span><span class="o">=</span><span class="s2">&quot;ovr&quot;</span>
    <span class="p">),</span>
    <span class="n">metric_key</span><span class="o">=</span><span class="s2">&quot;sk_auc&quot;</span><span class="p">,</span>
    <span class="n">accumulative_fields</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;y_score&#39;</span><span class="p">,</span><span class="s1">&#39;y_true&#39;</span><span class="p">],</span>

<span class="p">)</span>
<span class="n">metric</span><span class="o">.</span><span class="n">reset</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">outputs</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">outputs</span><span class="p">))</span>

<span class="n">metric</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">y_score</span><span class="o">=</span><span class="n">outputs</span><span class="p">,</span> <span class="n">y_true</span><span class="o">=</span><span class="n">targets</span><span class="p">)</span>
<span class="n">metric</span><span class="o">.</span><span class="n">compute</span><span class="p">()</span>
<span class="c1"># ...</span>

<span class="n">metric</span><span class="o">.</span><span class="n">compute_key_value</span><span class="p">()</span>
<span class="c1"># {&#39;sk_auc&#39;: ...}</span>
</pre></div>
</div>
</dd></dl>

</section>
<section id="regionbasedmetric">
<h3><a class="toc-backref" href="#id23">RegionBasedMetric</a><a class="headerlink" href="#regionbasedmetric" title="Permalink to this headline">¶</a></h3>
<dl class="class">
<dt id="catalyst.metrics._segmentation.RegionBasedMetric">
<em class="property">class </em><code class="sig-prename descclassname">catalyst.metrics._segmentation.</code><code class="sig-name descname">RegionBasedMetric</code><span class="sig-paren">(</span><em class="sig-param">metric_fn: Callable</em>, <em class="sig-param">metric_name: str</em>, <em class="sig-param">class_dim: int = 1</em>, <em class="sig-param">weights: Optional[List[float]] = None</em>, <em class="sig-param">class_names: Optional[List[str]] = None</em>, <em class="sig-param">threshold: Optional[float] = 0.5</em>, <em class="sig-param">compute_on_call: bool = True</em>, <em class="sig-param">compute_per_class_metrics: bool = False</em>, <em class="sig-param">prefix: Optional[str] = None</em>, <em class="sig-param">suffix: Optional[str] = None</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/catalyst/metrics/_segmentation.html#RegionBasedMetric"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#catalyst.metrics._segmentation.RegionBasedMetric" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#catalyst.metrics._metric.ICallbackBatchMetric" title="catalyst.metrics._metric.ICallbackBatchMetric"><code class="xref py py-class docutils literal notranslate"><span class="pre">catalyst.metrics._metric.ICallbackBatchMetric</span></code></a></p>
<p>Logic class for all region based metrics, like IoU, Dice, Trevsky.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>metric_fn</strong> – metric function, that get statistics and return score</p></li>
<li><p><strong>metric_name</strong> – name of the metric</p></li>
<li><p><strong>class_dim</strong> – indicates class dimension (K) for <code class="docutils literal notranslate"><span class="pre">outputs</span></code> and
<code class="docutils literal notranslate"><span class="pre">targets</span></code> tensors (default = 1)</p></li>
<li><p><strong>weights</strong> – class weights</p></li>
<li><p><strong>class_names</strong> – class names</p></li>
<li><p><strong>threshold</strong> – threshold for outputs binarization</p></li>
<li><p><strong>compute_on_call</strong> – Computes and returns metric value during metric call.
Used for per-batch logging. default: True</p></li>
<li><p><strong>compute_per_class_metrics</strong> – boolean flag to compute per-class metrics
(default: SETTINGS.compute_per_class_metrics or False).</p></li>
<li><p><strong>prefix</strong> – metric prefix</p></li>
<li><p><strong>suffix</strong> – metric suffix</p></li>
</ul>
</dd>
</dl>
<p>Interface, please check out implementations for more details:</p>
<blockquote>
<div><ul class="simple">
<li><p><a class="reference internal" href="#catalyst.metrics._segmentation.IOUMetric" title="catalyst.metrics._segmentation.IOUMetric"><code class="xref py py-mod docutils literal notranslate"><span class="pre">catalyst.metrics._segmentation.IOUMetric</span></code></a></p></li>
<li><p><a class="reference internal" href="#catalyst.metrics._segmentation.DiceMetric" title="catalyst.metrics._segmentation.DiceMetric"><code class="xref py py-mod docutils literal notranslate"><span class="pre">catalyst.metrics._segmentation.DiceMetric</span></code></a></p></li>
<li><p><a class="reference internal" href="#catalyst.metrics._segmentation.TrevskyMetric" title="catalyst.metrics._segmentation.TrevskyMetric"><code class="xref py py-mod docutils literal notranslate"><span class="pre">catalyst.metrics._segmentation.TrevskyMetric</span></code></a></p></li>
</ul>
</div></blockquote>
</dd></dl>

</section>
<section id="topkmetric">
<h3><a class="toc-backref" href="#id24">TopKMetric</a><a class="headerlink" href="#topkmetric" title="Permalink to this headline">¶</a></h3>
<dl class="class">
<dt id="catalyst.metrics._topk_metric.TopKMetric">
<em class="property">class </em><code class="sig-prename descclassname">catalyst.metrics._topk_metric.</code><code class="sig-name descname">TopKMetric</code><span class="sig-paren">(</span><em class="sig-param">metric_name: str</em>, <em class="sig-param">metric_function: Callable</em>, <em class="sig-param">topk_args: Iterable[int] = None</em>, <em class="sig-param">compute_on_call: bool = True</em>, <em class="sig-param">prefix: str = None</em>, <em class="sig-param">suffix: str = None</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/catalyst/metrics/_topk_metric.html#TopKMetric"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#catalyst.metrics._topk_metric.TopKMetric" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#catalyst.metrics._metric.ICallbackBatchMetric" title="catalyst.metrics._metric.ICallbackBatchMetric"><code class="xref py py-class docutils literal notranslate"><span class="pre">catalyst.metrics._metric.ICallbackBatchMetric</span></code></a></p>
<p>Base class for <cite>topk</cite> metrics.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>metric_name</strong> – name of the metric</p></li>
<li><p><strong>metric_function</strong> – metric calculation function</p></li>
<li><p><strong>topk_args</strong> – list of <cite>topk</cite> for <a class="reference external" href="mailto:metric&#37;&#52;&#48;topk">metric<span>&#64;</span>topk</a> computing</p></li>
<li><p><strong>compute_on_call</strong> – if True, computes and returns metric value during metric call</p></li>
<li><p><strong>prefix</strong> – metric prefix</p></li>
<li><p><strong>suffix</strong> – metric suffix</p></li>
</ul>
</dd>
</dl>
</dd></dl>

</section>
</section>
<section id="metric-api">
<h2><a class="toc-backref" href="#id25">Metric API</a><a class="headerlink" href="#metric-api" title="Permalink to this headline">¶</a></h2>
<section id="accuracymetric">
<h3><a class="toc-backref" href="#id26">AccuracyMetric</a><a class="headerlink" href="#accuracymetric" title="Permalink to this headline">¶</a></h3>
<dl class="class">
<dt id="catalyst.metrics._accuracy.AccuracyMetric">
<em class="property">class </em><code class="sig-prename descclassname">catalyst.metrics._accuracy.</code><code class="sig-name descname">AccuracyMetric</code><span class="sig-paren">(</span><em class="sig-param">topk_args: Iterable[int] = None</em>, <em class="sig-param">num_classes: int = None</em>, <em class="sig-param">compute_on_call: bool = True</em>, <em class="sig-param">prefix: str = None</em>, <em class="sig-param">suffix: str = None</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/catalyst/metrics/_accuracy.html#AccuracyMetric"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#catalyst.metrics._accuracy.AccuracyMetric" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#catalyst.metrics._topk_metric.TopKMetric" title="catalyst.metrics._topk_metric.TopKMetric"><code class="xref py py-class docutils literal notranslate"><span class="pre">catalyst.metrics._topk_metric.TopKMetric</span></code></a></p>
<p>This metric computes accuracy for multiclass classification case.
It computes mean value of accuracy and it’s approximate std value
(note that it’s not a real accuracy std but std of accuracy over batch mean values).</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>topk_args</strong> – list of <cite>topk</cite> for <a class="reference external" href="mailto:accuracy&#37;&#52;&#48;topk">accuracy<span>&#64;</span>topk</a> computing</p></li>
<li><p><strong>num_classes</strong> – number of classes</p></li>
<li><p><strong>compute_on_call</strong> – if True, computes and returns metric value during metric call</p></li>
<li><p><strong>prefix</strong> – metric prefix</p></li>
<li><p><strong>suffix</strong> – metric suffix</p></li>
</ul>
</dd>
</dl>
<p>Examples:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">torch</span>
<span class="kn">from</span> <span class="nn">catalyst</span> <span class="kn">import</span> <span class="n">metrics</span>

<span class="n">outputs</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([</span>
    <span class="p">[</span><span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">],</span>
    <span class="p">[</span><span class="mf">0.9</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">],</span>
    <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">],</span>
    <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">],</span>
<span class="p">])</span>
<span class="n">targets</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([</span><span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
<span class="n">metric</span> <span class="o">=</span> <span class="n">metrics</span><span class="o">.</span><span class="n">AccuracyMetric</span><span class="p">(</span><span class="n">topk_args</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>

<span class="n">metric</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
<span class="n">metric</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">outputs</span><span class="p">,</span> <span class="n">targets</span><span class="p">)</span>
<span class="n">metric</span><span class="o">.</span><span class="n">compute</span><span class="p">()</span>
<span class="c1"># (</span>
<span class="c1">#     (0.5, 1.0),  # top1, top3 mean</span>
<span class="c1">#     (0.0, 0.0),  # top1, top3 std</span>
<span class="c1"># )</span>

<span class="n">metric</span><span class="o">.</span><span class="n">compute_key_value</span><span class="p">()</span>
<span class="c1"># {</span>
<span class="c1">#     &#39;accuracy01&#39;: 0.5,</span>
<span class="c1">#     &#39;accuracy01/std&#39;: 0.0,</span>
<span class="c1">#     &#39;accuracy03&#39;: 1.0,</span>
<span class="c1">#     &#39;accuracy03/std&#39;: 0.0,</span>
<span class="c1"># }</span>

<span class="n">metric</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
<span class="n">metric</span><span class="p">(</span><span class="n">outputs</span><span class="p">,</span> <span class="n">targets</span><span class="p">)</span>
<span class="c1"># (</span>
<span class="c1">#     (0.5, 1.0),  # top1, top3 mean</span>
<span class="c1">#     (0.0, 0.0),  # top1, top3 std</span>
<span class="c1"># )</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">torch</span>
<span class="kn">from</span> <span class="nn">torch.utils.data</span> <span class="kn">import</span> <span class="n">DataLoader</span><span class="p">,</span> <span class="n">TensorDataset</span>
<span class="kn">from</span> <span class="nn">catalyst</span> <span class="kn">import</span> <span class="n">dl</span>

<span class="c1"># sample data</span>
<span class="n">num_samples</span><span class="p">,</span> <span class="n">num_features</span><span class="p">,</span> <span class="n">num_classes</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mf">1e4</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="mf">1e1</span><span class="p">),</span> <span class="mi">4</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="n">num_samples</span><span class="p">,</span> <span class="n">num_features</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="n">num_samples</span><span class="p">,)</span> <span class="o">*</span> <span class="n">num_classes</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">int64</span><span class="p">)</span>

<span class="c1"># pytorch loaders</span>
<span class="n">dataset</span> <span class="o">=</span> <span class="n">TensorDataset</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
<span class="n">loader</span> <span class="o">=</span> <span class="n">DataLoader</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="mi">32</span><span class="p">,</span> <span class="n">num_workers</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">loaders</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;train&quot;</span><span class="p">:</span> <span class="n">loader</span><span class="p">,</span> <span class="s2">&quot;valid&quot;</span><span class="p">:</span> <span class="n">loader</span><span class="p">}</span>

<span class="c1"># model, criterion, optimizer, scheduler</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="n">num_features</span><span class="p">,</span> <span class="n">num_classes</span><span class="p">)</span>
<span class="n">criterion</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">CrossEntropyLoss</span><span class="p">()</span>
<span class="n">optimizer</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">optim</span><span class="o">.</span><span class="n">Adam</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="p">())</span>
<span class="n">scheduler</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">optim</span><span class="o">.</span><span class="n">lr_scheduler</span><span class="o">.</span><span class="n">MultiStepLR</span><span class="p">(</span><span class="n">optimizer</span><span class="p">,</span> <span class="p">[</span><span class="mi">2</span><span class="p">])</span>

<span class="c1"># model training</span>
<span class="n">runner</span> <span class="o">=</span> <span class="n">dl</span><span class="o">.</span><span class="n">SupervisedRunner</span><span class="p">(</span>
    <span class="n">input_key</span><span class="o">=</span><span class="s2">&quot;features&quot;</span><span class="p">,</span> <span class="n">output_key</span><span class="o">=</span><span class="s2">&quot;logits&quot;</span><span class="p">,</span> <span class="n">target_key</span><span class="o">=</span><span class="s2">&quot;targets&quot;</span><span class="p">,</span> <span class="n">loss_key</span><span class="o">=</span><span class="s2">&quot;loss&quot;</span>
<span class="p">)</span>
<span class="n">runner</span><span class="o">.</span><span class="n">train</span><span class="p">(</span>
    <span class="n">model</span><span class="o">=</span><span class="n">model</span><span class="p">,</span>
    <span class="n">criterion</span><span class="o">=</span><span class="n">criterion</span><span class="p">,</span>
    <span class="n">optimizer</span><span class="o">=</span><span class="n">optimizer</span><span class="p">,</span>
    <span class="n">scheduler</span><span class="o">=</span><span class="n">scheduler</span><span class="p">,</span>
    <span class="n">loaders</span><span class="o">=</span><span class="n">loaders</span><span class="p">,</span>
    <span class="n">logdir</span><span class="o">=</span><span class="s2">&quot;./logdir&quot;</span><span class="p">,</span>
    <span class="n">num_epochs</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
    <span class="n">valid_loader</span><span class="o">=</span><span class="s2">&quot;valid&quot;</span><span class="p">,</span>
    <span class="n">valid_metric</span><span class="o">=</span><span class="s2">&quot;accuracy03&quot;</span><span class="p">,</span>
    <span class="n">minimize_valid_metric</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">callbacks</span><span class="o">=</span><span class="p">[</span>
        <span class="n">dl</span><span class="o">.</span><span class="n">AccuracyCallback</span><span class="p">(</span>
            <span class="n">input_key</span><span class="o">=</span><span class="s2">&quot;logits&quot;</span><span class="p">,</span> <span class="n">target_key</span><span class="o">=</span><span class="s2">&quot;targets&quot;</span><span class="p">,</span> <span class="n">num_classes</span><span class="o">=</span><span class="n">num_classes</span>
        <span class="p">),</span>
        <span class="n">dl</span><span class="o">.</span><span class="n">PrecisionRecallF1SupportCallback</span><span class="p">(</span>
            <span class="n">input_key</span><span class="o">=</span><span class="s2">&quot;logits&quot;</span><span class="p">,</span> <span class="n">target_key</span><span class="o">=</span><span class="s2">&quot;targets&quot;</span><span class="p">,</span> <span class="n">num_classes</span><span class="o">=</span><span class="n">num_classes</span>
        <span class="p">),</span>
        <span class="n">dl</span><span class="o">.</span><span class="n">AUCCallback</span><span class="p">(</span><span class="n">input_key</span><span class="o">=</span><span class="s2">&quot;logits&quot;</span><span class="p">,</span> <span class="n">target_key</span><span class="o">=</span><span class="s2">&quot;targets&quot;</span><span class="p">),</span>
    <span class="p">],</span>
<span class="p">)</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Metric names depending on input parameters:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">topk_args</span> <span class="pre">=</span> <span class="pre">None</span></code> —&gt; see             <a class="reference internal" href="#catalyst.metrics.functional._misc.get_default_topk_args" title="catalyst.metrics.functional._misc.get_default_topk_args"><code class="xref py py-mod docutils literal notranslate"><span class="pre">catalyst.metrics.functional._misc.get_default_topk_args</span></code></a></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">topk_args</span> <span class="pre">=</span> <span class="pre">(1,)</span></code> —&gt; <code class="docutils literal notranslate"><span class="pre">&quot;accuracy01&quot;</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">topk_args</span> <span class="pre">=</span> <span class="pre">(1,</span> <span class="pre">3)</span></code> —&gt; <code class="docutils literal notranslate"><span class="pre">&quot;accuracy01&quot;</span></code>, <code class="docutils literal notranslate"><span class="pre">&quot;accuracy03&quot;</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">topk_args</span> <span class="pre">=</span> <span class="pre">(1,</span> <span class="pre">3,</span> <span class="pre">5)</span></code> —&gt; <code class="docutils literal notranslate"><span class="pre">&quot;accuracy01&quot;</span></code>, <code class="docutils literal notranslate"><span class="pre">&quot;accuracy03&quot;</span></code>, <code class="docutils literal notranslate"><span class="pre">&quot;accuracy05&quot;</span></code></p></li>
</ul>
<p>You can find them in <code class="docutils literal notranslate"><span class="pre">runner.batch_metrics</span></code>, <code class="docutils literal notranslate"><span class="pre">runner.loader_metrics</span></code> or
<code class="docutils literal notranslate"><span class="pre">runner.epoch_metrics</span></code>.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Please follow the <a class="reference external" href="https://github.com/catalyst-team/catalyst#minimal-examples">minimal examples</a> sections for more use cases.</p>
</div>
</dd></dl>

</section>
<section id="aucmetric">
<h3><a class="toc-backref" href="#id27">AUCMetric</a><a class="headerlink" href="#aucmetric" title="Permalink to this headline">¶</a></h3>
<dl class="class">
<dt id="catalyst.metrics._auc.AUCMetric">
<em class="property">class </em><code class="sig-prename descclassname">catalyst.metrics._auc.</code><code class="sig-name descname">AUCMetric</code><span class="sig-paren">(</span><em class="sig-param">compute_on_call: bool = True</em>, <em class="sig-param">compute_per_class_metrics: bool = False</em>, <em class="sig-param">prefix: str = None</em>, <em class="sig-param">suffix: str = None</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/catalyst/metrics/_auc.html#AUCMetric"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#catalyst.metrics._auc.AUCMetric" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#catalyst.metrics._metric.ICallbackLoaderMetric" title="catalyst.metrics._metric.ICallbackLoaderMetric"><code class="xref py py-class docutils literal notranslate"><span class="pre">catalyst.metrics._metric.ICallbackLoaderMetric</span></code></a></p>
<p>AUC metric,</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>compute_on_call</strong> – if True, computes and returns metric value during metric call</p></li>
<li><p><strong>compute_per_class_metrics</strong> – boolean flag to compute per-class metrics
(default: SETTINGS.compute_per_class_metrics or False).</p></li>
<li><p><strong>prefix</strong> – metric prefix</p></li>
<li><p><strong>suffix</strong> – metric suffix</p></li>
</ul>
</dd>
</dl>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>This metric is under API improvement.</p>
</div>
<p>Examples:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">torch</span>
<span class="kn">from</span> <span class="nn">catalyst</span> <span class="kn">import</span> <span class="n">metrics</span>

<span class="n">scores</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([</span>
    <span class="p">[</span><span class="mf">0.9</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">],</span>
    <span class="p">[</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">],</span>
<span class="p">])</span>
<span class="n">targets</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([</span>
    <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
    <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
<span class="p">])</span>
<span class="n">metric</span> <span class="o">=</span> <span class="n">metrics</span><span class="o">.</span><span class="n">AUCMetric</span><span class="p">()</span>

<span class="c1"># for efficient statistics storage</span>
<span class="n">metric</span><span class="o">.</span><span class="n">reset</span><span class="p">(</span><span class="n">num_batches</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">num_samples</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">scores</span><span class="p">))</span>
<span class="n">metric</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">scores</span><span class="p">,</span> <span class="n">targets</span><span class="p">)</span>
<span class="n">metric</span><span class="o">.</span><span class="n">compute</span><span class="p">()</span>
<span class="c1"># (</span>
<span class="c1">#     tensor([1., 1.])  # per class</span>
<span class="c1">#     1.0,              # micro</span>
<span class="c1">#     1.0,              # macro</span>
<span class="c1">#     1.0               # weighted</span>
<span class="c1"># )</span>

<span class="n">metric</span><span class="o">.</span><span class="n">compute_key_value</span><span class="p">()</span>
<span class="c1"># {</span>
<span class="c1">#     &#39;auc&#39;: 1.0,</span>
<span class="c1">#     &#39;auc/_micro&#39;: 1.0,</span>
<span class="c1">#     &#39;auc/_macro&#39;: 1.0,</span>
<span class="c1">#     &#39;auc/_weighted&#39;: 1.0</span>
<span class="c1">#     &#39;auc/class_00&#39;: 1.0,</span>
<span class="c1">#     &#39;auc/class_01&#39;: 1.0,</span>
<span class="c1"># }</span>

<span class="n">metric</span><span class="o">.</span><span class="n">reset</span><span class="p">(</span><span class="n">num_batches</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">num_samples</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">scores</span><span class="p">))</span>
<span class="n">metric</span><span class="p">(</span><span class="n">scores</span><span class="p">,</span> <span class="n">targets</span><span class="p">)</span>
<span class="c1"># (</span>
<span class="c1">#     tensor([1., 1.])  # per class</span>
<span class="c1">#     1.0,              # micro</span>
<span class="c1">#     1.0,              # macro</span>
<span class="c1">#     1.0               # weighted</span>
<span class="c1"># )</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">torch</span>
<span class="kn">from</span> <span class="nn">torch.utils.data</span> <span class="kn">import</span> <span class="n">DataLoader</span><span class="p">,</span> <span class="n">TensorDataset</span>
<span class="kn">from</span> <span class="nn">catalyst</span> <span class="kn">import</span> <span class="n">dl</span>

<span class="c1"># sample data</span>
<span class="n">num_samples</span><span class="p">,</span> <span class="n">num_features</span><span class="p">,</span> <span class="n">num_classes</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mf">1e4</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="mf">1e1</span><span class="p">),</span> <span class="mi">4</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="n">num_samples</span><span class="p">,</span> <span class="n">num_features</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="n">num_samples</span><span class="p">,)</span> <span class="o">*</span> <span class="n">num_classes</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">int64</span><span class="p">)</span>

<span class="c1"># pytorch loaders</span>
<span class="n">dataset</span> <span class="o">=</span> <span class="n">TensorDataset</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
<span class="n">loader</span> <span class="o">=</span> <span class="n">DataLoader</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="mi">32</span><span class="p">,</span> <span class="n">num_workers</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">loaders</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;train&quot;</span><span class="p">:</span> <span class="n">loader</span><span class="p">,</span> <span class="s2">&quot;valid&quot;</span><span class="p">:</span> <span class="n">loader</span><span class="p">}</span>

<span class="c1"># model, criterion, optimizer, scheduler</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="n">num_features</span><span class="p">,</span> <span class="n">num_classes</span><span class="p">)</span>
<span class="n">criterion</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">CrossEntropyLoss</span><span class="p">()</span>
<span class="n">optimizer</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">optim</span><span class="o">.</span><span class="n">Adam</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="p">())</span>
<span class="n">scheduler</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">optim</span><span class="o">.</span><span class="n">lr_scheduler</span><span class="o">.</span><span class="n">MultiStepLR</span><span class="p">(</span><span class="n">optimizer</span><span class="p">,</span> <span class="p">[</span><span class="mi">2</span><span class="p">])</span>

<span class="c1"># model training</span>
<span class="n">runner</span> <span class="o">=</span> <span class="n">dl</span><span class="o">.</span><span class="n">SupervisedRunner</span><span class="p">(</span>
    <span class="n">input_key</span><span class="o">=</span><span class="s2">&quot;features&quot;</span><span class="p">,</span> <span class="n">output_key</span><span class="o">=</span><span class="s2">&quot;logits&quot;</span><span class="p">,</span> <span class="n">target_key</span><span class="o">=</span><span class="s2">&quot;targets&quot;</span><span class="p">,</span> <span class="n">loss_key</span><span class="o">=</span><span class="s2">&quot;loss&quot;</span>
<span class="p">)</span>
<span class="n">runner</span><span class="o">.</span><span class="n">train</span><span class="p">(</span>
    <span class="n">model</span><span class="o">=</span><span class="n">model</span><span class="p">,</span>
    <span class="n">criterion</span><span class="o">=</span><span class="n">criterion</span><span class="p">,</span>
    <span class="n">optimizer</span><span class="o">=</span><span class="n">optimizer</span><span class="p">,</span>
    <span class="n">scheduler</span><span class="o">=</span><span class="n">scheduler</span><span class="p">,</span>
    <span class="n">loaders</span><span class="o">=</span><span class="n">loaders</span><span class="p">,</span>
    <span class="n">logdir</span><span class="o">=</span><span class="s2">&quot;./logdir&quot;</span><span class="p">,</span>
    <span class="n">num_epochs</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
    <span class="n">valid_loader</span><span class="o">=</span><span class="s2">&quot;valid&quot;</span><span class="p">,</span>
    <span class="n">valid_metric</span><span class="o">=</span><span class="s2">&quot;accuracy03&quot;</span><span class="p">,</span>
    <span class="n">minimize_valid_metric</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">callbacks</span><span class="o">=</span><span class="p">[</span>
        <span class="n">dl</span><span class="o">.</span><span class="n">AccuracyCallback</span><span class="p">(</span>
            <span class="n">input_key</span><span class="o">=</span><span class="s2">&quot;logits&quot;</span><span class="p">,</span> <span class="n">target_key</span><span class="o">=</span><span class="s2">&quot;targets&quot;</span><span class="p">,</span> <span class="n">num_classes</span><span class="o">=</span><span class="n">num_classes</span>
        <span class="p">),</span>
        <span class="n">dl</span><span class="o">.</span><span class="n">PrecisionRecallF1SupportCallback</span><span class="p">(</span>
            <span class="n">input_key</span><span class="o">=</span><span class="s2">&quot;logits&quot;</span><span class="p">,</span> <span class="n">target_key</span><span class="o">=</span><span class="s2">&quot;targets&quot;</span><span class="p">,</span> <span class="n">num_classes</span><span class="o">=</span><span class="n">num_classes</span>
        <span class="p">),</span>
        <span class="n">dl</span><span class="o">.</span><span class="n">AUCCallback</span><span class="p">(</span><span class="n">input_key</span><span class="o">=</span><span class="s2">&quot;logits&quot;</span><span class="p">,</span> <span class="n">target_key</span><span class="o">=</span><span class="s2">&quot;targets&quot;</span><span class="p">),</span>
    <span class="p">],</span>
<span class="p">)</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Please follow the <a class="reference external" href="https://github.com/catalyst-team/catalyst#minimal-examples">minimal examples</a> sections for more use cases.</p>
</div>
</dd></dl>

</section>
<section id="binaryprecisionrecallf1metric">
<h3><a class="toc-backref" href="#id28">BinaryPrecisionRecallF1Metric</a><a class="headerlink" href="#binaryprecisionrecallf1metric" title="Permalink to this headline">¶</a></h3>
<dl class="class">
<dt id="catalyst.metrics._classification.BinaryPrecisionRecallF1Metric">
<em class="property">class </em><code class="sig-prename descclassname">catalyst.metrics._classification.</code><code class="sig-name descname">BinaryPrecisionRecallF1Metric</code><span class="sig-paren">(</span><em class="sig-param">zero_division: int = 0</em>, <em class="sig-param">compute_on_call: bool = True</em>, <em class="sig-param">prefix: Optional[str] = None</em>, <em class="sig-param">suffix: Optional[str] = None</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/catalyst/metrics/_classification.html#BinaryPrecisionRecallF1Metric"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#catalyst.metrics._classification.BinaryPrecisionRecallF1Metric" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">catalyst.metrics._classification.BinaryStatisticsMetric</span></code></p>
<p>Precision, recall, f1_score and support metrics for binary classification.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>zero_division</strong> – value to set in case of zero division during metrics
(precision, recall) computation; should be one of 0 or 1</p></li>
<li><p><strong>compute_on_call</strong> – if True, allows compute metric’s value on call</p></li>
<li><p><strong>prefix</strong> – metric prefix</p></li>
<li><p><strong>suffix</strong> – metric suffix</p></li>
</ul>
</dd>
</dl>
</dd></dl>

</section>
<section id="confusionmatrixmetric">
<h3><a class="toc-backref" href="#id29">ConfusionMatrixMetric</a><a class="headerlink" href="#confusionmatrixmetric" title="Permalink to this headline">¶</a></h3>
<dl class="class">
<dt id="catalyst.metrics._confusion_matrix.ConfusionMatrixMetric">
<em class="property">class </em><code class="sig-prename descclassname">catalyst.metrics._confusion_matrix.</code><code class="sig-name descname">ConfusionMatrixMetric</code><span class="sig-paren">(</span><em class="sig-param">num_classes: int</em>, <em class="sig-param">normalized: bool = False</em>, <em class="sig-param">compute_on_call: bool = True</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/catalyst/metrics/_confusion_matrix.html#ConfusionMatrixMetric"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#catalyst.metrics._confusion_matrix.ConfusionMatrixMetric" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#catalyst.metrics._metric.IMetric" title="catalyst.metrics._metric.IMetric"><code class="xref py py-class docutils literal notranslate"><span class="pre">catalyst.metrics._metric.IMetric</span></code></a></p>
<p>Constructs a confusion matrix for a multiclass classification problems.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>num_classes</strong> – number of classes in the classification problem</p></li>
<li><p><strong>normalized</strong> – determines whether or not the confusion matrix is normalized or not</p></li>
<li><p><strong>compute_on_call</strong> – Boolean flag to computes and return confusion matrix during __call__.
default: True</p></li>
</ul>
</dd>
</dl>
<p>Examples:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">torch</span>
<span class="kn">from</span> <span class="nn">torch.utils.data</span> <span class="kn">import</span> <span class="n">DataLoader</span><span class="p">,</span> <span class="n">TensorDataset</span>
<span class="kn">from</span> <span class="nn">catalyst</span> <span class="kn">import</span> <span class="n">dl</span>

<span class="c1"># sample data</span>
<span class="n">num_samples</span><span class="p">,</span> <span class="n">num_features</span><span class="p">,</span> <span class="n">num_classes</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mf">1e4</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="mf">1e1</span><span class="p">),</span> <span class="mi">4</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="n">num_samples</span><span class="p">,</span> <span class="n">num_features</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="n">num_samples</span><span class="p">,)</span> <span class="o">*</span> <span class="n">num_classes</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">int64</span><span class="p">)</span>

<span class="c1"># pytorch loaders</span>
<span class="n">dataset</span> <span class="o">=</span> <span class="n">TensorDataset</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
<span class="n">loader</span> <span class="o">=</span> <span class="n">DataLoader</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="mi">32</span><span class="p">,</span> <span class="n">num_workers</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">loaders</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;train&quot;</span><span class="p">:</span> <span class="n">loader</span><span class="p">,</span> <span class="s2">&quot;valid&quot;</span><span class="p">:</span> <span class="n">loader</span><span class="p">}</span>

<span class="c1"># model, criterion, optimizer, scheduler</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="n">num_features</span><span class="p">,</span> <span class="n">num_classes</span><span class="p">)</span>
<span class="n">criterion</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">CrossEntropyLoss</span><span class="p">()</span>
<span class="n">optimizer</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">optim</span><span class="o">.</span><span class="n">Adam</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="p">())</span>
<span class="n">scheduler</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">optim</span><span class="o">.</span><span class="n">lr_scheduler</span><span class="o">.</span><span class="n">MultiStepLR</span><span class="p">(</span><span class="n">optimizer</span><span class="p">,</span> <span class="p">[</span><span class="mi">2</span><span class="p">])</span>

<span class="c1"># model training</span>
<span class="n">runner</span> <span class="o">=</span> <span class="n">dl</span><span class="o">.</span><span class="n">SupervisedRunner</span><span class="p">(</span>
    <span class="n">input_key</span><span class="o">=</span><span class="s2">&quot;features&quot;</span><span class="p">,</span> <span class="n">output_key</span><span class="o">=</span><span class="s2">&quot;logits&quot;</span><span class="p">,</span> <span class="n">target_key</span><span class="o">=</span><span class="s2">&quot;targets&quot;</span><span class="p">,</span> <span class="n">loss_key</span><span class="o">=</span><span class="s2">&quot;loss&quot;</span>
<span class="p">)</span>
<span class="n">runner</span><span class="o">.</span><span class="n">train</span><span class="p">(</span>
    <span class="n">model</span><span class="o">=</span><span class="n">model</span><span class="p">,</span>
    <span class="n">criterion</span><span class="o">=</span><span class="n">criterion</span><span class="p">,</span>
    <span class="n">optimizer</span><span class="o">=</span><span class="n">optimizer</span><span class="p">,</span>
    <span class="n">scheduler</span><span class="o">=</span><span class="n">scheduler</span><span class="p">,</span>
    <span class="n">loaders</span><span class="o">=</span><span class="n">loaders</span><span class="p">,</span>
    <span class="n">logdir</span><span class="o">=</span><span class="s2">&quot;./logdir&quot;</span><span class="p">,</span>
    <span class="n">num_epochs</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
    <span class="n">valid_loader</span><span class="o">=</span><span class="s2">&quot;valid&quot;</span><span class="p">,</span>
    <span class="n">valid_metric</span><span class="o">=</span><span class="s2">&quot;accuracy03&quot;</span><span class="p">,</span>
    <span class="n">minimize_valid_metric</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">callbacks</span><span class="o">=</span><span class="p">[</span>
        <span class="n">dl</span><span class="o">.</span><span class="n">AccuracyCallback</span><span class="p">(</span>
            <span class="n">input_key</span><span class="o">=</span><span class="s2">&quot;logits&quot;</span><span class="p">,</span> <span class="n">target_key</span><span class="o">=</span><span class="s2">&quot;targets&quot;</span><span class="p">,</span> <span class="n">num_classes</span><span class="o">=</span><span class="n">num_classes</span>
        <span class="p">),</span>
        <span class="n">dl</span><span class="o">.</span><span class="n">PrecisionRecallF1SupportCallback</span><span class="p">(</span>
            <span class="n">input_key</span><span class="o">=</span><span class="s2">&quot;logits&quot;</span><span class="p">,</span> <span class="n">target_key</span><span class="o">=</span><span class="s2">&quot;targets&quot;</span><span class="p">,</span> <span class="n">num_classes</span><span class="o">=</span><span class="n">num_classes</span>
        <span class="p">),</span>
        <span class="n">dl</span><span class="o">.</span><span class="n">AUCCallback</span><span class="p">(</span><span class="n">input_key</span><span class="o">=</span><span class="s2">&quot;logits&quot;</span><span class="p">,</span> <span class="n">target_key</span><span class="o">=</span><span class="s2">&quot;targets&quot;</span><span class="p">),</span>
        <span class="n">dl</span><span class="o">.</span><span class="n">ConfusionMatrixCallback</span><span class="p">(</span>
            <span class="n">input_key</span><span class="o">=</span><span class="s2">&quot;logits&quot;</span><span class="p">,</span> <span class="n">target_key</span><span class="o">=</span><span class="s2">&quot;targets&quot;</span><span class="p">,</span> <span class="n">num_classes</span><span class="o">=</span><span class="n">num_classes</span>
        <span class="p">),</span>
    <span class="p">],</span>
<span class="p">)</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Please follow the <a class="reference external" href="https://github.com/catalyst-team/catalyst#minimal-examples">minimal examples</a> sections for more use cases.</p>
</div>
</dd></dl>

</section>
<section id="cmcmetric">
<h3><a class="toc-backref" href="#id30">CMCMetric</a><a class="headerlink" href="#cmcmetric" title="Permalink to this headline">¶</a></h3>
<dl class="class">
<dt id="catalyst.metrics._cmc_score.CMCMetric">
<em class="property">class </em><code class="sig-prename descclassname">catalyst.metrics._cmc_score.</code><code class="sig-name descname">CMCMetric</code><span class="sig-paren">(</span><em class="sig-param">embeddings_key: str</em>, <em class="sig-param">labels_key: str</em>, <em class="sig-param">is_query_key: str</em>, <em class="sig-param">topk_args: Iterable[int] = None</em>, <em class="sig-param">compute_on_call: bool = True</em>, <em class="sig-param">prefix: Optional[str] = None</em>, <em class="sig-param">suffix: Optional[str] = None</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/catalyst/metrics/_cmc_score.html#CMCMetric"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#catalyst.metrics._cmc_score.CMCMetric" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#catalyst.metrics._accumulative.AccumulativeMetric" title="catalyst.metrics._accumulative.AccumulativeMetric"><code class="xref py py-class docutils literal notranslate"><span class="pre">catalyst.metrics._accumulative.AccumulativeMetric</span></code></a></p>
<p>Cumulative Matching Characteristics</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>embeddings_key</strong> – key of embedding tensor in batch</p></li>
<li><p><strong>labels_key</strong> – key of label tensor in batch</p></li>
<li><p><strong>is_query_key</strong> – key of query flag tensor in batch</p></li>
<li><p><strong>topk_args</strong> – list of k, specifies which cmc&#64;k should be calculated</p></li>
<li><p><strong>compute_on_call</strong> – if True, allows compute metric’s value on call</p></li>
<li><p><strong>prefix</strong> – metric prefix</p></li>
<li><p><strong>suffix</strong> – metric suffix</p></li>
</ul>
</dd>
</dl>
<p>Examples:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">torch</span>
<span class="kn">from</span> <span class="nn">catalyst</span> <span class="kn">import</span> <span class="n">metrics</span>

<span class="n">batch</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;embeddings&quot;</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span>
        <span class="p">[</span>
            <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
            <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
            <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
            <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
            <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
            <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
            <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
        <span class="p">]</span>
    <span class="p">)</span><span class="o">.</span><span class="n">float</span><span class="p">(),</span>
    <span class="s2">&quot;labels&quot;</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]),</span>
    <span class="s2">&quot;is_query&quot;</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">bool</span><span class="p">(),</span>
<span class="p">}</span>
<span class="n">topk</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>

<span class="n">metric</span> <span class="o">=</span> <span class="n">metrics</span><span class="o">.</span><span class="n">CMCMetric</span><span class="p">(</span>
    <span class="n">embeddings_key</span><span class="o">=</span><span class="s2">&quot;embeddings&quot;</span><span class="p">,</span>
    <span class="n">labels_key</span><span class="o">=</span><span class="s2">&quot;labels&quot;</span><span class="p">,</span>
    <span class="n">is_query_key</span><span class="o">=</span><span class="s2">&quot;is_query&quot;</span><span class="p">,</span>
    <span class="n">topk_args</span><span class="o">=</span><span class="n">topk</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">metric</span><span class="o">.</span><span class="n">reset</span><span class="p">(</span><span class="n">num_batches</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">num_samples</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">batch</span><span class="p">[</span><span class="s2">&quot;embeddings&quot;</span><span class="p">]))</span>

<span class="n">metric</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="o">**</span><span class="n">batch</span><span class="p">)</span>
<span class="n">metric</span><span class="o">.</span><span class="n">compute</span><span class="p">()</span>
<span class="c1"># [0.75, 1.0]  # CMC@01, CMC@03</span>

<span class="n">metric</span><span class="o">.</span><span class="n">compute_key_value</span><span class="p">()</span>
<span class="c1"># {&#39;cmc01&#39;: 0.75, &#39;cmc03&#39;: 1.0}</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">torch.optim</span> <span class="kn">import</span> <span class="n">Adam</span>
<span class="kn">from</span> <span class="nn">torch.utils.data</span> <span class="kn">import</span> <span class="n">DataLoader</span>
<span class="kn">from</span> <span class="nn">catalyst</span> <span class="kn">import</span> <span class="n">data</span><span class="p">,</span> <span class="n">dl</span>
<span class="kn">from</span> <span class="nn">catalyst.contrib</span> <span class="kn">import</span> <span class="n">data</span><span class="o">.</span><span class="n">datasets</span><span class="p">,</span> <span class="n">models</span><span class="p">,</span> <span class="n">nn</span>


<span class="c1"># 1. train and valid loaders</span>
<span class="n">transforms</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">Compose</span><span class="p">([</span>
    <span class="n">data</span><span class="o">.</span><span class="n">ImageToTensor</span><span class="p">(),</span> <span class="n">data</span><span class="o">.</span><span class="n">NormalizeImage</span><span class="p">((</span><span class="mf">0.1307</span><span class="p">,),</span> <span class="p">(</span><span class="mf">0.3081</span><span class="p">,))</span>
<span class="p">])</span>

<span class="n">train_dataset</span> <span class="o">=</span> <span class="n">datasets</span><span class="o">.</span><span class="n">MnistMLDataset</span><span class="p">(</span>
    <span class="n">root</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">(),</span> <span class="n">download</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">transforms</span>
<span class="p">)</span>
<span class="n">sampler</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">BatchBalanceClassSampler</span><span class="p">(</span>
    <span class="n">labels</span><span class="o">=</span><span class="n">train_dataset</span><span class="o">.</span><span class="n">get_labels</span><span class="p">(),</span> <span class="n">num_classes</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">num_samples</span><span class="o">=</span><span class="mi">10</span>
<span class="p">)</span>
<span class="n">train_loader</span> <span class="o">=</span> <span class="n">DataLoader</span><span class="p">(</span><span class="n">dataset</span><span class="o">=</span><span class="n">train_dataset</span><span class="p">,</span> <span class="n">batch_sampler</span><span class="o">=</span><span class="n">sampler</span><span class="p">)</span>

<span class="n">valid_dataset</span> <span class="o">=</span> <span class="n">datasets</span><span class="o">.</span><span class="n">MnistQGDataset</span><span class="p">(</span>
    <span class="n">root</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">(),</span> <span class="n">transform</span><span class="o">=</span><span class="n">transforms</span><span class="p">,</span> <span class="n">gallery_fraq</span><span class="o">=</span><span class="mf">0.2</span>
<span class="p">)</span>
<span class="n">valid_loader</span> <span class="o">=</span> <span class="n">DataLoader</span><span class="p">(</span><span class="n">dataset</span><span class="o">=</span><span class="n">valid_dataset</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="mi">1024</span><span class="p">)</span>

<span class="c1"># 2. model and optimizer</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">MnistSimpleNet</span><span class="p">(</span><span class="n">out_features</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<span class="n">optimizer</span> <span class="o">=</span> <span class="n">Adam</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="p">(),</span> <span class="n">lr</span><span class="o">=</span><span class="mf">0.001</span><span class="p">)</span>

<span class="c1"># 3. criterion with triplets sampling</span>
<span class="n">sampler_inbatch</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">HardTripletsSampler</span><span class="p">(</span><span class="n">norm_required</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">criterion</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">TripletMarginLossWithSampler</span><span class="p">(</span><span class="n">margin</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">sampler_inbatch</span><span class="o">=</span><span class="n">sampler_inbatch</span><span class="p">)</span>

<span class="c1"># 4. training with catalyst Runner</span>
<span class="k">class</span> <span class="nc">CustomRunner</span><span class="p">(</span><span class="n">dl</span><span class="o">.</span><span class="n">SupervisedRunner</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">handle_batch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">batch</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_train_loader</span><span class="p">:</span>
            <span class="n">images</span><span class="p">,</span> <span class="n">targets</span> <span class="o">=</span> <span class="n">batch</span><span class="p">[</span><span class="s2">&quot;features&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">float</span><span class="p">(),</span> <span class="n">batch</span><span class="p">[</span><span class="s2">&quot;targets&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">long</span><span class="p">()</span>
            <span class="n">features</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">(</span><span class="n">images</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">batch</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;embeddings&quot;</span><span class="p">:</span> <span class="n">features</span><span class="p">,</span> <span class="s2">&quot;targets&quot;</span><span class="p">:</span> <span class="n">targets</span><span class="p">,}</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">images</span><span class="p">,</span> <span class="n">targets</span><span class="p">,</span> <span class="n">is_query</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">batch</span><span class="p">[</span><span class="s2">&quot;features&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">float</span><span class="p">(),</span>
                <span class="n">batch</span><span class="p">[</span><span class="s2">&quot;targets&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">long</span><span class="p">(),</span>
                <span class="n">batch</span><span class="p">[</span><span class="s2">&quot;is_query&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">bool</span><span class="p">()</span>
            <span class="p">)</span>
            <span class="n">features</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">(</span><span class="n">images</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">batch</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;embeddings&quot;</span><span class="p">:</span> <span class="n">features</span><span class="p">,</span> <span class="s2">&quot;targets&quot;</span><span class="p">:</span> <span class="n">targets</span><span class="p">,</span> <span class="s2">&quot;is_query&quot;</span><span class="p">:</span> <span class="n">is_query</span>
            <span class="p">}</span>

<span class="n">callbacks</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">dl</span><span class="o">.</span><span class="n">ControlFlowCallback</span><span class="p">(</span>
        <span class="n">dl</span><span class="o">.</span><span class="n">CriterionCallback</span><span class="p">(</span>
            <span class="n">input_key</span><span class="o">=</span><span class="s2">&quot;embeddings&quot;</span><span class="p">,</span> <span class="n">target_key</span><span class="o">=</span><span class="s2">&quot;targets&quot;</span><span class="p">,</span> <span class="n">metric_key</span><span class="o">=</span><span class="s2">&quot;loss&quot;</span>
        <span class="p">),</span>
        <span class="n">loaders</span><span class="o">=</span><span class="s2">&quot;train&quot;</span><span class="p">,</span>
    <span class="p">),</span>
    <span class="n">dl</span><span class="o">.</span><span class="n">ControlFlowCallback</span><span class="p">(</span>
        <span class="n">dl</span><span class="o">.</span><span class="n">CMCScoreCallback</span><span class="p">(</span>
            <span class="n">embeddings_key</span><span class="o">=</span><span class="s2">&quot;embeddings&quot;</span><span class="p">,</span>
            <span class="n">labels_key</span><span class="o">=</span><span class="s2">&quot;targets&quot;</span><span class="p">,</span>
            <span class="n">is_query_key</span><span class="o">=</span><span class="s2">&quot;is_query&quot;</span><span class="p">,</span>
            <span class="n">topk_args</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
        <span class="p">),</span>
        <span class="n">loaders</span><span class="o">=</span><span class="s2">&quot;valid&quot;</span><span class="p">,</span>
    <span class="p">),</span>
    <span class="n">dl</span><span class="o">.</span><span class="n">PeriodicLoaderCallback</span><span class="p">(</span>
        <span class="n">valid_loader_key</span><span class="o">=</span><span class="s2">&quot;valid&quot;</span><span class="p">,</span> <span class="n">valid_metric_key</span><span class="o">=</span><span class="s2">&quot;cmc01&quot;</span><span class="p">,</span> <span class="n">minimize</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">valid</span><span class="o">=</span><span class="mi">2</span>
    <span class="p">),</span>
<span class="p">]</span>

<span class="n">runner</span> <span class="o">=</span> <span class="n">CustomRunner</span><span class="p">(</span><span class="n">input_key</span><span class="o">=</span><span class="s2">&quot;features&quot;</span><span class="p">,</span> <span class="n">output_key</span><span class="o">=</span><span class="s2">&quot;embeddings&quot;</span><span class="p">)</span>
<span class="n">runner</span><span class="o">.</span><span class="n">train</span><span class="p">(</span>
    <span class="n">model</span><span class="o">=</span><span class="n">model</span><span class="p">,</span>
    <span class="n">criterion</span><span class="o">=</span><span class="n">criterion</span><span class="p">,</span>
    <span class="n">optimizer</span><span class="o">=</span><span class="n">optimizer</span><span class="p">,</span>
    <span class="n">callbacks</span><span class="o">=</span><span class="n">callbacks</span><span class="p">,</span>
    <span class="n">loaders</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;train&quot;</span><span class="p">:</span> <span class="n">train_loader</span><span class="p">,</span> <span class="s2">&quot;valid&quot;</span><span class="p">:</span> <span class="n">valid_loader</span><span class="p">},</span>
    <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">logdir</span><span class="o">=</span><span class="s2">&quot;./logs&quot;</span><span class="p">,</span>
    <span class="n">valid_loader</span><span class="o">=</span><span class="s2">&quot;valid&quot;</span><span class="p">,</span>
    <span class="n">valid_metric</span><span class="o">=</span><span class="s2">&quot;cmc01&quot;</span><span class="p">,</span>
    <span class="n">minimize_valid_metric</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">num_epochs</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Metric names depending on input parameters:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">topk_args</span> <span class="pre">=</span> <span class="pre">(1,)</span> <span class="pre">or</span> <span class="pre">None</span></code> —&gt; <code class="docutils literal notranslate"><span class="pre">&quot;cmc01&quot;</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">topk_args</span> <span class="pre">=</span> <span class="pre">(1,</span> <span class="pre">3)</span></code> —&gt; <code class="docutils literal notranslate"><span class="pre">&quot;cmc01&quot;</span></code>, <code class="docutils literal notranslate"><span class="pre">&quot;cmc03&quot;</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">topk_args</span> <span class="pre">=</span> <span class="pre">(1,</span> <span class="pre">3,</span> <span class="pre">5)</span></code> —&gt; <code class="docutils literal notranslate"><span class="pre">&quot;cmc01&quot;</span></code>, <code class="docutils literal notranslate"><span class="pre">&quot;cmc03&quot;</span></code>, <code class="docutils literal notranslate"><span class="pre">&quot;cmc05&quot;</span></code></p></li>
</ul>
<p>You can find them in <code class="docutils literal notranslate"><span class="pre">runner.batch_metrics</span></code>, <code class="docutils literal notranslate"><span class="pre">runner.loader_metrics</span></code> or
<code class="docutils literal notranslate"><span class="pre">runner.epoch_metrics</span></code>.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Please follow the <a class="reference external" href="https://github.com/catalyst-team/catalyst#minimal-examples">minimal examples</a> sections for more use cases.</p>
</div>
</dd></dl>

</section>
<section id="dicemetric">
<h3><a class="toc-backref" href="#id31">DiceMetric</a><a class="headerlink" href="#dicemetric" title="Permalink to this headline">¶</a></h3>
<dl class="class">
<dt id="catalyst.metrics._segmentation.DiceMetric">
<em class="property">class </em><code class="sig-prename descclassname">catalyst.metrics._segmentation.</code><code class="sig-name descname">DiceMetric</code><span class="sig-paren">(</span><em class="sig-param">class_dim: int = 1</em>, <em class="sig-param">weights: Optional[List[float]] = None</em>, <em class="sig-param">class_names: Optional[List[str]] = None</em>, <em class="sig-param">threshold: Optional[float] = None</em>, <em class="sig-param">eps: float = 1e-07</em>, <em class="sig-param">compute_on_call: bool = True</em>, <em class="sig-param">compute_per_class_metrics: bool = False</em>, <em class="sig-param">prefix: Optional[str] = None</em>, <em class="sig-param">suffix: Optional[str] = None</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/catalyst/metrics/_segmentation.html#DiceMetric"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#catalyst.metrics._segmentation.DiceMetric" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#catalyst.metrics._segmentation.RegionBasedMetric" title="catalyst.metrics._segmentation.RegionBasedMetric"><code class="xref py py-class docutils literal notranslate"><span class="pre">catalyst.metrics._segmentation.RegionBasedMetric</span></code></a></p>
<p>Dice Metric,
dice score = 2 * intersection / (intersection + union)) = 2 * tp / (2 * tp + fp + fn)</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>class_dim</strong> – indicates class dimention (K) for <code class="docutils literal notranslate"><span class="pre">outputs</span></code> and</p></li>
<li><p><strong>tensors</strong> (<em>targets</em>) – </p></li>
<li><p><strong>weights</strong> – class weights</p></li>
<li><p><strong>class_names</strong> – class names</p></li>
<li><p><strong>threshold</strong> – threshold for outputs binarization</p></li>
<li><p><strong>eps</strong> – epsilon to avoid zero division</p></li>
<li><p><strong>compute_on_call</strong> – Computes and returns metric value during metric call.
Used for per-batch logging. default: True</p></li>
<li><p><strong>compute_per_class_metrics</strong> – boolean flag to compute per-class metrics
(default: SETTINGS.compute_per_class_metrics or False).</p></li>
<li><p><strong>prefix</strong> – metric prefix</p></li>
<li><p><strong>suffix</strong> – metric suffix</p></li>
</ul>
</dd>
</dl>
<p>Examples:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">torch</span>
<span class="kn">from</span> <span class="nn">catalyst</span> <span class="kn">import</span> <span class="n">metrics</span>

<span class="n">outputs</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([[[[</span><span class="mf">0.8</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]]]])</span>
<span class="n">targets</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([[[[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]]]])</span>
<span class="n">metric</span> <span class="o">=</span> <span class="n">metrics</span><span class="o">.</span><span class="n">DiceMetric</span><span class="p">()</span>
<span class="n">metric</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>

<span class="n">metric</span><span class="o">.</span><span class="n">compute</span><span class="p">()</span>
<span class="c1"># per_class, micro, macro, weighted</span>
<span class="c1"># ([tensor(0.3636)], tensor(0.3636), tensor(0.3636), None)</span>

<span class="n">metric</span><span class="o">.</span><span class="n">update_key_value</span><span class="p">(</span><span class="n">outputs</span><span class="p">,</span> <span class="n">targets</span><span class="p">)</span>
<span class="n">metric</span><span class="o">.</span><span class="n">compute_key_value</span><span class="p">()</span>
<span class="c1"># {</span>
<span class="c1">#     &#39;dice&#39;: tensor(0.3636),</span>
<span class="c1">#     &#39;dice/_macro&#39;: tensor(0.3636),</span>
<span class="c1">#     &#39;dice/_micro&#39;: tensor(0.3636),</span>
<span class="c1">#     &#39;dice/class_00&#39;: tensor(0.3636),</span>
<span class="c1"># }</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">torch</span>
<span class="kn">from</span> <span class="nn">torch</span> <span class="kn">import</span> <span class="n">nn</span>
<span class="kn">from</span> <span class="nn">torch.utils.data</span> <span class="kn">import</span> <span class="n">DataLoader</span>
<span class="kn">from</span> <span class="nn">catalyst</span> <span class="kn">import</span> <span class="n">dl</span>
<span class="kn">from</span> <span class="nn">catalyst.contrib</span> <span class="kn">import</span> <span class="n">IoULoss</span><span class="p">,</span> <span class="n">MNIST</span>

<span class="n">model</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Sequential</span><span class="p">(</span>
    <span class="n">nn</span><span class="o">.</span><span class="n">Conv2d</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">nn</span><span class="o">.</span><span class="n">ReLU</span><span class="p">(),</span>
    <span class="n">nn</span><span class="o">.</span><span class="n">Conv2d</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">nn</span><span class="o">.</span><span class="n">Sigmoid</span><span class="p">(),</span>
<span class="p">)</span>
<span class="n">criterion</span> <span class="o">=</span> <span class="n">IoULoss</span><span class="p">()</span>
<span class="n">optimizer</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">optim</span><span class="o">.</span><span class="n">Adam</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="p">(),</span> <span class="n">lr</span><span class="o">=</span><span class="mf">0.02</span><span class="p">)</span>

<span class="n">loaders</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;train&quot;</span><span class="p">:</span> <span class="n">DataLoader</span><span class="p">(</span>
        <span class="n">MNIST</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">(),</span> <span class="n">train</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
        <span class="n">batch_size</span><span class="o">=</span><span class="mi">32</span>
    <span class="p">),</span>
    <span class="s2">&quot;valid&quot;</span><span class="p">:</span> <span class="n">DataLoader</span><span class="p">(</span>
        <span class="n">MNIST</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">(),</span> <span class="n">train</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span>
        <span class="n">batch_size</span><span class="o">=</span><span class="mi">32</span>
    <span class="p">),</span>
<span class="p">}</span>

<span class="k">class</span> <span class="nc">CustomRunner</span><span class="p">(</span><span class="n">dl</span><span class="o">.</span><span class="n">SupervisedRunner</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">handle_batch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">batch</span><span class="p">):</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">batch</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_input_key</span><span class="p">]</span>
        <span class="n">x_noise</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="n">torch</span><span class="o">.</span><span class="n">rand_like</span><span class="p">(</span><span class="n">x</span><span class="p">))</span><span class="o">.</span><span class="n">clamp_</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">x_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">(</span><span class="n">x_noise</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">batch</span> <span class="o">=</span> <span class="p">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_input_key</span><span class="p">:</span> <span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_output_key</span><span class="p">:</span> <span class="n">x_</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_target_key</span><span class="p">:</span> <span class="n">x</span><span class="p">}</span>

<span class="n">runner</span> <span class="o">=</span> <span class="n">CustomRunner</span><span class="p">(</span>
    <span class="n">input_key</span><span class="o">=</span><span class="s2">&quot;features&quot;</span><span class="p">,</span> <span class="n">output_key</span><span class="o">=</span><span class="s2">&quot;scores&quot;</span><span class="p">,</span> <span class="n">target_key</span><span class="o">=</span><span class="s2">&quot;targets&quot;</span><span class="p">,</span> <span class="n">loss_key</span><span class="o">=</span><span class="s2">&quot;loss&quot;</span>
<span class="p">)</span>
<span class="c1"># model training</span>
<span class="n">runner</span><span class="o">.</span><span class="n">train</span><span class="p">(</span>
    <span class="n">model</span><span class="o">=</span><span class="n">model</span><span class="p">,</span>
    <span class="n">criterion</span><span class="o">=</span><span class="n">criterion</span><span class="p">,</span>
    <span class="n">optimizer</span><span class="o">=</span><span class="n">optimizer</span><span class="p">,</span>
    <span class="n">loaders</span><span class="o">=</span><span class="n">loaders</span><span class="p">,</span>
    <span class="n">num_epochs</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">callbacks</span><span class="o">=</span><span class="p">[</span>
        <span class="n">dl</span><span class="o">.</span><span class="n">IOUCallback</span><span class="p">(</span><span class="n">input_key</span><span class="o">=</span><span class="s2">&quot;scores&quot;</span><span class="p">,</span> <span class="n">target_key</span><span class="o">=</span><span class="s2">&quot;targets&quot;</span><span class="p">),</span>
        <span class="n">dl</span><span class="o">.</span><span class="n">DiceCallback</span><span class="p">(</span><span class="n">input_key</span><span class="o">=</span><span class="s2">&quot;scores&quot;</span><span class="p">,</span> <span class="n">target_key</span><span class="o">=</span><span class="s2">&quot;targets&quot;</span><span class="p">),</span>
        <span class="n">dl</span><span class="o">.</span><span class="n">TrevskyCallback</span><span class="p">(</span><span class="n">input_key</span><span class="o">=</span><span class="s2">&quot;scores&quot;</span><span class="p">,</span> <span class="n">target_key</span><span class="o">=</span><span class="s2">&quot;targets&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">),</span>
    <span class="p">],</span>
    <span class="n">logdir</span><span class="o">=</span><span class="s2">&quot;./logdir&quot;</span><span class="p">,</span>
    <span class="n">valid_loader</span><span class="o">=</span><span class="s2">&quot;valid&quot;</span><span class="p">,</span>
    <span class="n">valid_metric</span><span class="o">=</span><span class="s2">&quot;loss&quot;</span><span class="p">,</span>
    <span class="n">minimize_valid_metric</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Please follow the <a class="reference external" href="https://github.com/catalyst-team/catalyst#minimal-examples">minimal examples</a> sections for more use cases.</p>
</div>
</dd></dl>

</section>
<section id="hitratemetric">
<h3><a class="toc-backref" href="#id32">HitrateMetric</a><a class="headerlink" href="#hitratemetric" title="Permalink to this headline">¶</a></h3>
<dl class="class">
<dt id="catalyst.metrics._hitrate.HitrateMetric">
<em class="property">class </em><code class="sig-prename descclassname">catalyst.metrics._hitrate.</code><code class="sig-name descname">HitrateMetric</code><span class="sig-paren">(</span><em class="sig-param">topk_args: Iterable[int] = None</em>, <em class="sig-param">compute_on_call: bool = True</em>, <em class="sig-param">prefix: str = None</em>, <em class="sig-param">suffix: str = None</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/catalyst/metrics/_hitrate.html#HitrateMetric"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#catalyst.metrics._hitrate.HitrateMetric" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#catalyst.metrics._topk_metric.TopKMetric" title="catalyst.metrics._topk_metric.TopKMetric"><code class="xref py py-class docutils literal notranslate"><span class="pre">catalyst.metrics._topk_metric.TopKMetric</span></code></a></p>
<p>Calculates the hitrate.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>topk_args</strong> – list of <cite>topk</cite> for <a class="reference external" href="mailto:hitrate&#37;&#52;&#48;topk">hitrate<span>&#64;</span>topk</a> computing</p></li>
<li><p><strong>compute_on_call</strong> – if True, computes and returns metric value during metric call</p></li>
<li><p><strong>prefix</strong> – metric prefix</p></li>
<li><p><strong>suffix</strong> – metric suffix</p></li>
</ul>
</dd>
</dl>
<p>Compute mean value of hitrate and it’s approximate std value.</p>
<p>Examples:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">torch</span>
<span class="kn">from</span> <span class="nn">catalyst</span> <span class="kn">import</span> <span class="n">metrics</span>

<span class="n">outputs</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">([[</span><span class="mf">4.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">],</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">,</span> <span class="mf">4.0</span><span class="p">]])</span>
<span class="n">targets</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">([[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">]])</span>
<span class="n">metric</span> <span class="o">=</span> <span class="n">metrics</span><span class="o">.</span><span class="n">HitrateMetric</span><span class="p">(</span><span class="n">topk_args</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">])</span>
<span class="n">metric</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>

<span class="n">metric</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">outputs</span><span class="p">,</span> <span class="n">targets</span><span class="p">)</span>
<span class="n">metric</span><span class="o">.</span><span class="n">compute</span><span class="p">()</span>
<span class="c1"># (</span>
<span class="c1">#     (0.0, 0.25, 0.25, 0.5),  # mean for @01, @02, @03, @04</span>
<span class="c1">#     (0.0, 0.0, 0.0, 0.0)     # std for @01, @02, @03, @04</span>
<span class="c1"># )</span>

<span class="n">metric</span><span class="o">.</span><span class="n">compute_key_value</span><span class="p">()</span>
<span class="c1"># {</span>
<span class="c1">#     &#39;hitrate01&#39;: 0.0,</span>
<span class="c1">#     &#39;hitrate01/std&#39;: 0.0,</span>
<span class="c1">#     &#39;hitrate02&#39;: 0.25,</span>
<span class="c1">#     &#39;hitrate02/std&#39;: 0.0,</span>
<span class="c1">#     &#39;hitrate03&#39;: 0.25,</span>
<span class="c1">#     &#39;hitrate03/std&#39;: 0.0,</span>
<span class="c1">#     &#39;hitrate04&#39;: 0.5,</span>
<span class="c1">#     &#39;hitrate04/std&#39;: 0.0</span>
<span class="c1"># }</span>

<span class="n">metric</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
<span class="n">metric</span><span class="p">(</span><span class="n">outputs</span><span class="p">,</span> <span class="n">targets</span><span class="p">)</span>
<span class="c1"># (</span>
<span class="c1">#     (0.0, 0.25, 0.25, 0.5),  # mean for @01, @02, @03, @04</span>
<span class="c1">#     (0.0, 0.0, 0.0, 0.0)     # std for @01, @02, @03, @04</span>
<span class="c1"># )</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">torch</span>
<span class="kn">from</span> <span class="nn">torch.utils.data</span> <span class="kn">import</span> <span class="n">DataLoader</span><span class="p">,</span> <span class="n">TensorDataset</span>
<span class="kn">from</span> <span class="nn">catalyst</span> <span class="kn">import</span> <span class="n">dl</span>

<span class="c1"># sample data</span>
<span class="n">num_users</span><span class="p">,</span> <span class="n">num_features</span><span class="p">,</span> <span class="n">num_items</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mf">1e4</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="mf">1e1</span><span class="p">),</span> <span class="mi">10</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="n">num_users</span><span class="p">,</span> <span class="n">num_features</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="n">num_users</span><span class="p">,</span> <span class="n">num_items</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mf">0.5</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>

<span class="c1"># pytorch loaders</span>
<span class="n">dataset</span> <span class="o">=</span> <span class="n">TensorDataset</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
<span class="n">loader</span> <span class="o">=</span> <span class="n">DataLoader</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="mi">32</span><span class="p">,</span> <span class="n">num_workers</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">loaders</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;train&quot;</span><span class="p">:</span> <span class="n">loader</span><span class="p">,</span> <span class="s2">&quot;valid&quot;</span><span class="p">:</span> <span class="n">loader</span><span class="p">}</span>

<span class="c1"># model, criterion, optimizer, scheduler</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="n">num_features</span><span class="p">,</span> <span class="n">num_items</span><span class="p">)</span>
<span class="n">criterion</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">BCEWithLogitsLoss</span><span class="p">()</span>
<span class="n">optimizer</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">optim</span><span class="o">.</span><span class="n">Adam</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="p">())</span>
<span class="n">scheduler</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">optim</span><span class="o">.</span><span class="n">lr_scheduler</span><span class="o">.</span><span class="n">MultiStepLR</span><span class="p">(</span><span class="n">optimizer</span><span class="p">,</span> <span class="p">[</span><span class="mi">2</span><span class="p">])</span>

<span class="c1"># model training</span>
<span class="n">runner</span> <span class="o">=</span> <span class="n">dl</span><span class="o">.</span><span class="n">SupervisedRunner</span><span class="p">(</span>
    <span class="n">input_key</span><span class="o">=</span><span class="s2">&quot;features&quot;</span><span class="p">,</span> <span class="n">output_key</span><span class="o">=</span><span class="s2">&quot;logits&quot;</span><span class="p">,</span> <span class="n">target_key</span><span class="o">=</span><span class="s2">&quot;targets&quot;</span><span class="p">,</span> <span class="n">loss_key</span><span class="o">=</span><span class="s2">&quot;loss&quot;</span>
<span class="p">)</span>
<span class="n">runner</span><span class="o">.</span><span class="n">train</span><span class="p">(</span>
    <span class="n">model</span><span class="o">=</span><span class="n">model</span><span class="p">,</span>
    <span class="n">criterion</span><span class="o">=</span><span class="n">criterion</span><span class="p">,</span>
    <span class="n">optimizer</span><span class="o">=</span><span class="n">optimizer</span><span class="p">,</span>
    <span class="n">scheduler</span><span class="o">=</span><span class="n">scheduler</span><span class="p">,</span>
    <span class="n">loaders</span><span class="o">=</span><span class="n">loaders</span><span class="p">,</span>
    <span class="n">num_epochs</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
    <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">callbacks</span><span class="o">=</span><span class="p">[</span>
        <span class="n">dl</span><span class="o">.</span><span class="n">BatchTransformCallback</span><span class="p">(</span>
            <span class="n">transform</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">sigmoid</span><span class="p">,</span>
            <span class="n">scope</span><span class="o">=</span><span class="s2">&quot;on_batch_end&quot;</span><span class="p">,</span>
            <span class="n">input_key</span><span class="o">=</span><span class="s2">&quot;logits&quot;</span><span class="p">,</span>
            <span class="n">output_key</span><span class="o">=</span><span class="s2">&quot;scores&quot;</span>
        <span class="p">),</span>
        <span class="n">dl</span><span class="o">.</span><span class="n">CriterionCallback</span><span class="p">(</span>
            <span class="n">input_key</span><span class="o">=</span><span class="s2">&quot;logits&quot;</span><span class="p">,</span> <span class="n">target_key</span><span class="o">=</span><span class="s2">&quot;targets&quot;</span><span class="p">,</span> <span class="n">metric_key</span><span class="o">=</span><span class="s2">&quot;loss&quot;</span>
        <span class="p">),</span>
        <span class="n">dl</span><span class="o">.</span><span class="n">AUCCallback</span><span class="p">(</span><span class="n">input_key</span><span class="o">=</span><span class="s2">&quot;scores&quot;</span><span class="p">,</span> <span class="n">target_key</span><span class="o">=</span><span class="s2">&quot;targets&quot;</span><span class="p">),</span>
        <span class="n">dl</span><span class="o">.</span><span class="n">HitrateCallback</span><span class="p">(</span>
            <span class="n">input_key</span><span class="o">=</span><span class="s2">&quot;scores&quot;</span><span class="p">,</span> <span class="n">target_key</span><span class="o">=</span><span class="s2">&quot;targets&quot;</span><span class="p">,</span> <span class="n">topk_args</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
        <span class="p">),</span>
        <span class="n">dl</span><span class="o">.</span><span class="n">MRRCallback</span><span class="p">(</span><span class="n">input_key</span><span class="o">=</span><span class="s2">&quot;scores&quot;</span><span class="p">,</span> <span class="n">target_key</span><span class="o">=</span><span class="s2">&quot;targets&quot;</span><span class="p">,</span> <span class="n">topk_args</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">)),</span>
        <span class="n">dl</span><span class="o">.</span><span class="n">MAPCallback</span><span class="p">(</span><span class="n">input_key</span><span class="o">=</span><span class="s2">&quot;scores&quot;</span><span class="p">,</span> <span class="n">target_key</span><span class="o">=</span><span class="s2">&quot;targets&quot;</span><span class="p">,</span> <span class="n">topk_args</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">)),</span>
        <span class="n">dl</span><span class="o">.</span><span class="n">NDCGCallback</span><span class="p">(</span><span class="n">input_key</span><span class="o">=</span><span class="s2">&quot;scores&quot;</span><span class="p">,</span> <span class="n">target_key</span><span class="o">=</span><span class="s2">&quot;targets&quot;</span><span class="p">,</span> <span class="n">topk_args</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">)),</span>
        <span class="n">dl</span><span class="o">.</span><span class="n">OptimizerCallback</span><span class="p">(</span><span class="n">metric_key</span><span class="o">=</span><span class="s2">&quot;loss&quot;</span><span class="p">),</span>
        <span class="n">dl</span><span class="o">.</span><span class="n">SchedulerCallback</span><span class="p">(),</span>
        <span class="n">dl</span><span class="o">.</span><span class="n">CheckpointCallback</span><span class="p">(</span>
            <span class="n">logdir</span><span class="o">=</span><span class="s2">&quot;./logs&quot;</span><span class="p">,</span> <span class="n">loader_key</span><span class="o">=</span><span class="s2">&quot;valid&quot;</span><span class="p">,</span> <span class="n">metric_key</span><span class="o">=</span><span class="s2">&quot;loss&quot;</span><span class="p">,</span> <span class="n">minimize</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">),</span>
    <span class="p">]</span>
<span class="p">)</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Metric names depending on input parameters:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">topk_args</span> <span class="pre">=</span> <span class="pre">(1,)</span> <span class="pre">or</span> <span class="pre">None</span></code> —&gt; <code class="docutils literal notranslate"><span class="pre">&quot;hitrate01&quot;</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">topk_args</span> <span class="pre">=</span> <span class="pre">(1,</span> <span class="pre">3)</span></code> —&gt; <code class="docutils literal notranslate"><span class="pre">&quot;hitrate01&quot;</span></code>, <code class="docutils literal notranslate"><span class="pre">&quot;hitrate03&quot;</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">topk_args</span> <span class="pre">=</span> <span class="pre">(1,</span> <span class="pre">3,</span> <span class="pre">5)</span></code> —&gt; <code class="docutils literal notranslate"><span class="pre">&quot;hitrate01&quot;</span></code>, <code class="docutils literal notranslate"><span class="pre">&quot;hitrate03&quot;</span></code>, <code class="docutils literal notranslate"><span class="pre">&quot;hitrate05&quot;</span></code></p></li>
</ul>
<p>You can find them in <code class="docutils literal notranslate"><span class="pre">runner.batch_metrics</span></code>, <code class="docutils literal notranslate"><span class="pre">runner.loader_metrics</span></code> or
<code class="docutils literal notranslate"><span class="pre">runner.epoch_metrics</span></code>.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Please follow the <a class="reference external" href="https://github.com/catalyst-team/catalyst#minimal-examples">minimal examples</a> sections for more use cases.</p>
</div>
</dd></dl>

</section>
<section id="ioumetric">
<h3><a class="toc-backref" href="#id33">IOUMetric</a><a class="headerlink" href="#ioumetric" title="Permalink to this headline">¶</a></h3>
<dl class="class">
<dt id="catalyst.metrics._segmentation.IOUMetric">
<em class="property">class </em><code class="sig-prename descclassname">catalyst.metrics._segmentation.</code><code class="sig-name descname">IOUMetric</code><span class="sig-paren">(</span><em class="sig-param">class_dim: int = 1</em>, <em class="sig-param">weights: Optional[List[float]] = None</em>, <em class="sig-param">class_names: Optional[List[str]] = None</em>, <em class="sig-param">threshold: Optional[float] = None</em>, <em class="sig-param">eps: float = 1e-07</em>, <em class="sig-param">compute_on_call: bool = True</em>, <em class="sig-param">compute_per_class_metrics: bool = False</em>, <em class="sig-param">prefix: Optional[str] = None</em>, <em class="sig-param">suffix: Optional[str] = None</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/catalyst/metrics/_segmentation.html#IOUMetric"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#catalyst.metrics._segmentation.IOUMetric" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#catalyst.metrics._segmentation.RegionBasedMetric" title="catalyst.metrics._segmentation.RegionBasedMetric"><code class="xref py py-class docutils literal notranslate"><span class="pre">catalyst.metrics._segmentation.RegionBasedMetric</span></code></a></p>
<p>IoU Metric,
iou score = intersection / union = tp / (tp + fp + fn).</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>class_dim</strong> – indicates class dimension (K) for <code class="docutils literal notranslate"><span class="pre">outputs</span></code> and
<code class="docutils literal notranslate"><span class="pre">targets</span></code> tensors (default = 1)</p></li>
<li><p><strong>weights</strong> – class weights</p></li>
<li><p><strong>class_names</strong> – class names</p></li>
<li><p><strong>threshold</strong> – threshold for outputs binarization</p></li>
<li><p><strong>eps</strong> – epsilon to avoid zero division</p></li>
<li><p><strong>compute_on_call</strong> – Computes and returns metric value during metric call.
Used for per-batch logging. default: True</p></li>
<li><p><strong>compute_per_class_metrics</strong> – boolean flag to compute per-class metrics
(default: SETTINGS.compute_per_class_metrics or False).</p></li>
<li><p><strong>prefix</strong> – metric prefix</p></li>
<li><p><strong>suffix</strong> – metric suffix</p></li>
</ul>
</dd>
</dl>
<p>Examples:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">torch</span>
<span class="kn">from</span> <span class="nn">catalyst</span> <span class="kn">import</span> <span class="n">metrics</span>

<span class="n">outputs</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([[[[</span><span class="mf">0.8</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]]]])</span>
<span class="n">targets</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([[[[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]]]])</span>
<span class="n">metric</span> <span class="o">=</span> <span class="n">metrics</span><span class="o">.</span><span class="n">IOUMetric</span><span class="p">()</span>
<span class="n">metric</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>

<span class="n">metric</span><span class="o">.</span><span class="n">compute</span><span class="p">()</span>
<span class="c1"># per_class, micro, macro, weighted</span>
<span class="c1"># ([tensor(0.2222)], tensor(0.2222), tensor(0.2222), None)</span>

<span class="n">metric</span><span class="o">.</span><span class="n">update_key_value</span><span class="p">(</span><span class="n">outputs</span><span class="p">,</span> <span class="n">targets</span><span class="p">)</span>
<span class="n">metric</span><span class="o">.</span><span class="n">compute_key_value</span><span class="p">()</span>
<span class="c1"># {</span>
<span class="c1">#     &#39;iou&#39;: tensor(0.2222),</span>
<span class="c1">#     &#39;iou/_macro&#39;: tensor(0.2222),</span>
<span class="c1">#     &#39;iou/_micro&#39;: tensor(0.2222),</span>
<span class="c1">#     &#39;iou/class_00&#39;: tensor(0.2222),</span>
<span class="c1"># }</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">torch</span>
<span class="kn">from</span> <span class="nn">torch</span> <span class="kn">import</span> <span class="n">nn</span>
<span class="kn">from</span> <span class="nn">torch.utils.data</span> <span class="kn">import</span> <span class="n">DataLoader</span>
<span class="kn">from</span> <span class="nn">catalyst</span> <span class="kn">import</span> <span class="n">dl</span>
<span class="kn">from</span> <span class="nn">catalyst.contrib</span> <span class="kn">import</span> <span class="n">IoULoss</span><span class="p">,</span> <span class="n">MNIST</span>

<span class="n">model</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Sequential</span><span class="p">(</span>
    <span class="n">nn</span><span class="o">.</span><span class="n">Conv2d</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">nn</span><span class="o">.</span><span class="n">ReLU</span><span class="p">(),</span>
    <span class="n">nn</span><span class="o">.</span><span class="n">Conv2d</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">nn</span><span class="o">.</span><span class="n">Sigmoid</span><span class="p">(),</span>
<span class="p">)</span>
<span class="n">criterion</span> <span class="o">=</span> <span class="n">IoULoss</span><span class="p">()</span>
<span class="n">optimizer</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">optim</span><span class="o">.</span><span class="n">Adam</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="p">(),</span> <span class="n">lr</span><span class="o">=</span><span class="mf">0.02</span><span class="p">)</span>

<span class="n">loaders</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;train&quot;</span><span class="p">:</span> <span class="n">DataLoader</span><span class="p">(</span>
        <span class="n">MNIST</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">(),</span> <span class="n">train</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
        <span class="n">batch_size</span><span class="o">=</span><span class="mi">32</span>
    <span class="p">),</span>
    <span class="s2">&quot;valid&quot;</span><span class="p">:</span> <span class="n">DataLoader</span><span class="p">(</span>
        <span class="n">MNIST</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">(),</span> <span class="n">train</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span>
        <span class="n">batch_size</span><span class="o">=</span><span class="mi">32</span>
    <span class="p">),</span>
<span class="p">}</span>

<span class="k">class</span> <span class="nc">CustomRunner</span><span class="p">(</span><span class="n">dl</span><span class="o">.</span><span class="n">SupervisedRunner</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">handle_batch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">batch</span><span class="p">):</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">batch</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_input_key</span><span class="p">]</span>
        <span class="n">x_noise</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="n">torch</span><span class="o">.</span><span class="n">rand_like</span><span class="p">(</span><span class="n">x</span><span class="p">))</span><span class="o">.</span><span class="n">clamp_</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">x_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">(</span><span class="n">x_noise</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">batch</span> <span class="o">=</span> <span class="p">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_input_key</span><span class="p">:</span> <span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_output_key</span><span class="p">:</span> <span class="n">x_</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_target_key</span><span class="p">:</span> <span class="n">x</span><span class="p">}</span>

<span class="n">runner</span> <span class="o">=</span> <span class="n">CustomRunner</span><span class="p">(</span>
    <span class="n">input_key</span><span class="o">=</span><span class="s2">&quot;features&quot;</span><span class="p">,</span> <span class="n">output_key</span><span class="o">=</span><span class="s2">&quot;scores&quot;</span><span class="p">,</span> <span class="n">target_key</span><span class="o">=</span><span class="s2">&quot;targets&quot;</span><span class="p">,</span> <span class="n">loss_key</span><span class="o">=</span><span class="s2">&quot;loss&quot;</span>
<span class="p">)</span>
<span class="c1"># model training</span>
<span class="n">runner</span><span class="o">.</span><span class="n">train</span><span class="p">(</span>
    <span class="n">model</span><span class="o">=</span><span class="n">model</span><span class="p">,</span>
    <span class="n">criterion</span><span class="o">=</span><span class="n">criterion</span><span class="p">,</span>
    <span class="n">optimizer</span><span class="o">=</span><span class="n">optimizer</span><span class="p">,</span>
    <span class="n">loaders</span><span class="o">=</span><span class="n">loaders</span><span class="p">,</span>
    <span class="n">num_epochs</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">callbacks</span><span class="o">=</span><span class="p">[</span>
        <span class="n">dl</span><span class="o">.</span><span class="n">IOUCallback</span><span class="p">(</span><span class="n">input_key</span><span class="o">=</span><span class="s2">&quot;scores&quot;</span><span class="p">,</span> <span class="n">target_key</span><span class="o">=</span><span class="s2">&quot;targets&quot;</span><span class="p">),</span>
        <span class="n">dl</span><span class="o">.</span><span class="n">DiceCallback</span><span class="p">(</span><span class="n">input_key</span><span class="o">=</span><span class="s2">&quot;scores&quot;</span><span class="p">,</span> <span class="n">target_key</span><span class="o">=</span><span class="s2">&quot;targets&quot;</span><span class="p">),</span>
        <span class="n">dl</span><span class="o">.</span><span class="n">TrevskyCallback</span><span class="p">(</span><span class="n">input_key</span><span class="o">=</span><span class="s2">&quot;scores&quot;</span><span class="p">,</span> <span class="n">target_key</span><span class="o">=</span><span class="s2">&quot;targets&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">),</span>
    <span class="p">],</span>
    <span class="n">logdir</span><span class="o">=</span><span class="s2">&quot;./logdir&quot;</span><span class="p">,</span>
    <span class="n">valid_loader</span><span class="o">=</span><span class="s2">&quot;valid&quot;</span><span class="p">,</span>
    <span class="n">valid_metric</span><span class="o">=</span><span class="s2">&quot;loss&quot;</span><span class="p">,</span>
    <span class="n">minimize_valid_metric</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Please follow the <a class="reference external" href="https://github.com/catalyst-team/catalyst#minimal-examples">minimal examples</a> sections for more use cases.</p>
</div>
</dd></dl>

</section>
<section id="mapmetric">
<h3><a class="toc-backref" href="#id34">MAPMetric</a><a class="headerlink" href="#mapmetric" title="Permalink to this headline">¶</a></h3>
<dl class="class">
<dt id="catalyst.metrics._map.MAPMetric">
<em class="property">class </em><code class="sig-prename descclassname">catalyst.metrics._map.</code><code class="sig-name descname">MAPMetric</code><span class="sig-paren">(</span><em class="sig-param">topk_args: Iterable[int] = None</em>, <em class="sig-param">compute_on_call: bool = True</em>, <em class="sig-param">prefix: str = None</em>, <em class="sig-param">suffix: str = None</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/catalyst/metrics/_map.html#MAPMetric"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#catalyst.metrics._map.MAPMetric" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#catalyst.metrics._topk_metric.TopKMetric" title="catalyst.metrics._topk_metric.TopKMetric"><code class="xref py py-class docutils literal notranslate"><span class="pre">catalyst.metrics._topk_metric.TopKMetric</span></code></a></p>
<p>Calculates the Mean Average Precision (MAP) for RecSys.
The precision metric summarizes the fraction of relevant items
out of the whole the recommendation list.
Computes mean value of MAP and it’s approximate std value</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>topk_args</strong> – list of <cite>topk</cite> for <a class="reference external" href="mailto:map&#37;&#52;&#48;topk">map<span>&#64;</span>topk</a> computing</p></li>
<li><p><strong>compute_on_call</strong> – if True, computes and returns metric value during metric call</p></li>
<li><p><strong>prefix</strong> – metric prefix</p></li>
<li><p><strong>suffix</strong> – metric suffix</p></li>
</ul>
</dd>
</dl>
<p>Examples:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">torch</span>
<span class="kn">from</span> <span class="nn">catalyst</span> <span class="kn">import</span> <span class="n">metrics</span>

<span class="n">outputs</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([</span>
    <span class="p">[</span><span class="mi">9</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
    <span class="p">[</span><span class="mi">9</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
<span class="p">])</span>
<span class="n">targets</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([</span>
    <span class="p">[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">],</span>
    <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">],</span>
<span class="p">])</span>
<span class="n">metric</span> <span class="o">=</span> <span class="n">metrics</span><span class="o">.</span><span class="n">MAPMetric</span><span class="p">(</span><span class="n">topk_args</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">])</span>
<span class="n">metric</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>

<span class="n">metric</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">outputs</span><span class="p">,</span> <span class="n">targets</span><span class="p">)</span>
<span class="n">metric</span><span class="o">.</span><span class="n">compute</span><span class="p">()</span>
<span class="c1"># (</span>
<span class="c1">#     # mean for @01, @03, @05, @10</span>
<span class="c1">#     (0.5, 0.6666666865348816, 0.6416666507720947, 0.5325397253036499),</span>
<span class="c1">#     # std for @01, @03, @05, @10</span>
<span class="c1">#     (0.0, 0.0, 0.0, 0.0)</span>
<span class="c1"># )</span>

<span class="n">metric</span><span class="o">.</span><span class="n">compute_key_value</span><span class="p">()</span>
<span class="c1"># {</span>
<span class="c1">#     &#39;map01&#39;: 0.5,</span>
<span class="c1">#     &#39;map01/std&#39;: 0.0,</span>
<span class="c1">#     &#39;map03&#39;: 0.6666666865348816,</span>
<span class="c1">#     &#39;map03/std&#39;: 0.0,</span>
<span class="c1">#     &#39;map05&#39;: 0.6416666507720947,</span>
<span class="c1">#     &#39;map05/std&#39;: 0.0,</span>
<span class="c1">#     &#39;map10&#39;: 0.5325397253036499,</span>
<span class="c1">#     &#39;map10/std&#39;: 0.0</span>
<span class="c1"># }</span>

<span class="n">metric</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
<span class="n">metric</span><span class="p">(</span><span class="n">outputs</span><span class="p">,</span> <span class="n">targets</span><span class="p">)</span>
<span class="c1"># (</span>
<span class="c1">#     # mean for @01, @03, @05, @10</span>
<span class="c1">#     (0.5, 0.6666666865348816, 0.6416666507720947, 0.5325397253036499),</span>
<span class="c1">#     # std for @01, @03, @05, @10</span>
<span class="c1">#     (0.0, 0.0, 0.0, 0.0)</span>
<span class="c1"># )</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">torch</span>
<span class="kn">from</span> <span class="nn">torch.utils.data</span> <span class="kn">import</span> <span class="n">DataLoader</span><span class="p">,</span> <span class="n">TensorDataset</span>
<span class="kn">from</span> <span class="nn">catalyst</span> <span class="kn">import</span> <span class="n">dl</span>

<span class="c1"># sample data</span>
<span class="n">num_users</span><span class="p">,</span> <span class="n">num_features</span><span class="p">,</span> <span class="n">num_items</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mf">1e4</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="mf">1e1</span><span class="p">),</span> <span class="mi">10</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="n">num_users</span><span class="p">,</span> <span class="n">num_features</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="n">num_users</span><span class="p">,</span> <span class="n">num_items</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mf">0.5</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>

<span class="c1"># pytorch loaders</span>
<span class="n">dataset</span> <span class="o">=</span> <span class="n">TensorDataset</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
<span class="n">loader</span> <span class="o">=</span> <span class="n">DataLoader</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="mi">32</span><span class="p">,</span> <span class="n">num_workers</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">loaders</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;train&quot;</span><span class="p">:</span> <span class="n">loader</span><span class="p">,</span> <span class="s2">&quot;valid&quot;</span><span class="p">:</span> <span class="n">loader</span><span class="p">}</span>

<span class="c1"># model, criterion, optimizer, scheduler</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="n">num_features</span><span class="p">,</span> <span class="n">num_items</span><span class="p">)</span>
<span class="n">criterion</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">BCEWithLogitsLoss</span><span class="p">()</span>
<span class="n">optimizer</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">optim</span><span class="o">.</span><span class="n">Adam</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="p">())</span>
<span class="n">scheduler</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">optim</span><span class="o">.</span><span class="n">lr_scheduler</span><span class="o">.</span><span class="n">MultiStepLR</span><span class="p">(</span><span class="n">optimizer</span><span class="p">,</span> <span class="p">[</span><span class="mi">2</span><span class="p">])</span>

<span class="c1"># model training</span>
<span class="n">runner</span> <span class="o">=</span> <span class="n">dl</span><span class="o">.</span><span class="n">SupervisedRunner</span><span class="p">(</span>
    <span class="n">input_key</span><span class="o">=</span><span class="s2">&quot;features&quot;</span><span class="p">,</span> <span class="n">output_key</span><span class="o">=</span><span class="s2">&quot;logits&quot;</span><span class="p">,</span> <span class="n">target_key</span><span class="o">=</span><span class="s2">&quot;targets&quot;</span><span class="p">,</span> <span class="n">loss_key</span><span class="o">=</span><span class="s2">&quot;loss&quot;</span>
<span class="p">)</span>
<span class="n">runner</span><span class="o">.</span><span class="n">train</span><span class="p">(</span>
    <span class="n">model</span><span class="o">=</span><span class="n">model</span><span class="p">,</span>
    <span class="n">criterion</span><span class="o">=</span><span class="n">criterion</span><span class="p">,</span>
    <span class="n">optimizer</span><span class="o">=</span><span class="n">optimizer</span><span class="p">,</span>
    <span class="n">scheduler</span><span class="o">=</span><span class="n">scheduler</span><span class="p">,</span>
    <span class="n">loaders</span><span class="o">=</span><span class="n">loaders</span><span class="p">,</span>
    <span class="n">num_epochs</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
    <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">callbacks</span><span class="o">=</span><span class="p">[</span>
        <span class="n">dl</span><span class="o">.</span><span class="n">BatchTransformCallback</span><span class="p">(</span>
            <span class="n">transform</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">sigmoid</span><span class="p">,</span>
            <span class="n">scope</span><span class="o">=</span><span class="s2">&quot;on_batch_end&quot;</span><span class="p">,</span>
            <span class="n">input_key</span><span class="o">=</span><span class="s2">&quot;logits&quot;</span><span class="p">,</span>
            <span class="n">output_key</span><span class="o">=</span><span class="s2">&quot;scores&quot;</span>
        <span class="p">),</span>
        <span class="n">dl</span><span class="o">.</span><span class="n">CriterionCallback</span><span class="p">(</span>
            <span class="n">input_key</span><span class="o">=</span><span class="s2">&quot;logits&quot;</span><span class="p">,</span> <span class="n">target_key</span><span class="o">=</span><span class="s2">&quot;targets&quot;</span><span class="p">,</span> <span class="n">metric_key</span><span class="o">=</span><span class="s2">&quot;loss&quot;</span>
        <span class="p">),</span>
        <span class="n">dl</span><span class="o">.</span><span class="n">AUCCallback</span><span class="p">(</span><span class="n">input_key</span><span class="o">=</span><span class="s2">&quot;scores&quot;</span><span class="p">,</span> <span class="n">target_key</span><span class="o">=</span><span class="s2">&quot;targets&quot;</span><span class="p">),</span>
        <span class="n">dl</span><span class="o">.</span><span class="n">HitrateCallback</span><span class="p">(</span>
            <span class="n">input_key</span><span class="o">=</span><span class="s2">&quot;scores&quot;</span><span class="p">,</span> <span class="n">target_key</span><span class="o">=</span><span class="s2">&quot;targets&quot;</span><span class="p">,</span> <span class="n">topk_args</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
        <span class="p">),</span>
        <span class="n">dl</span><span class="o">.</span><span class="n">MRRCallback</span><span class="p">(</span><span class="n">input_key</span><span class="o">=</span><span class="s2">&quot;scores&quot;</span><span class="p">,</span> <span class="n">target_key</span><span class="o">=</span><span class="s2">&quot;targets&quot;</span><span class="p">,</span> <span class="n">topk_args</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">)),</span>
        <span class="n">dl</span><span class="o">.</span><span class="n">MAPCallback</span><span class="p">(</span><span class="n">input_key</span><span class="o">=</span><span class="s2">&quot;scores&quot;</span><span class="p">,</span> <span class="n">target_key</span><span class="o">=</span><span class="s2">&quot;targets&quot;</span><span class="p">,</span> <span class="n">topk_args</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">)),</span>
        <span class="n">dl</span><span class="o">.</span><span class="n">NDCGCallback</span><span class="p">(</span><span class="n">input_key</span><span class="o">=</span><span class="s2">&quot;scores&quot;</span><span class="p">,</span> <span class="n">target_key</span><span class="o">=</span><span class="s2">&quot;targets&quot;</span><span class="p">,</span> <span class="n">topk_args</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">)),</span>
        <span class="n">dl</span><span class="o">.</span><span class="n">OptimizerCallback</span><span class="p">(</span><span class="n">metric_key</span><span class="o">=</span><span class="s2">&quot;loss&quot;</span><span class="p">),</span>
        <span class="n">dl</span><span class="o">.</span><span class="n">SchedulerCallback</span><span class="p">(),</span>
        <span class="n">dl</span><span class="o">.</span><span class="n">CheckpointCallback</span><span class="p">(</span>
            <span class="n">logdir</span><span class="o">=</span><span class="s2">&quot;./logs&quot;</span><span class="p">,</span> <span class="n">loader_key</span><span class="o">=</span><span class="s2">&quot;valid&quot;</span><span class="p">,</span> <span class="n">metric_key</span><span class="o">=</span><span class="s2">&quot;loss&quot;</span><span class="p">,</span> <span class="n">minimize</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">),</span>
    <span class="p">]</span>
<span class="p">)</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Metric names depending on input parameters:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">topk_args</span> <span class="pre">=</span> <span class="pre">(1,)</span> <span class="pre">or</span> <span class="pre">None</span></code> —&gt; <code class="docutils literal notranslate"><span class="pre">&quot;map01&quot;</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">topk_args</span> <span class="pre">=</span> <span class="pre">(1,</span> <span class="pre">3)</span></code> —&gt; <code class="docutils literal notranslate"><span class="pre">&quot;map01&quot;</span></code>, <code class="docutils literal notranslate"><span class="pre">&quot;map03&quot;</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">topk_args</span> <span class="pre">=</span> <span class="pre">(1,</span> <span class="pre">3,</span> <span class="pre">5)</span></code> —&gt; <code class="docutils literal notranslate"><span class="pre">&quot;map01&quot;</span></code>, <code class="docutils literal notranslate"><span class="pre">&quot;map03&quot;</span></code>, <code class="docutils literal notranslate"><span class="pre">&quot;map05&quot;</span></code></p></li>
</ul>
<p>You can find them in <code class="docutils literal notranslate"><span class="pre">runner.batch_metrics</span></code>, <code class="docutils literal notranslate"><span class="pre">runner.loader_metrics</span></code> or
<code class="docutils literal notranslate"><span class="pre">runner.epoch_metrics</span></code>.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Please follow the <a class="reference external" href="https://github.com/catalyst-team/catalyst#minimal-examples">minimal examples</a> sections for more use cases.</p>
</div>
</dd></dl>

</section>
<section id="multiclassprecisionrecallf1supportmetric">
<h3><a class="toc-backref" href="#id35">MulticlassPrecisionRecallF1SupportMetric</a><a class="headerlink" href="#multiclassprecisionrecallf1supportmetric" title="Permalink to this headline">¶</a></h3>
<dl class="class">
<dt id="catalyst.metrics._classification.MulticlassPrecisionRecallF1SupportMetric">
<em class="property">class </em><code class="sig-prename descclassname">catalyst.metrics._classification.</code><code class="sig-name descname">MulticlassPrecisionRecallF1SupportMetric</code><span class="sig-paren">(</span><em class="sig-param">zero_division: int = 0</em>, <em class="sig-param">compute_on_call: bool = True</em>, <em class="sig-param">compute_per_class_metrics: bool = False</em>, <em class="sig-param">prefix: str = None</em>, <em class="sig-param">suffix: str = None</em>, <em class="sig-param">num_classes: Optional[int] = None</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/catalyst/metrics/_classification.html#MulticlassPrecisionRecallF1SupportMetric"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#catalyst.metrics._classification.MulticlassPrecisionRecallF1SupportMetric" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">catalyst.metrics._classification.MulticlassStatisticsMetric</span></code></p>
<p>Metric that can collect statistics and count precision, recall, f1_score and support with it.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>zero_division</strong> – value to set in case of zero division during metrics
(precision, recall) computation; should be one of 0 or 1</p></li>
<li><p><strong>compute_on_call</strong> – if True, allows compute metric’s value on call</p></li>
<li><p><strong>compute_per_class_metrics</strong> – boolean flag to compute per-class metrics
(default: SETTINGS.compute_per_class_metrics or False).</p></li>
<li><p><strong>prefix</strong> – metrics prefix</p></li>
<li><p><strong>suffix</strong> – metrics suffix</p></li>
<li><p><strong>num_classes</strong> – number of classes</p></li>
</ul>
</dd>
</dl>
</dd></dl>

</section>
<section id="multilabelaccuracymetric">
<h3><a class="toc-backref" href="#id36">MultilabelAccuracyMetric</a><a class="headerlink" href="#multilabelaccuracymetric" title="Permalink to this headline">¶</a></h3>
<dl class="class">
<dt id="catalyst.metrics._accuracy.MultilabelAccuracyMetric">
<em class="property">class </em><code class="sig-prename descclassname">catalyst.metrics._accuracy.</code><code class="sig-name descname">MultilabelAccuracyMetric</code><span class="sig-paren">(</span><em class="sig-param">threshold: Union[float</em>, <em class="sig-param">torch.Tensor] = 0.5</em>, <em class="sig-param">compute_on_call: bool = True</em>, <em class="sig-param">prefix: Optional[str] = None</em>, <em class="sig-param">suffix: Optional[str] = None</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/catalyst/metrics/_accuracy.html#MultilabelAccuracyMetric"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#catalyst.metrics._accuracy.MultilabelAccuracyMetric" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#catalyst.metrics._additive.AdditiveMetric" title="catalyst.metrics._additive.AdditiveMetric"><code class="xref py py-class docutils literal notranslate"><span class="pre">catalyst.metrics._additive.AdditiveMetric</span></code></a>, <a class="reference internal" href="#catalyst.metrics._metric.ICallbackBatchMetric" title="catalyst.metrics._metric.ICallbackBatchMetric"><code class="xref py py-class docutils literal notranslate"><span class="pre">catalyst.metrics._metric.ICallbackBatchMetric</span></code></a></p>
<p>This metric computes accuracy for multilabel classification case.
It computes mean value of accuracy and it’s approximate std value
(note that it’s not a real accuracy std but std of accuracy over batch mean values).</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>compute_on_call</strong> – if True, computes and returns metric value during metric call</p></li>
<li><p><strong>prefix</strong> – metric prefix</p></li>
<li><p><strong>suffix</strong> – metric suffix</p></li>
<li><p><strong>threshold</strong> – thresholds for model scores</p></li>
</ul>
</dd>
</dl>
<p>Examples:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">torch</span>
<span class="kn">from</span> <span class="nn">catalyst</span> <span class="kn">import</span> <span class="n">metrics</span>

<span class="n">outputs</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([</span>
    <span class="p">[</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">],</span>
    <span class="p">[</span><span class="mf">0.96</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.85</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">],</span>
    <span class="p">[</span><span class="mf">0.98</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">],</span>
    <span class="p">[</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.89</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">],</span>
<span class="p">])</span>
<span class="n">targets</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([</span>
    <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
    <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
    <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
    <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
<span class="p">])</span>
<span class="n">metric</span> <span class="o">=</span> <span class="n">metrics</span><span class="o">.</span><span class="n">MultilabelAccuracyMetric</span><span class="p">(</span><span class="n">threshold</span><span class="o">=</span><span class="mf">0.6</span><span class="p">)</span>

<span class="n">metric</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
<span class="n">metric</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">outputs</span><span class="p">,</span> <span class="n">targets</span><span class="p">)</span>
<span class="n">metric</span><span class="o">.</span><span class="n">compute</span><span class="p">()</span>
<span class="c1"># (0.75, 0.0)  # mean, std</span>

<span class="n">metric</span><span class="o">.</span><span class="n">compute_key_value</span><span class="p">()</span>
<span class="c1"># {</span>
<span class="c1">#     &#39;accuracy&#39;: 0.75,</span>
<span class="c1">#     &#39;accuracy/std&#39;: 0.0,</span>
<span class="c1"># }</span>

<span class="n">metric</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
<span class="n">metric</span><span class="p">(</span><span class="n">outputs</span><span class="p">,</span> <span class="n">targets</span><span class="p">)</span>
<span class="c1"># (0.75, 0.0)  # mean, std</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">torch</span>
<span class="kn">from</span> <span class="nn">torch.utils.data</span> <span class="kn">import</span> <span class="n">DataLoader</span><span class="p">,</span> <span class="n">TensorDataset</span>
<span class="kn">from</span> <span class="nn">catalyst</span> <span class="kn">import</span> <span class="n">dl</span>

<span class="c1"># sample data</span>
<span class="n">num_samples</span><span class="p">,</span> <span class="n">num_features</span><span class="p">,</span> <span class="n">num_classes</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mf">1e4</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="mf">1e1</span><span class="p">),</span> <span class="mi">4</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="n">num_samples</span><span class="p">,</span> <span class="n">num_features</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="n">num_samples</span><span class="p">,</span> <span class="n">num_classes</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mf">0.5</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>

<span class="c1"># pytorch loaders</span>
<span class="n">dataset</span> <span class="o">=</span> <span class="n">TensorDataset</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
<span class="n">loader</span> <span class="o">=</span> <span class="n">DataLoader</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="mi">32</span><span class="p">,</span> <span class="n">num_workers</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">loaders</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;train&quot;</span><span class="p">:</span> <span class="n">loader</span><span class="p">,</span> <span class="s2">&quot;valid&quot;</span><span class="p">:</span> <span class="n">loader</span><span class="p">}</span>

<span class="c1"># model, criterion, optimizer, scheduler</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="n">num_features</span><span class="p">,</span> <span class="n">num_classes</span><span class="p">)</span>
<span class="n">criterion</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">BCEWithLogitsLoss</span><span class="p">()</span>
<span class="n">optimizer</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">optim</span><span class="o">.</span><span class="n">Adam</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="p">())</span>
<span class="n">scheduler</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">optim</span><span class="o">.</span><span class="n">lr_scheduler</span><span class="o">.</span><span class="n">MultiStepLR</span><span class="p">(</span><span class="n">optimizer</span><span class="p">,</span> <span class="p">[</span><span class="mi">2</span><span class="p">])</span>

<span class="c1"># model training</span>
<span class="n">runner</span> <span class="o">=</span> <span class="n">dl</span><span class="o">.</span><span class="n">SupervisedRunner</span><span class="p">(</span>
    <span class="n">input_key</span><span class="o">=</span><span class="s2">&quot;features&quot;</span><span class="p">,</span> <span class="n">output_key</span><span class="o">=</span><span class="s2">&quot;logits&quot;</span><span class="p">,</span> <span class="n">target_key</span><span class="o">=</span><span class="s2">&quot;targets&quot;</span><span class="p">,</span> <span class="n">loss_key</span><span class="o">=</span><span class="s2">&quot;loss&quot;</span>
<span class="p">)</span>
<span class="n">runner</span><span class="o">.</span><span class="n">train</span><span class="p">(</span>
    <span class="n">model</span><span class="o">=</span><span class="n">model</span><span class="p">,</span>
    <span class="n">criterion</span><span class="o">=</span><span class="n">criterion</span><span class="p">,</span>
    <span class="n">optimizer</span><span class="o">=</span><span class="n">optimizer</span><span class="p">,</span>
    <span class="n">scheduler</span><span class="o">=</span><span class="n">scheduler</span><span class="p">,</span>
    <span class="n">loaders</span><span class="o">=</span><span class="n">loaders</span><span class="p">,</span>
    <span class="n">logdir</span><span class="o">=</span><span class="s2">&quot;./logdir&quot;</span><span class="p">,</span>
    <span class="n">num_epochs</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
    <span class="n">valid_loader</span><span class="o">=</span><span class="s2">&quot;valid&quot;</span><span class="p">,</span>
    <span class="n">valid_metric</span><span class="o">=</span><span class="s2">&quot;accuracy&quot;</span><span class="p">,</span>
    <span class="n">minimize_valid_metric</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">callbacks</span><span class="o">=</span><span class="p">[</span>
        <span class="n">dl</span><span class="o">.</span><span class="n">AUCCallback</span><span class="p">(</span><span class="n">input_key</span><span class="o">=</span><span class="s2">&quot;logits&quot;</span><span class="p">,</span> <span class="n">target_key</span><span class="o">=</span><span class="s2">&quot;targets&quot;</span><span class="p">),</span>
        <span class="n">dl</span><span class="o">.</span><span class="n">MultilabelAccuracyCallback</span><span class="p">(</span>
            <span class="n">input_key</span><span class="o">=</span><span class="s2">&quot;logits&quot;</span><span class="p">,</span> <span class="n">target_key</span><span class="o">=</span><span class="s2">&quot;targets&quot;</span><span class="p">,</span> <span class="n">threshold</span><span class="o">=</span><span class="mf">0.5</span>
        <span class="p">)</span>
    <span class="p">]</span>
<span class="p">)</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Please follow the <a class="reference external" href="https://github.com/catalyst-team/catalyst#minimal-examples">minimal examples</a> sections for more use cases.</p>
</div>
</dd></dl>

</section>
<section id="multilabelprecisionrecallf1supportmetric">
<h3><a class="toc-backref" href="#id37">MultilabelPrecisionRecallF1SupportMetric</a><a class="headerlink" href="#multilabelprecisionrecallf1supportmetric" title="Permalink to this headline">¶</a></h3>
<dl class="class">
<dt id="catalyst.metrics._classification.MultilabelPrecisionRecallF1SupportMetric">
<em class="property">class </em><code class="sig-prename descclassname">catalyst.metrics._classification.</code><code class="sig-name descname">MultilabelPrecisionRecallF1SupportMetric</code><span class="sig-paren">(</span><em class="sig-param">zero_division: int = 0</em>, <em class="sig-param">compute_on_call: bool = True</em>, <em class="sig-param">compute_per_class_metrics: bool = False</em>, <em class="sig-param">prefix: str = None</em>, <em class="sig-param">suffix: str = None</em>, <em class="sig-param">num_classes: Optional[int] = None</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/catalyst/metrics/_classification.html#MultilabelPrecisionRecallF1SupportMetric"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#catalyst.metrics._classification.MultilabelPrecisionRecallF1SupportMetric" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">catalyst.metrics._classification.MultilabelStatisticsMetric</span></code></p>
<p>Metric that can collect statistics and count precision, recall, f1_score and support with it.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>zero_division</strong> – value to set in case of zero division during metrics
(precision, recall) computation; should be one of 0 or 1</p></li>
<li><p><strong>compute_on_call</strong> – if True, allows compute metric’s value on call</p></li>
<li><p><strong>compute_per_class_metrics</strong> – boolean flag to compute per-class metrics
(default: SETTINGS.compute_per_class_metrics or False).</p></li>
<li><p><strong>prefix</strong> – metrics prefix</p></li>
<li><p><strong>suffix</strong> – metrics suffix</p></li>
<li><p><strong>num_classes</strong> – number of classes</p></li>
</ul>
</dd>
</dl>
</dd></dl>

</section>
<section id="mrrmetric">
<h3><a class="toc-backref" href="#id38">MRRMetric</a><a class="headerlink" href="#mrrmetric" title="Permalink to this headline">¶</a></h3>
<dl class="class">
<dt id="catalyst.metrics._mrr.MRRMetric">
<em class="property">class </em><code class="sig-prename descclassname">catalyst.metrics._mrr.</code><code class="sig-name descname">MRRMetric</code><span class="sig-paren">(</span><em class="sig-param">topk_args: Iterable[int] = None</em>, <em class="sig-param">compute_on_call: bool = True</em>, <em class="sig-param">prefix: str = None</em>, <em class="sig-param">suffix: str = None</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/catalyst/metrics/_mrr.html#MRRMetric"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#catalyst.metrics._mrr.MRRMetric" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#catalyst.metrics._topk_metric.TopKMetric" title="catalyst.metrics._topk_metric.TopKMetric"><code class="xref py py-class docutils literal notranslate"><span class="pre">catalyst.metrics._topk_metric.TopKMetric</span></code></a></p>
<p>Calculates the Mean Reciprocal Rank (MRR)
score given model outputs and targets
The precision metric summarizes the fraction of relevant items
Computes mean value of map and it’s approximate std value</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>topk_args</strong> – list of <cite>topk</cite> for <a class="reference external" href="mailto:mrr&#37;&#52;&#48;topk">mrr<span>&#64;</span>topk</a> computing</p></li>
<li><p><strong>compute_on_call</strong> – if True, computes and returns metric value during metric call</p></li>
<li><p><strong>prefix</strong> – metric prefix</p></li>
<li><p><strong>suffix</strong> – metric suffix</p></li>
</ul>
</dd>
</dl>
<p>Examples:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">torch</span>
<span class="kn">from</span> <span class="nn">catalyst</span> <span class="kn">import</span> <span class="n">metrics</span>

<span class="n">outputs</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">([</span>
    <span class="p">[</span><span class="mf">4.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">],</span>
    <span class="p">[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">,</span> <span class="mf">4.0</span><span class="p">],</span>
<span class="p">])</span>
<span class="n">targets</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([</span>
    <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">],</span>
    <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">],</span>
<span class="p">])</span>
<span class="n">metric</span> <span class="o">=</span> <span class="n">metrics</span><span class="o">.</span><span class="n">MRRMetric</span><span class="p">(</span><span class="n">topk_args</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span>
<span class="n">metric</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>

<span class="n">metric</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">outputs</span><span class="p">,</span> <span class="n">targets</span><span class="p">)</span>
<span class="n">metric</span><span class="o">.</span><span class="n">compute</span><span class="p">()</span>
<span class="c1"># ((0.5, 0.75), (0.0, 0.0))  # mean, std for @01, @03</span>

<span class="n">metric</span><span class="o">.</span><span class="n">compute_key_value</span><span class="p">()</span>
<span class="c1"># {</span>
<span class="c1">#     &#39;mrr01&#39;: 0.5,</span>
<span class="c1">#     &#39;mrr03&#39;: 0.75,</span>
<span class="c1">#     &#39;mrr01/std&#39;: 0.0,</span>
<span class="c1">#     &#39;mrr03/std&#39;: 0.0</span>
<span class="c1"># }</span>

<span class="n">metric</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
<span class="n">metric</span><span class="p">(</span><span class="n">outputs</span><span class="p">,</span> <span class="n">targets</span><span class="p">)</span>
<span class="c1"># ((0.5, 0.75), (0.0, 0.0))  # mean, std for @01, @03</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">torch</span>
<span class="kn">from</span> <span class="nn">torch.utils.data</span> <span class="kn">import</span> <span class="n">DataLoader</span><span class="p">,</span> <span class="n">TensorDataset</span>
<span class="kn">from</span> <span class="nn">catalyst</span> <span class="kn">import</span> <span class="n">dl</span>

<span class="c1"># sample data</span>
<span class="n">num_users</span><span class="p">,</span> <span class="n">num_features</span><span class="p">,</span> <span class="n">num_items</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mf">1e4</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="mf">1e1</span><span class="p">),</span> <span class="mi">10</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="n">num_users</span><span class="p">,</span> <span class="n">num_features</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="n">num_users</span><span class="p">,</span> <span class="n">num_items</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mf">0.5</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>

<span class="c1"># pytorch loaders</span>
<span class="n">dataset</span> <span class="o">=</span> <span class="n">TensorDataset</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
<span class="n">loader</span> <span class="o">=</span> <span class="n">DataLoader</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="mi">32</span><span class="p">,</span> <span class="n">num_workers</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">loaders</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;train&quot;</span><span class="p">:</span> <span class="n">loader</span><span class="p">,</span> <span class="s2">&quot;valid&quot;</span><span class="p">:</span> <span class="n">loader</span><span class="p">}</span>

<span class="c1"># model, criterion, optimizer, scheduler</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="n">num_features</span><span class="p">,</span> <span class="n">num_items</span><span class="p">)</span>
<span class="n">criterion</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">BCEWithLogitsLoss</span><span class="p">()</span>
<span class="n">optimizer</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">optim</span><span class="o">.</span><span class="n">Adam</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="p">())</span>
<span class="n">scheduler</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">optim</span><span class="o">.</span><span class="n">lr_scheduler</span><span class="o">.</span><span class="n">MultiStepLR</span><span class="p">(</span><span class="n">optimizer</span><span class="p">,</span> <span class="p">[</span><span class="mi">2</span><span class="p">])</span>

<span class="c1"># model training</span>
<span class="n">runner</span> <span class="o">=</span> <span class="n">dl</span><span class="o">.</span><span class="n">SupervisedRunner</span><span class="p">(</span>
    <span class="n">input_key</span><span class="o">=</span><span class="s2">&quot;features&quot;</span><span class="p">,</span> <span class="n">output_key</span><span class="o">=</span><span class="s2">&quot;logits&quot;</span><span class="p">,</span> <span class="n">target_key</span><span class="o">=</span><span class="s2">&quot;targets&quot;</span><span class="p">,</span> <span class="n">loss_key</span><span class="o">=</span><span class="s2">&quot;loss&quot;</span>
<span class="p">)</span>
<span class="n">runner</span><span class="o">.</span><span class="n">train</span><span class="p">(</span>
    <span class="n">model</span><span class="o">=</span><span class="n">model</span><span class="p">,</span>
    <span class="n">criterion</span><span class="o">=</span><span class="n">criterion</span><span class="p">,</span>
    <span class="n">optimizer</span><span class="o">=</span><span class="n">optimizer</span><span class="p">,</span>
    <span class="n">scheduler</span><span class="o">=</span><span class="n">scheduler</span><span class="p">,</span>
    <span class="n">loaders</span><span class="o">=</span><span class="n">loaders</span><span class="p">,</span>
    <span class="n">num_epochs</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
    <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">callbacks</span><span class="o">=</span><span class="p">[</span>
        <span class="n">dl</span><span class="o">.</span><span class="n">BatchTransformCallback</span><span class="p">(</span>
            <span class="n">transform</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">sigmoid</span><span class="p">,</span>
            <span class="n">scope</span><span class="o">=</span><span class="s2">&quot;on_batch_end&quot;</span><span class="p">,</span>
            <span class="n">input_key</span><span class="o">=</span><span class="s2">&quot;logits&quot;</span><span class="p">,</span>
            <span class="n">output_key</span><span class="o">=</span><span class="s2">&quot;scores&quot;</span>
        <span class="p">),</span>
        <span class="n">dl</span><span class="o">.</span><span class="n">CriterionCallback</span><span class="p">(</span>
            <span class="n">input_key</span><span class="o">=</span><span class="s2">&quot;logits&quot;</span><span class="p">,</span> <span class="n">target_key</span><span class="o">=</span><span class="s2">&quot;targets&quot;</span><span class="p">,</span> <span class="n">metric_key</span><span class="o">=</span><span class="s2">&quot;loss&quot;</span>
        <span class="p">),</span>
        <span class="n">dl</span><span class="o">.</span><span class="n">AUCCallback</span><span class="p">(</span><span class="n">input_key</span><span class="o">=</span><span class="s2">&quot;scores&quot;</span><span class="p">,</span> <span class="n">target_key</span><span class="o">=</span><span class="s2">&quot;targets&quot;</span><span class="p">),</span>
        <span class="n">dl</span><span class="o">.</span><span class="n">HitrateCallback</span><span class="p">(</span>
            <span class="n">input_key</span><span class="o">=</span><span class="s2">&quot;scores&quot;</span><span class="p">,</span> <span class="n">target_key</span><span class="o">=</span><span class="s2">&quot;targets&quot;</span><span class="p">,</span> <span class="n">topk_args</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
        <span class="p">),</span>
        <span class="n">dl</span><span class="o">.</span><span class="n">MRRCallback</span><span class="p">(</span><span class="n">input_key</span><span class="o">=</span><span class="s2">&quot;scores&quot;</span><span class="p">,</span> <span class="n">target_key</span><span class="o">=</span><span class="s2">&quot;targets&quot;</span><span class="p">,</span> <span class="n">topk_args</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">)),</span>
        <span class="n">dl</span><span class="o">.</span><span class="n">MAPCallback</span><span class="p">(</span><span class="n">input_key</span><span class="o">=</span><span class="s2">&quot;scores&quot;</span><span class="p">,</span> <span class="n">target_key</span><span class="o">=</span><span class="s2">&quot;targets&quot;</span><span class="p">,</span> <span class="n">topk_args</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">)),</span>
        <span class="n">dl</span><span class="o">.</span><span class="n">NDCGCallback</span><span class="p">(</span><span class="n">input_key</span><span class="o">=</span><span class="s2">&quot;scores&quot;</span><span class="p">,</span> <span class="n">target_key</span><span class="o">=</span><span class="s2">&quot;targets&quot;</span><span class="p">,</span> <span class="n">topk_args</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">)),</span>
        <span class="n">dl</span><span class="o">.</span><span class="n">OptimizerCallback</span><span class="p">(</span><span class="n">metric_key</span><span class="o">=</span><span class="s2">&quot;loss&quot;</span><span class="p">),</span>
        <span class="n">dl</span><span class="o">.</span><span class="n">SchedulerCallback</span><span class="p">(),</span>
        <span class="n">dl</span><span class="o">.</span><span class="n">CheckpointCallback</span><span class="p">(</span>
            <span class="n">logdir</span><span class="o">=</span><span class="s2">&quot;./logs&quot;</span><span class="p">,</span> <span class="n">loader_key</span><span class="o">=</span><span class="s2">&quot;valid&quot;</span><span class="p">,</span> <span class="n">metric_key</span><span class="o">=</span><span class="s2">&quot;loss&quot;</span><span class="p">,</span> <span class="n">minimize</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">),</span>
    <span class="p">]</span>
<span class="p">)</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Metric names depending on input parameters:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">topk_args</span> <span class="pre">=</span> <span class="pre">(1,)</span> <span class="pre">or</span> <span class="pre">None</span></code> —&gt; <code class="docutils literal notranslate"><span class="pre">&quot;mrr01&quot;</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">topk_args</span> <span class="pre">=</span> <span class="pre">(1,</span> <span class="pre">3)</span></code> —&gt; <code class="docutils literal notranslate"><span class="pre">&quot;mrr01&quot;</span></code>, <code class="docutils literal notranslate"><span class="pre">&quot;mrr03&quot;</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">topk_args</span> <span class="pre">=</span> <span class="pre">(1,</span> <span class="pre">3,</span> <span class="pre">5)</span></code> —&gt; <code class="docutils literal notranslate"><span class="pre">&quot;mrr01&quot;</span></code>, <code class="docutils literal notranslate"><span class="pre">&quot;mrr03&quot;</span></code>, <code class="docutils literal notranslate"><span class="pre">&quot;mrr05&quot;</span></code></p></li>
</ul>
<p>You can find them in <code class="docutils literal notranslate"><span class="pre">runner.batch_metrics</span></code>, <code class="docutils literal notranslate"><span class="pre">runner.loader_metrics</span></code> or
<code class="docutils literal notranslate"><span class="pre">runner.epoch_metrics</span></code>.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Please follow the <a class="reference external" href="https://github.com/catalyst-team/catalyst#minimal-examples">minimal examples</a> sections for more use cases.</p>
</div>
</dd></dl>

</section>
<section id="ndcgmetric">
<h3><a class="toc-backref" href="#id39">NDCGMetric</a><a class="headerlink" href="#ndcgmetric" title="Permalink to this headline">¶</a></h3>
<dl class="class">
<dt id="catalyst.metrics._ndcg.NDCGMetric">
<em class="property">class </em><code class="sig-prename descclassname">catalyst.metrics._ndcg.</code><code class="sig-name descname">NDCGMetric</code><span class="sig-paren">(</span><em class="sig-param">topk_args: Iterable[int] = None</em>, <em class="sig-param">compute_on_call: bool = True</em>, <em class="sig-param">prefix: str = None</em>, <em class="sig-param">suffix: str = None</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/catalyst/metrics/_ndcg.html#NDCGMetric"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#catalyst.metrics._ndcg.NDCGMetric" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#catalyst.metrics._topk_metric.TopKMetric" title="catalyst.metrics._topk_metric.TopKMetric"><code class="xref py py-class docutils literal notranslate"><span class="pre">catalyst.metrics._topk_metric.TopKMetric</span></code></a></p>
<p>Calculates the Normalized discounted cumulative gain (NDCG)
score given model outputs and targets
The precision metric summarizes the fraction of relevant items
Computes mean value of NDCG and it’s approximate std value</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>topk_args</strong> – list of <cite>topk</cite> for <a class="reference external" href="mailto:ndcg&#37;&#52;&#48;topk">ndcg<span>&#64;</span>topk</a> computing</p></li>
<li><p><strong>compute_on_call</strong> – if True, computes and returns metric value during metric call</p></li>
<li><p><strong>prefix</strong> – metric prefix</p></li>
<li><p><strong>suffix</strong> – metric suffix</p></li>
</ul>
</dd>
</dl>
<p>Examples:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">torch</span>
<span class="kn">from</span> <span class="nn">catalyst</span> <span class="kn">import</span> <span class="n">metrics</span>

<span class="n">outputs</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">([</span>
    <span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">],</span>
    <span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">],</span>
<span class="p">])</span>
<span class="n">targets</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([</span>
    <span class="p">[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">],</span>
    <span class="p">[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">],</span>
<span class="p">])</span>
<span class="n">metric</span> <span class="o">=</span> <span class="n">metrics</span><span class="o">.</span><span class="n">NDCGMetric</span><span class="p">(</span><span class="n">topk_args</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
<span class="n">metric</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>

<span class="n">metric</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">outputs</span><span class="p">,</span> <span class="n">targets</span><span class="p">)</span>
<span class="n">metric</span><span class="o">.</span><span class="n">compute</span><span class="p">()</span>
<span class="c1"># (</span>
<span class="c1">#     (1.0, 0.6131471991539001),  # mean for @01, @02</span>
<span class="c1">#     (0.0, 0.0)                  # std for @01, @02</span>
<span class="c1"># )</span>

<span class="n">metric</span><span class="o">.</span><span class="n">compute_key_value</span><span class="p">()</span>
<span class="c1"># {</span>
<span class="c1">#     &#39;ndcg01&#39;: 1.0,</span>
<span class="c1">#     &#39;ndcg02&#39;: 0.6131471991539001,</span>
<span class="c1">#     &#39;ndcg01/std&#39;: 0.0,</span>
<span class="c1">#     &#39;ndcg02/std&#39;: 0.0</span>
<span class="c1"># }</span>

<span class="n">metric</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
<span class="n">metric</span><span class="p">(</span><span class="n">outputs</span><span class="p">,</span> <span class="n">targets</span><span class="p">)</span>
<span class="c1"># (</span>
<span class="c1">#     (1.0, 0.6131471991539001),  # mean for @01, @02</span>
<span class="c1">#     (0.0, 0.0)                  # std for @01, @02</span>
<span class="c1"># )</span>
<span class="c1"># ((0.5, 0.75), (0.0, 0.0))  # mean, std for @01, @03</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">torch</span>
<span class="kn">from</span> <span class="nn">torch.utils.data</span> <span class="kn">import</span> <span class="n">DataLoader</span><span class="p">,</span> <span class="n">TensorDataset</span>
<span class="kn">from</span> <span class="nn">catalyst</span> <span class="kn">import</span> <span class="n">dl</span>

<span class="c1"># sample data</span>
<span class="n">num_users</span><span class="p">,</span> <span class="n">num_features</span><span class="p">,</span> <span class="n">num_items</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mf">1e4</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="mf">1e1</span><span class="p">),</span> <span class="mi">10</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="n">num_users</span><span class="p">,</span> <span class="n">num_features</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="n">num_users</span><span class="p">,</span> <span class="n">num_items</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mf">0.5</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>

<span class="c1"># pytorch loaders</span>
<span class="n">dataset</span> <span class="o">=</span> <span class="n">TensorDataset</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
<span class="n">loader</span> <span class="o">=</span> <span class="n">DataLoader</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="mi">32</span><span class="p">,</span> <span class="n">num_workers</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">loaders</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;train&quot;</span><span class="p">:</span> <span class="n">loader</span><span class="p">,</span> <span class="s2">&quot;valid&quot;</span><span class="p">:</span> <span class="n">loader</span><span class="p">}</span>

<span class="c1"># model, criterion, optimizer, scheduler</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="n">num_features</span><span class="p">,</span> <span class="n">num_items</span><span class="p">)</span>
<span class="n">criterion</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">BCEWithLogitsLoss</span><span class="p">()</span>
<span class="n">optimizer</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">optim</span><span class="o">.</span><span class="n">Adam</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="p">())</span>
<span class="n">scheduler</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">optim</span><span class="o">.</span><span class="n">lr_scheduler</span><span class="o">.</span><span class="n">MultiStepLR</span><span class="p">(</span><span class="n">optimizer</span><span class="p">,</span> <span class="p">[</span><span class="mi">2</span><span class="p">])</span>

<span class="c1"># model training</span>
<span class="n">runner</span> <span class="o">=</span> <span class="n">dl</span><span class="o">.</span><span class="n">SupervisedRunner</span><span class="p">(</span>
    <span class="n">input_key</span><span class="o">=</span><span class="s2">&quot;features&quot;</span><span class="p">,</span> <span class="n">output_key</span><span class="o">=</span><span class="s2">&quot;logits&quot;</span><span class="p">,</span> <span class="n">target_key</span><span class="o">=</span><span class="s2">&quot;targets&quot;</span><span class="p">,</span> <span class="n">loss_key</span><span class="o">=</span><span class="s2">&quot;loss&quot;</span>
<span class="p">)</span>
<span class="n">runner</span><span class="o">.</span><span class="n">train</span><span class="p">(</span>
    <span class="n">model</span><span class="o">=</span><span class="n">model</span><span class="p">,</span>
    <span class="n">criterion</span><span class="o">=</span><span class="n">criterion</span><span class="p">,</span>
    <span class="n">optimizer</span><span class="o">=</span><span class="n">optimizer</span><span class="p">,</span>
    <span class="n">scheduler</span><span class="o">=</span><span class="n">scheduler</span><span class="p">,</span>
    <span class="n">loaders</span><span class="o">=</span><span class="n">loaders</span><span class="p">,</span>
    <span class="n">num_epochs</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
    <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">callbacks</span><span class="o">=</span><span class="p">[</span>
        <span class="n">dl</span><span class="o">.</span><span class="n">BatchTransformCallback</span><span class="p">(</span>
            <span class="n">transform</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">sigmoid</span><span class="p">,</span>
            <span class="n">scope</span><span class="o">=</span><span class="s2">&quot;on_batch_end&quot;</span><span class="p">,</span>
            <span class="n">input_key</span><span class="o">=</span><span class="s2">&quot;logits&quot;</span><span class="p">,</span>
            <span class="n">output_key</span><span class="o">=</span><span class="s2">&quot;scores&quot;</span>
        <span class="p">),</span>
        <span class="n">dl</span><span class="o">.</span><span class="n">CriterionCallback</span><span class="p">(</span>
            <span class="n">input_key</span><span class="o">=</span><span class="s2">&quot;logits&quot;</span><span class="p">,</span> <span class="n">target_key</span><span class="o">=</span><span class="s2">&quot;targets&quot;</span><span class="p">,</span> <span class="n">metric_key</span><span class="o">=</span><span class="s2">&quot;loss&quot;</span>
        <span class="p">),</span>
        <span class="n">dl</span><span class="o">.</span><span class="n">AUCCallback</span><span class="p">(</span><span class="n">input_key</span><span class="o">=</span><span class="s2">&quot;scores&quot;</span><span class="p">,</span> <span class="n">target_key</span><span class="o">=</span><span class="s2">&quot;targets&quot;</span><span class="p">),</span>
        <span class="n">dl</span><span class="o">.</span><span class="n">HitrateCallback</span><span class="p">(</span><span class="n">input_key</span><span class="o">=</span><span class="s2">&quot;scores&quot;</span><span class="p">,</span> <span class="n">target_key</span><span class="o">=</span><span class="s2">&quot;targets&quot;</span><span class="p">,</span> <span class="n">topk_args</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">)),</span>
        <span class="n">dl</span><span class="o">.</span><span class="n">HitrateCallback</span><span class="p">(</span>
            <span class="n">input_key</span><span class="o">=</span><span class="s2">&quot;scores&quot;</span><span class="p">,</span> <span class="n">target_key</span><span class="o">=</span><span class="s2">&quot;targets&quot;</span><span class="p">,</span> <span class="n">topk_args</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
        <span class="p">),</span>
        <span class="n">dl</span><span class="o">.</span><span class="n">MAPCallback</span><span class="p">(</span><span class="n">input_key</span><span class="o">=</span><span class="s2">&quot;scores&quot;</span><span class="p">,</span> <span class="n">target_key</span><span class="o">=</span><span class="s2">&quot;targets&quot;</span><span class="p">,</span> <span class="n">topk_args</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">)),</span>
        <span class="n">dl</span><span class="o">.</span><span class="n">NDCGCallback</span><span class="p">(</span><span class="n">input_key</span><span class="o">=</span><span class="s2">&quot;scores&quot;</span><span class="p">,</span> <span class="n">target_key</span><span class="o">=</span><span class="s2">&quot;targets&quot;</span><span class="p">,</span> <span class="n">topk_args</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">)),</span>
        <span class="n">dl</span><span class="o">.</span><span class="n">OptimizerCallback</span><span class="p">(</span><span class="n">metric_key</span><span class="o">=</span><span class="s2">&quot;loss&quot;</span><span class="p">),</span>
        <span class="n">dl</span><span class="o">.</span><span class="n">SchedulerCallback</span><span class="p">(),</span>
        <span class="n">dl</span><span class="o">.</span><span class="n">CheckpointCallback</span><span class="p">(</span>
            <span class="n">logdir</span><span class="o">=</span><span class="s2">&quot;./logs&quot;</span><span class="p">,</span> <span class="n">loader_key</span><span class="o">=</span><span class="s2">&quot;valid&quot;</span><span class="p">,</span> <span class="n">metric_key</span><span class="o">=</span><span class="s2">&quot;loss&quot;</span><span class="p">,</span> <span class="n">minimize</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">),</span>
    <span class="p">]</span>
<span class="p">)</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Metric names depending on input parameters:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">topk_args</span> <span class="pre">=</span> <span class="pre">(1,)</span> <span class="pre">or</span> <span class="pre">None</span></code> —&gt; <code class="docutils literal notranslate"><span class="pre">&quot;ndcg01&quot;</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">topk_args</span> <span class="pre">=</span> <span class="pre">(1,</span> <span class="pre">3)</span></code> —&gt; <code class="docutils literal notranslate"><span class="pre">&quot;ndcg01&quot;</span></code>, <code class="docutils literal notranslate"><span class="pre">&quot;ndcg03&quot;</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">topk_args</span> <span class="pre">=</span> <span class="pre">(1,</span> <span class="pre">3,</span> <span class="pre">5)</span></code> —&gt; <code class="docutils literal notranslate"><span class="pre">&quot;ndcg01&quot;</span></code>, <code class="docutils literal notranslate"><span class="pre">&quot;ndcg03&quot;</span></code>, <code class="docutils literal notranslate"><span class="pre">&quot;ndcg05&quot;</span></code></p></li>
</ul>
<p>You can find them in <code class="docutils literal notranslate"><span class="pre">runner.batch_metrics</span></code>, <code class="docutils literal notranslate"><span class="pre">runner.loader_metrics</span></code> or
<code class="docutils literal notranslate"><span class="pre">runner.epoch_metrics</span></code>.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Please follow the <a class="reference external" href="https://github.com/catalyst-team/catalyst#minimal-examples">minimal examples</a> sections for more use cases.</p>
</div>
</dd></dl>

</section>
<section id="r2squared">
<h3><a class="toc-backref" href="#id40">R2Squared</a><a class="headerlink" href="#r2squared" title="Permalink to this headline">¶</a></h3>
<dl class="class">
<dt id="catalyst.metrics._r2_squared.R2Squared">
<em class="property">class </em><code class="sig-prename descclassname">catalyst.metrics._r2_squared.</code><code class="sig-name descname">R2Squared</code><span class="sig-paren">(</span><em class="sig-param">compute_on_call: bool = True</em>, <em class="sig-param">prefix: Optional[str] = None</em>, <em class="sig-param">suffix: Optional[str] = None</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/catalyst/metrics/_r2_squared.html#R2Squared"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#catalyst.metrics._r2_squared.R2Squared" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#catalyst.metrics._metric.ICallbackLoaderMetric" title="catalyst.metrics._metric.ICallbackLoaderMetric"><code class="xref py py-class docutils literal notranslate"><span class="pre">catalyst.metrics._metric.ICallbackLoaderMetric</span></code></a></p>
<p>This metric accumulates r2 score along loader</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>compute_on_call</strong> – if True, allows compute metric’s value on call</p></li>
<li><p><strong>prefix</strong> – metric prefix</p></li>
<li><p><strong>suffix</strong> – metric suffix</p></li>
</ul>
</dd>
</dl>
</dd></dl>

</section>
<section id="reidcmcmetric">
<h3><a class="toc-backref" href="#id41">ReidCMCMetric</a><a class="headerlink" href="#reidcmcmetric" title="Permalink to this headline">¶</a></h3>
<dl class="class">
<dt id="catalyst.metrics._cmc_score.ReidCMCMetric">
<em class="property">class </em><code class="sig-prename descclassname">catalyst.metrics._cmc_score.</code><code class="sig-name descname">ReidCMCMetric</code><span class="sig-paren">(</span><em class="sig-param">embeddings_key: str</em>, <em class="sig-param">pids_key: str</em>, <em class="sig-param">cids_key: str</em>, <em class="sig-param">is_query_key: str</em>, <em class="sig-param">topk_args: Iterable[int] = None</em>, <em class="sig-param">compute_on_call: bool = True</em>, <em class="sig-param">prefix: Optional[str] = None</em>, <em class="sig-param">suffix: Optional[str] = None</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/catalyst/metrics/_cmc_score.html#ReidCMCMetric"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#catalyst.metrics._cmc_score.ReidCMCMetric" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#catalyst.metrics._accumulative.AccumulativeMetric" title="catalyst.metrics._accumulative.AccumulativeMetric"><code class="xref py py-class docutils literal notranslate"><span class="pre">catalyst.metrics._accumulative.AccumulativeMetric</span></code></a></p>
<p>Cumulative Matching Characteristics for Reid case</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>embeddings_key</strong> – key of embedding tensor in batch</p></li>
<li><p><strong>pids_key</strong> – key of pids tensor in batch</p></li>
<li><p><strong>cids_key</strong> – key of cids tensor in batch</p></li>
<li><p><strong>is_query_key</strong> – key of query flag tensor in batch</p></li>
<li><p><strong>topk_args</strong> – list of k, specifies which cmc&#64;k should be calculated</p></li>
<li><p><strong>compute_on_call</strong> – if True, allows compute metric’s value on call</p></li>
<li><p><strong>prefix</strong> – metric prefix</p></li>
<li><p><strong>suffix</strong> – metric suffix</p></li>
</ul>
</dd>
</dl>
<p>Examples:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">torch</span>
<span class="kn">from</span> <span class="nn">catalyst.metrics</span> <span class="kn">import</span> <span class="n">ReidCMCMetric</span>

<span class="n">batch</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;embeddings&quot;</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span>
        <span class="p">[</span>
            <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
            <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
            <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
            <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
            <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
            <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
            <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
        <span class="p">]</span>
    <span class="p">)</span><span class="o">.</span><span class="n">float</span><span class="p">(),</span>
    <span class="s2">&quot;pids&quot;</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">long</span><span class="p">(),</span>
    <span class="s2">&quot;cids&quot;</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span><span class="o">.</span><span class="n">long</span><span class="p">(),</span>
    <span class="s2">&quot;is_query&quot;</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">bool</span><span class="p">(),</span>
<span class="p">}</span>
<span class="n">topk</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>

<span class="n">metric</span> <span class="o">=</span> <span class="n">ReidCMCMetric</span><span class="p">(</span>
    <span class="n">embeddings_key</span><span class="o">=</span><span class="s2">&quot;embeddings&quot;</span><span class="p">,</span>
    <span class="n">pids_key</span><span class="o">=</span><span class="s2">&quot;pids&quot;</span><span class="p">,</span>
    <span class="n">cids_key</span><span class="o">=</span><span class="s2">&quot;cids&quot;</span><span class="p">,</span>
    <span class="n">is_query_key</span><span class="o">=</span><span class="s2">&quot;is_query&quot;</span><span class="p">,</span>
    <span class="n">topk_args</span><span class="o">=</span><span class="n">topk</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">metric</span><span class="o">.</span><span class="n">reset</span><span class="p">(</span><span class="n">num_batches</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">num_samples</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">batch</span><span class="p">[</span><span class="s2">&quot;embeddings&quot;</span><span class="p">]))</span>

<span class="n">metric</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="o">**</span><span class="n">batch</span><span class="p">)</span>
<span class="n">metric</span><span class="o">.</span><span class="n">compute</span><span class="p">()</span>
<span class="c1"># [0.75, 1.0]  # CMC@01, CMC@03</span>

<span class="n">metric</span><span class="o">.</span><span class="n">compute_key_value</span><span class="p">()</span>
<span class="c1"># {&#39;cmc01&#39;: 0.75, &#39;cmc03&#39;: 1.0}</span>
</pre></div>
</div>
</dd></dl>

</section>
<section id="trevskymetric">
<h3><a class="toc-backref" href="#id42">TrevskyMetric</a><a class="headerlink" href="#trevskymetric" title="Permalink to this headline">¶</a></h3>
<dl class="class">
<dt id="catalyst.metrics._segmentation.TrevskyMetric">
<em class="property">class </em><code class="sig-prename descclassname">catalyst.metrics._segmentation.</code><code class="sig-name descname">TrevskyMetric</code><span class="sig-paren">(</span><em class="sig-param">alpha: float</em>, <em class="sig-param">beta: Optional[float] = None</em>, <em class="sig-param">class_dim: int = 1</em>, <em class="sig-param">weights: Optional[List[float]] = None</em>, <em class="sig-param">class_names: Optional[List[str]] = None</em>, <em class="sig-param">threshold: Optional[float] = None</em>, <em class="sig-param">eps: float = 1e-07</em>, <em class="sig-param">compute_on_call: bool = True</em>, <em class="sig-param">compute_per_class_metrics: bool = False</em>, <em class="sig-param">prefix: Optional[str] = None</em>, <em class="sig-param">suffix: Optional[str] = None</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/catalyst/metrics/_segmentation.html#TrevskyMetric"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#catalyst.metrics._segmentation.TrevskyMetric" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#catalyst.metrics._segmentation.RegionBasedMetric" title="catalyst.metrics._segmentation.RegionBasedMetric"><code class="xref py py-class docutils literal notranslate"><span class="pre">catalyst.metrics._segmentation.RegionBasedMetric</span></code></a></p>
<p>Trevsky Metric,
trevsky score = tp / (tp + fp * beta + fn * alpha)</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>alpha</strong> – false negative coefficient, bigger alpha bigger penalty for
false negative. if beta is None, alpha must be in (0, 1)</p></li>
<li><p><strong>beta</strong> – false positive coefficient, bigger alpha bigger penalty for false
positive. Must be in (0, 1), if None beta = (1 - alpha)</p></li>
<li><p><strong>class_dim</strong> – indicates class dimension (K) for <code class="docutils literal notranslate"><span class="pre">outputs</span></code> and
<code class="docutils literal notranslate"><span class="pre">targets</span></code> tensors (default = 1)</p></li>
<li><p><strong>weights</strong> – class weights</p></li>
<li><p><strong>class_names</strong> – class names</p></li>
<li><p><strong>threshold</strong> – threshold for outputs binarization</p></li>
<li><p><strong>eps</strong> – epsilon to avoid zero division</p></li>
<li><p><strong>compute_on_call</strong> – Computes and returns metric value during metric call.
Used for per-batch logging. default: True</p></li>
<li><p><strong>compute_per_class_metrics</strong> – boolean flag to compute per-class metrics
(default: SETTINGS.compute_per_class_metrics or False).</p></li>
<li><p><strong>prefix</strong> – metric prefix</p></li>
<li><p><strong>suffix</strong> – metric suffix</p></li>
</ul>
</dd>
</dl>
<p>Examples:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">torch</span>
<span class="kn">from</span> <span class="nn">catalyst</span> <span class="kn">import</span> <span class="n">metrics</span>

<span class="n">outputs</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([[[[</span><span class="mf">0.8</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]]]])</span>
<span class="n">targets</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([[[[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]]]])</span>
<span class="n">metric</span> <span class="o">=</span> <span class="n">metrics</span><span class="o">.</span><span class="n">TrevskyMetric</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>
<span class="n">metric</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>

<span class="n">metric</span><span class="o">.</span><span class="n">compute</span><span class="p">()</span>
<span class="c1"># per_class, micro, macro, weighted</span>
<span class="c1"># ([tensor(0.4167)], tensor(0.4167), tensor(0.4167), None)</span>

<span class="n">metric</span><span class="o">.</span><span class="n">update_key_value</span><span class="p">(</span><span class="n">outputs</span><span class="p">,</span> <span class="n">targets</span><span class="p">)</span>
<span class="n">metric</span><span class="o">.</span><span class="n">compute_key_value</span><span class="p">()</span>
<span class="c1"># {</span>
<span class="c1">#     &#39;trevsky&#39;: tensor(0.4167),</span>
<span class="c1">#     &#39;trevsky/_macro&#39;: tensor(0.4167)</span>
<span class="c1">#     &#39;trevsky/_micro&#39;: tensor(0.4167),</span>
<span class="c1">#     &#39;trevsky/class_00&#39;: tensor(0.4167),</span>
<span class="c1"># }</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">torch</span>
<span class="kn">from</span> <span class="nn">torch</span> <span class="kn">import</span> <span class="n">nn</span>
<span class="kn">from</span> <span class="nn">torch.utils.data</span> <span class="kn">import</span> <span class="n">DataLoader</span>
<span class="kn">from</span> <span class="nn">catalyst</span> <span class="kn">import</span> <span class="n">dl</span>
<span class="kn">from</span> <span class="nn">catalyst.contrib</span> <span class="kn">import</span> <span class="n">IoULoss</span><span class="p">,</span> <span class="n">MNIST</span>

<span class="n">model</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Sequential</span><span class="p">(</span>
    <span class="n">nn</span><span class="o">.</span><span class="n">Conv2d</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">nn</span><span class="o">.</span><span class="n">ReLU</span><span class="p">(),</span>
    <span class="n">nn</span><span class="o">.</span><span class="n">Conv2d</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">nn</span><span class="o">.</span><span class="n">Sigmoid</span><span class="p">(),</span>
<span class="p">)</span>
<span class="n">criterion</span> <span class="o">=</span> <span class="n">IoULoss</span><span class="p">()</span>
<span class="n">optimizer</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">optim</span><span class="o">.</span><span class="n">Adam</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="p">(),</span> <span class="n">lr</span><span class="o">=</span><span class="mf">0.02</span><span class="p">)</span>

<span class="n">loaders</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;train&quot;</span><span class="p">:</span> <span class="n">DataLoader</span><span class="p">(</span>
        <span class="n">MNIST</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">(),</span> <span class="n">train</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
        <span class="n">batch_size</span><span class="o">=</span><span class="mi">32</span>
    <span class="p">),</span>
    <span class="s2">&quot;valid&quot;</span><span class="p">:</span> <span class="n">DataLoader</span><span class="p">(</span>
        <span class="n">MNIST</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">(),</span> <span class="n">train</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span>
        <span class="n">batch_size</span><span class="o">=</span><span class="mi">32</span>
    <span class="p">),</span>
<span class="p">}</span>

<span class="k">class</span> <span class="nc">CustomRunner</span><span class="p">(</span><span class="n">dl</span><span class="o">.</span><span class="n">SupervisedRunner</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">handle_batch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">batch</span><span class="p">):</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">batch</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_input_key</span><span class="p">]</span>
        <span class="n">x_noise</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="n">torch</span><span class="o">.</span><span class="n">rand_like</span><span class="p">(</span><span class="n">x</span><span class="p">))</span><span class="o">.</span><span class="n">clamp_</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">x_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">(</span><span class="n">x_noise</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">batch</span> <span class="o">=</span> <span class="p">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_input_key</span><span class="p">:</span> <span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_output_key</span><span class="p">:</span> <span class="n">x_</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_target_key</span><span class="p">:</span> <span class="n">x</span><span class="p">}</span>

<span class="n">runner</span> <span class="o">=</span> <span class="n">CustomRunner</span><span class="p">(</span>
    <span class="n">input_key</span><span class="o">=</span><span class="s2">&quot;features&quot;</span><span class="p">,</span> <span class="n">output_key</span><span class="o">=</span><span class="s2">&quot;scores&quot;</span><span class="p">,</span> <span class="n">target_key</span><span class="o">=</span><span class="s2">&quot;targets&quot;</span><span class="p">,</span> <span class="n">loss_key</span><span class="o">=</span><span class="s2">&quot;loss&quot;</span>
<span class="p">)</span>
<span class="c1"># model training</span>
<span class="n">runner</span><span class="o">.</span><span class="n">train</span><span class="p">(</span>
    <span class="n">model</span><span class="o">=</span><span class="n">model</span><span class="p">,</span>
    <span class="n">criterion</span><span class="o">=</span><span class="n">criterion</span><span class="p">,</span>
    <span class="n">optimizer</span><span class="o">=</span><span class="n">optimizer</span><span class="p">,</span>
    <span class="n">loaders</span><span class="o">=</span><span class="n">loaders</span><span class="p">,</span>
    <span class="n">num_epochs</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">callbacks</span><span class="o">=</span><span class="p">[</span>
        <span class="n">dl</span><span class="o">.</span><span class="n">IOUCallback</span><span class="p">(</span><span class="n">input_key</span><span class="o">=</span><span class="s2">&quot;scores&quot;</span><span class="p">,</span> <span class="n">target_key</span><span class="o">=</span><span class="s2">&quot;targets&quot;</span><span class="p">),</span>
        <span class="n">dl</span><span class="o">.</span><span class="n">DiceCallback</span><span class="p">(</span><span class="n">input_key</span><span class="o">=</span><span class="s2">&quot;scores&quot;</span><span class="p">,</span> <span class="n">target_key</span><span class="o">=</span><span class="s2">&quot;targets&quot;</span><span class="p">),</span>
        <span class="n">dl</span><span class="o">.</span><span class="n">TrevskyCallback</span><span class="p">(</span><span class="n">input_key</span><span class="o">=</span><span class="s2">&quot;scores&quot;</span><span class="p">,</span> <span class="n">target_key</span><span class="o">=</span><span class="s2">&quot;targets&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">),</span>
    <span class="p">],</span>
    <span class="n">logdir</span><span class="o">=</span><span class="s2">&quot;./logdir&quot;</span><span class="p">,</span>
    <span class="n">valid_loader</span><span class="o">=</span><span class="s2">&quot;valid&quot;</span><span class="p">,</span>
    <span class="n">valid_metric</span><span class="o">=</span><span class="s2">&quot;loss&quot;</span><span class="p">,</span>
    <span class="n">minimize_valid_metric</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Please follow the <a class="reference external" href="https://github.com/catalyst-team/catalyst#minimal-examples">minimal examples</a> sections for more use cases.</p>
</div>
</dd></dl>

</section>
</section>
<section id="functional-api">
<h2><a class="toc-backref" href="#id43">Functional API</a><a class="headerlink" href="#functional-api" title="Permalink to this headline">¶</a></h2>
<section id="module-catalyst.metrics.functional._accuracy">
<span id="accuracy"></span><h3><a class="toc-backref" href="#id44">Accuracy</a><a class="headerlink" href="#module-catalyst.metrics.functional._accuracy" title="Permalink to this headline">¶</a></h3>
<dl class="function">
<dt id="catalyst.metrics.functional._accuracy.accuracy">
<code class="sig-prename descclassname">catalyst.metrics.functional._accuracy.</code><code class="sig-name descname">accuracy</code><span class="sig-paren">(</span><em class="sig-param">outputs: torch.Tensor</em>, <em class="sig-param">targets: torch.Tensor</em>, <em class="sig-param">topk: Sequence[int] = (1</em>, <em class="sig-param">)</em><span class="sig-paren">)</span> &#x2192; Sequence[torch.Tensor]<a class="reference internal" href="../_modules/catalyst/metrics/functional/_accuracy.html#accuracy"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#catalyst.metrics.functional._accuracy.accuracy" title="Permalink to this definition">¶</a></dt>
<dd><p>Computes multiclass <a class="reference external" href="mailto:accuracy&#37;&#52;&#48;topk">accuracy<span>&#64;</span>topk</a> for the specified values of <cite>topk</cite>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>outputs</strong> – model outputs, logits
with shape [bs; num_classes]</p></li>
<li><p><strong>targets</strong> – ground truth, labels
with shape [bs; 1]</p></li>
<li><p><strong>topk</strong> – <cite>topk</cite> for <a class="reference external" href="mailto:accuracy&#37;&#52;&#48;topk">accuracy<span>&#64;</span>topk</a> computing</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>list with computed <a class="reference external" href="mailto:accuracy&#37;&#52;&#48;topk">accuracy<span>&#64;</span>topk</a></p>
</dd>
</dl>
<p>Examples:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">torch</span>
<span class="kn">from</span> <span class="nn">catalyst</span> <span class="kn">import</span> <span class="n">metrics</span>
<span class="n">metrics</span><span class="o">.</span><span class="n">accuracy</span><span class="p">(</span>
    <span class="n">outputs</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([</span>
        <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
        <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
        <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
    <span class="p">]),</span>
    <span class="n">targets</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]),</span>
<span class="p">)</span>
<span class="c1"># [tensor([1.])]</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">torch</span>
<span class="kn">from</span> <span class="nn">catalyst</span> <span class="kn">import</span> <span class="n">metrics</span>
<span class="n">metrics</span><span class="o">.</span><span class="n">accuracy</span><span class="p">(</span>
    <span class="n">outputs</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([</span>
        <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
        <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
        <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
    <span class="p">]),</span>
    <span class="n">targets</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]),</span>
<span class="p">)</span>
<span class="c1"># [tensor([0.6667])]</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">torch</span>
<span class="kn">from</span> <span class="nn">catalyst</span> <span class="kn">import</span> <span class="n">metrics</span>
<span class="n">metrics</span><span class="o">.</span><span class="n">accuracy</span><span class="p">(</span>
    <span class="n">outputs</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([</span>
        <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
        <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
        <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
    <span class="p">]),</span>
    <span class="n">targets</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]),</span>
    <span class="n">topk</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span>
<span class="p">)</span>
<span class="c1"># [tensor([1.]), tensor([1.])]</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">torch</span>
<span class="kn">from</span> <span class="nn">catalyst</span> <span class="kn">import</span> <span class="n">metrics</span>
<span class="n">metrics</span><span class="o">.</span><span class="n">accuracy</span><span class="p">(</span>
    <span class="n">outputs</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([</span>
        <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
        <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
        <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
    <span class="p">]),</span>
    <span class="n">targets</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]),</span>
    <span class="n">topk</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span>
<span class="p">)</span>
<span class="c1"># [tensor([0.6667]), tensor([1.])]</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="catalyst.metrics.functional._accuracy.multilabel_accuracy">
<code class="sig-prename descclassname">catalyst.metrics.functional._accuracy.</code><code class="sig-name descname">multilabel_accuracy</code><span class="sig-paren">(</span><em class="sig-param">outputs: torch.Tensor, targets: torch.Tensor, threshold: Union[float, torch.Tensor]</em><span class="sig-paren">)</span> &#x2192; torch.Tensor<a class="reference internal" href="../_modules/catalyst/metrics/functional/_accuracy.html#multilabel_accuracy"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#catalyst.metrics.functional._accuracy.multilabel_accuracy" title="Permalink to this definition">¶</a></dt>
<dd><p>Computes multilabel accuracy for the specified activation and threshold.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>outputs</strong> – NxK tensor that for each of the N examples
indicates the probability of the example belonging to each of
the K classes, according to the model.</p></li>
<li><p><strong>targets</strong> – binary NxK tensort that encodes which of the K
classes are associated with the N-th input
(eg: a row [0, 1, 0, 1] indicates that the example is
associated with classes 2 and 4)</p></li>
<li><p><strong>threshold</strong> – threshold for for model output</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>computed multilabel accuracy</p>
</dd>
</dl>
<p>Examples:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">torch</span>
<span class="kn">from</span> <span class="nn">catalyst</span> <span class="kn">import</span> <span class="n">metrics</span>
<span class="n">metrics</span><span class="o">.</span><span class="n">multilabel_accuracy</span><span class="p">(</span>
    <span class="n">outputs</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([</span>
        <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
        <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
    <span class="p">]),</span>
    <span class="n">targets</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([</span>
        <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
        <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
    <span class="p">]),</span>
    <span class="n">threshold</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
<span class="p">)</span>
<span class="c1"># tensor([1.])</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">torch</span>
<span class="kn">from</span> <span class="nn">catalyst</span> <span class="kn">import</span> <span class="n">metrics</span>
<span class="n">metrics</span><span class="o">.</span><span class="n">multilabel_accuracy</span><span class="p">(</span>
    <span class="n">outputs</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([</span>
        <span class="p">[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">],</span>
        <span class="p">[</span><span class="mf">0.6</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">],</span>
    <span class="p">]),</span>
    <span class="n">targets</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([</span>
        <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
        <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
    <span class="p">]),</span>
    <span class="n">threshold</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
<span class="p">)</span>
<span class="c1"># tensor(0.7500)</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">torch</span>
<span class="kn">from</span> <span class="nn">catalyst</span> <span class="kn">import</span> <span class="n">metrics</span>
<span class="n">metrics</span><span class="o">.</span><span class="n">multilabel_accuracy</span><span class="p">(</span>
    <span class="n">outputs</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([</span>
        <span class="p">[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">],</span>
        <span class="p">[</span><span class="mf">0.4</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">],</span>
    <span class="p">]),</span>
    <span class="n">targets</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([</span>
        <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
        <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
    <span class="p">]),</span>
    <span class="n">threshold</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
<span class="p">)</span>
<span class="c1"># tensor(1.0)</span>
</pre></div>
</div>
</dd></dl>

</section>
<section id="module-catalyst.metrics.functional._auc">
<span id="auc"></span><h3><a class="toc-backref" href="#id45">AUC</a><a class="headerlink" href="#module-catalyst.metrics.functional._auc" title="Permalink to this headline">¶</a></h3>
<dl class="function">
<dt id="catalyst.metrics.functional._auc.binary_auc">
<code class="sig-prename descclassname">catalyst.metrics.functional._auc.</code><code class="sig-name descname">binary_auc</code><span class="sig-paren">(</span><em class="sig-param">scores: torch.Tensor</em>, <em class="sig-param">targets: torch.Tensor</em><span class="sig-paren">)</span> &#x2192; Tuple[float, numpy.ndarray, numpy.ndarray]<a class="reference internal" href="../_modules/catalyst/metrics/functional/_auc.html#binary_auc"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#catalyst.metrics.functional._auc.binary_auc" title="Permalink to this definition">¶</a></dt>
<dd><p>Binary AUC computation.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>scores</strong> – estimated scores from a model.</p></li>
<li><p><strong>targets</strong> – ground truth (correct) target values.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>measured roc-auc,
true positive rate, false positive rate</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>Tuple[float, np.ndarray, np.ndarray]</p>
</dd>
</dl>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>This metric is under API improvement.</p>
</div>
<p>Example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">torch</span>
<span class="kn">from</span> <span class="nn">catalyst</span> <span class="kn">import</span> <span class="n">metrics</span>
<span class="n">metrics</span><span class="o">.</span><span class="n">binary_auc</span><span class="p">(</span>
    <span class="n">scores</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([</span>
        <span class="mf">0.9</span><span class="p">,</span>
        <span class="mf">0.8</span><span class="p">,</span>
        <span class="mf">0.7</span><span class="p">,</span>
        <span class="mf">0.6</span><span class="p">,</span>
        <span class="mf">0.5</span><span class="p">,</span>
        <span class="mf">0.4</span><span class="p">,</span>
        <span class="mf">0.3</span><span class="p">,</span>
        <span class="mf">0.2</span><span class="p">,</span>
        <span class="mf">0.1</span><span class="p">,</span>
        <span class="mf">0.0</span><span class="p">,</span>
    <span class="p">]),</span>
    <span class="n">targets</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([</span>
        <span class="mi">0</span><span class="p">,</span>
        <span class="mi">1</span><span class="p">,</span>
        <span class="mi">1</span><span class="p">,</span>
        <span class="mi">1</span><span class="p">,</span>
        <span class="mi">1</span><span class="p">,</span>
        <span class="mi">1</span><span class="p">,</span>
        <span class="mi">1</span><span class="p">,</span>
        <span class="mi">0</span><span class="p">,</span>
        <span class="mi">0</span><span class="p">,</span>
        <span class="mi">0</span><span class="p">,</span>
    <span class="p">]),</span>
<span class="p">)</span>
<span class="c1"># 0.7500,</span>
<span class="c1"># [0.  , 0.  , 0.16, 0.33, 0.5 , 0.66, 0.83, 0.83, 1. , 1.  , 1.  ],</span>
<span class="c1"># [0.  , 0.25, 0.25, 0.25, 0.25, 0.25, 0.25, 0.25, 0.5, 0.75, 1.  ]</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="catalyst.metrics.functional._auc.auc">
<code class="sig-prename descclassname">catalyst.metrics.functional._auc.</code><code class="sig-name descname">auc</code><span class="sig-paren">(</span><em class="sig-param">scores: torch.Tensor</em>, <em class="sig-param">targets: torch.Tensor</em><span class="sig-paren">)</span> &#x2192; torch.Tensor<a class="reference internal" href="../_modules/catalyst/metrics/functional/_auc.html#auc"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#catalyst.metrics.functional._auc.auc" title="Permalink to this definition">¶</a></dt>
<dd><p>Computes ROC-AUC.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>scores</strong> – NxK tensor that for each of the N examples
indicates the probability of the example belonging to each of
the K classes, according to the model.</p></li>
<li><p><strong>targets</strong> – binary NxK tensort that encodes which of the K
classes are associated with the N-th input
(eg: a row [0, 1, 0, 1] indicates that the example is
associated with classes 2 and 4)</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>Tensor with [num_classes] shape of per-class-aucs</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>torch.Tensor</p>
</dd>
</dl>
<p>Examples:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">torch</span>
<span class="kn">from</span> <span class="nn">catalyst</span> <span class="kn">import</span> <span class="n">metrics</span>
<span class="n">metrics</span><span class="o">.</span><span class="n">auc</span><span class="p">(</span>
    <span class="n">scores</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([</span>
        <span class="p">[</span><span class="mf">0.9</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">],</span>
        <span class="p">[</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">],</span>
    <span class="p">]),</span>
    <span class="n">targets</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([</span>
        <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
        <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
    <span class="p">]),</span>
<span class="p">)</span>
<span class="c1"># tensor([1., 1.])</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">catalyst</span> <span class="kn">import</span> <span class="n">metrics</span>
<span class="n">metrics</span><span class="o">.</span><span class="n">auc</span><span class="p">(</span>
    <span class="n">scores</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([</span>
        <span class="p">[</span><span class="mf">0.9</span><span class="p">],</span>
        <span class="p">[</span><span class="mf">0.8</span><span class="p">],</span>
        <span class="p">[</span><span class="mf">0.7</span><span class="p">],</span>
        <span class="p">[</span><span class="mf">0.6</span><span class="p">],</span>
        <span class="p">[</span><span class="mf">0.5</span><span class="p">],</span>
        <span class="p">[</span><span class="mf">0.4</span><span class="p">],</span>
        <span class="p">[</span><span class="mf">0.3</span><span class="p">],</span>
        <span class="p">[</span><span class="mf">0.2</span><span class="p">],</span>
        <span class="p">[</span><span class="mf">0.1</span><span class="p">],</span>
        <span class="p">[</span><span class="mf">0.0</span><span class="p">],</span>
    <span class="p">]),</span>
    <span class="n">targets</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([</span>
        <span class="p">[</span><span class="mi">0</span><span class="p">],</span>
        <span class="p">[</span><span class="mi">1</span><span class="p">],</span>
        <span class="p">[</span><span class="mi">1</span><span class="p">],</span>
        <span class="p">[</span><span class="mi">1</span><span class="p">],</span>
        <span class="p">[</span><span class="mi">1</span><span class="p">],</span>
        <span class="p">[</span><span class="mi">1</span><span class="p">],</span>
        <span class="p">[</span><span class="mi">1</span><span class="p">],</span>
        <span class="p">[</span><span class="mi">0</span><span class="p">],</span>
        <span class="p">[</span><span class="mi">0</span><span class="p">],</span>
        <span class="p">[</span><span class="mi">0</span><span class="p">],</span>
    <span class="p">]),</span>
<span class="p">)</span>
<span class="c1"># tensor([0.7500])</span>
</pre></div>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>This metric is under API improvement.</p>
</div>
</dd></dl>

</section>
<section id="module-catalyst.metrics.functional._average_precision">
<span id="average-precision"></span><h3><a class="toc-backref" href="#id46">Average Precision</a><a class="headerlink" href="#module-catalyst.metrics.functional._average_precision" title="Permalink to this headline">¶</a></h3>
<dl class="function">
<dt id="catalyst.metrics.functional._average_precision.binary_average_precision">
<code class="sig-prename descclassname">catalyst.metrics.functional._average_precision.</code><code class="sig-name descname">binary_average_precision</code><span class="sig-paren">(</span><em class="sig-param">outputs: torch.Tensor</em>, <em class="sig-param">targets: torch.Tensor</em>, <em class="sig-param">weights: Optional[torch.Tensor] = None</em><span class="sig-paren">)</span> &#x2192; torch.Tensor<a class="reference internal" href="../_modules/catalyst/metrics/functional/_average_precision.html#binary_average_precision"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#catalyst.metrics.functional._average_precision.binary_average_precision" title="Permalink to this definition">¶</a></dt>
<dd><p>Computes the binary average precision.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>outputs</strong> – NxK tensor that for each of the N examples
indicates the probability of the example belonging to each of
the K classes, according to the model.</p></li>
<li><p><strong>targets</strong> – binary NxK tensort that encodes which of the K
classes are associated with the N-th input
(eg: a row [0, 1, 0, 1] indicates that the example is
associated with classes 2 and 4)</p></li>
<li><p><strong>weights</strong> – importance for each sample</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>tensor of [K; ] shape, with average precision for K classes</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>torch.Tensor</p>
</dd>
</dl>
<p>Example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">torch</span>
<span class="kn">from</span> <span class="nn">catalyst</span> <span class="kn">import</span> <span class="n">metrics</span>
<span class="n">metrics</span><span class="o">.</span><span class="n">binary_average_precision</span><span class="p">(</span>
    <span class="n">outputs</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">([</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.35</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">]),</span>
    <span class="n">targets</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]),</span>
<span class="p">)</span>
<span class="c1"># tensor([0.8333])</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="catalyst.metrics.functional._average_precision.mean_average_precision">
<code class="sig-prename descclassname">catalyst.metrics.functional._average_precision.</code><code class="sig-name descname">mean_average_precision</code><span class="sig-paren">(</span><em class="sig-param">outputs: torch.Tensor, targets: torch.Tensor, topk: List[int]</em><span class="sig-paren">)</span> &#x2192; List[torch.Tensor]<a class="reference internal" href="../_modules/catalyst/metrics/functional/_average_precision.html#mean_average_precision"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#catalyst.metrics.functional._average_precision.mean_average_precision" title="Permalink to this definition">¶</a></dt>
<dd><p>Calculate the mean average precision (MAP) for RecSys.
The metrics calculate the mean of the AP across all batches</p>
<p>MAP amplifies the interest in finding many
relevant items for each query</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>outputs</strong> (<em>torch.Tensor</em>) – Tensor with predicted score
size: [batch_size, slate_length]
model outputs, logits</p></li>
<li><p><strong>targets</strong> (<em>torch.Tensor</em>) – Binary tensor with ground truth.
1 means the item is relevant and 0 not relevant
size: [batch_szie, slate_length]
ground truth, labels</p></li>
<li><p><strong>topk</strong> (<em>List</em><em>[</em><em>int</em><em>]</em>) – List of parameter for evaluation topK items</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>The map score for every k.
size: len(top_k)</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>map_at_k (Tuple[float])</p>
</dd>
</dl>
<p>Example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">torch</span>
<span class="kn">from</span> <span class="nn">catalyst</span> <span class="kn">import</span> <span class="n">metrics</span>
<span class="n">metrics</span><span class="o">.</span><span class="n">mean_average_precision</span><span class="p">(</span>
    <span class="n">outputs</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([</span>
        <span class="p">[</span><span class="mi">9</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
        <span class="p">[</span><span class="mi">9</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
    <span class="p">]),</span>
    <span class="n">targets</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([</span>
        <span class="p">[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">],</span>
        <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">],</span>
    <span class="p">]),</span>
    <span class="n">topk</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">],</span>
<span class="p">)</span>
<span class="c1"># [tensor(0.5000), tensor(0.6667), tensor(0.6417), tensor(0.5325)]</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="catalyst.metrics.functional._average_precision.average_precision">
<code class="sig-prename descclassname">catalyst.metrics.functional._average_precision.</code><code class="sig-name descname">average_precision</code><span class="sig-paren">(</span><em class="sig-param">outputs: torch.Tensor</em>, <em class="sig-param">targets: torch.Tensor</em>, <em class="sig-param">k: int</em><span class="sig-paren">)</span> &#x2192; torch.Tensor<a class="reference internal" href="../_modules/catalyst/metrics/functional/_average_precision.html#average_precision"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#catalyst.metrics.functional._average_precision.average_precision" title="Permalink to this definition">¶</a></dt>
<dd><p>Calculate the Average Precision for RecSys.
The precision metric summarizes the fraction of relevant items
out of the whole the recommendation list.</p>
<p>To compute the precision at k set the threshold rank k,
compute the percentage of relevant items in topK,
ignoring the documents ranked lower than k.</p>
<p>The average precision at k (AP at k) summarizes the average
precision for relevant items up to the k-th one.
Wikipedia entry for the Average precision</p>
<p>&lt;<a class="reference external" href="https://en.wikipedia.org/w/index.php">https://en.wikipedia.org/w/index.php</a>?title=Information_retrieval&amp;
oldid=793358396#Average_precision&gt;</p>
<p>If a relevant document never gets retrieved,
we assume the precision corresponding to that
relevant doc to be zero</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>outputs</strong> (<em>torch.Tensor</em>) – Tensor with predicted score
size: [batch_size, slate_length]
model outputs, logits</p></li>
<li><p><strong>targets</strong> (<em>torch.Tensor</em>) – Binary tensor with ground truth.
1 means the item is relevant
and 0 not relevant
size: [batch_szie, slate_length]
ground truth, labels</p></li>
<li><p><strong>k</strong> – Parameter for evaluation on top-k items</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>The map score for each batch.
size: [batch_size, 1]</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>ap_score (torch.Tensor)</p>
</dd>
</dl>
<p>Example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">torch</span>
<span class="kn">from</span> <span class="nn">catalyst</span> <span class="kn">import</span> <span class="n">metrics</span>
<span class="n">metrics</span><span class="o">.</span><span class="n">average_precision</span><span class="p">(</span>
    <span class="n">outputs</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([</span>
        <span class="p">[</span><span class="mi">9</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
        <span class="p">[</span><span class="mi">9</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
    <span class="p">]),</span>
    <span class="n">targets</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([</span>
        <span class="p">[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">],</span>
        <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">],</span>
    <span class="p">]),</span>
    <span class="n">k</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
<span class="p">)</span>
<span class="c1"># tensor([0.6222, 0.4429])</span>
</pre></div>
</div>
</dd></dl>

</section>
<section id="module-catalyst.metrics.functional._classification">
<span id="classification"></span><h3><a class="toc-backref" href="#id47">Classification</a><a class="headerlink" href="#module-catalyst.metrics.functional._classification" title="Permalink to this headline">¶</a></h3>
<dl class="function">
<dt id="catalyst.metrics.functional._classification.f1score">
<code class="sig-prename descclassname">catalyst.metrics.functional._classification.</code><code class="sig-name descname">f1score</code><span class="sig-paren">(</span><em class="sig-param">precision_value</em>, <em class="sig-param">recall_value</em>, <em class="sig-param">eps=1e-05</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/catalyst/metrics/functional/_classification.html#f1score"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#catalyst.metrics.functional._classification.f1score" title="Permalink to this definition">¶</a></dt>
<dd><p>Calculating F1-score from precision and recall to reduce computation redundancy.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>precision_value</strong> – precision (0-1)</p></li>
<li><p><strong>recall_value</strong> – recall (0-1)</p></li>
<li><p><strong>eps</strong> – epsilon to use</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>F1 score (0-1)</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="catalyst.metrics.functional._classification.precision_recall_fbeta_support">
<code class="sig-prename descclassname">catalyst.metrics.functional._classification.</code><code class="sig-name descname">precision_recall_fbeta_support</code><span class="sig-paren">(</span><em class="sig-param">outputs: torch.Tensor</em>, <em class="sig-param">targets: torch.Tensor</em>, <em class="sig-param">beta: float = 1</em>, <em class="sig-param">eps: float = 1e-06</em>, <em class="sig-param">argmax_dim: int = -1</em>, <em class="sig-param">num_classes: Optional[int] = None</em>, <em class="sig-param">zero_division: int = 0</em><span class="sig-paren">)</span> &#x2192; Tuple[torch.Tensor, torch.Tensor, torch.Tensor, torch.Tensor]<a class="reference internal" href="../_modules/catalyst/metrics/functional/_classification.html#precision_recall_fbeta_support"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#catalyst.metrics.functional._classification.precision_recall_fbeta_support" title="Permalink to this definition">¶</a></dt>
<dd><p>Counts precision_val, recall, fbeta_score.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>outputs</strong> – A list of predicted elements</p></li>
<li><p><strong>targets</strong> – A list of elements that are to be predicted</p></li>
<li><p><strong>beta</strong> – beta param for f_score</p></li>
<li><p><strong>eps</strong> – epsilon to avoid zero division</p></li>
<li><p><strong>argmax_dim</strong> – int, that specifies dimension for argmax transformation
in case of scores/probabilities in <code class="docutils literal notranslate"><span class="pre">outputs</span></code></p></li>
<li><p><strong>num_classes</strong> – int, that specifies number of classes if it known.</p></li>
<li><p><strong>zero_division</strong> – int value, should be one of 0 or 1;
used for precision_val and recall computation</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>tuple of precision_val, recall, fbeta_score</p>
</dd>
</dl>
<p>Examples:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">torch</span>
<span class="kn">from</span> <span class="nn">catalyst</span> <span class="kn">import</span> <span class="n">metrics</span>
<span class="n">metrics</span><span class="o">.</span><span class="n">precision_recall_fbeta_support</span><span class="p">(</span>
    <span class="n">outputs</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([</span>
        <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
        <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
        <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
    <span class="p">]),</span>
    <span class="n">targets</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]),</span>
    <span class="n">beta</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
<span class="p">)</span>
<span class="c1"># (</span>
<span class="c1">#     tensor([1., 1., 1.]),  # per class precision</span>
<span class="c1">#     tensor([1., 1., 1.]),  # per class recall</span>
<span class="c1">#     tensor([1., 1., 1.]),  # per class fbeta</span>
<span class="c1">#     tensor([1., 1., 1.]),  # per class support</span>
<span class="c1"># )</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">torch</span>
<span class="kn">from</span> <span class="nn">catalyst</span> <span class="kn">import</span> <span class="n">metrics</span>
<span class="n">metrics</span><span class="o">.</span><span class="n">precision_recall_fbeta_support</span><span class="p">(</span>
    <span class="n">outputs</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]]),</span>
    <span class="n">targets</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]]),</span>
    <span class="n">beta</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
<span class="p">)</span>
<span class="c1"># (</span>
<span class="c1">#     tensor([0.5000, 0.5000]),  # per class precision</span>
<span class="c1">#     tensor([0.5000, 0.5000]),  # per class recall</span>
<span class="c1">#     tensor([0.5000, 0.5000]),  # per class fbeta</span>
<span class="c1">#     tensor([4., 4.]),          # per class support</span>
<span class="c1"># )</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="catalyst.metrics.functional._classification.precision">
<code class="sig-prename descclassname">catalyst.metrics.functional._classification.</code><code class="sig-name descname">precision</code><span class="sig-paren">(</span><em class="sig-param">tp: int</em>, <em class="sig-param">fp: int</em>, <em class="sig-param">zero_division: int = 0</em><span class="sig-paren">)</span> &#x2192; float<a class="reference internal" href="../_modules/catalyst/metrics/functional/_classification.html#precision"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#catalyst.metrics.functional._classification.precision" title="Permalink to this definition">¶</a></dt>
<dd><p>Calculates precision (a.k.a. positive predictive value) for binary
classification and segmentation.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>tp</strong> – number of true positives</p></li>
<li><p><strong>fp</strong> – number of false positives</p></li>
<li><p><strong>zero_division</strong> – int value, should be one of 0 or 1; if both tp==0 and fp==0 return this
value as s result</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>precision value (0-1)</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="catalyst.metrics.functional._classification.recall">
<code class="sig-prename descclassname">catalyst.metrics.functional._classification.</code><code class="sig-name descname">recall</code><span class="sig-paren">(</span><em class="sig-param">tp: int</em>, <em class="sig-param">fn: int</em>, <em class="sig-param">zero_division: int = 0</em><span class="sig-paren">)</span> &#x2192; float<a class="reference internal" href="../_modules/catalyst/metrics/functional/_classification.html#recall"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#catalyst.metrics.functional._classification.recall" title="Permalink to this definition">¶</a></dt>
<dd><p>Calculates recall (a.k.a. true positive rate) for binary classification and segmentation.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>tp</strong> – number of true positives</p></li>
<li><p><strong>fn</strong> – number of false negatives</p></li>
<li><p><strong>zero_division</strong> – int value, should be one of 0 or 1; if both tp==0 and fn==0 return this
value as s result</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>recall value (0-1)</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="catalyst.metrics.functional._classification.get_aggregated_metrics">
<code class="sig-prename descclassname">catalyst.metrics.functional._classification.</code><code class="sig-name descname">get_aggregated_metrics</code><span class="sig-paren">(</span><em class="sig-param">tp: numpy.array</em>, <em class="sig-param">fp: numpy.array</em>, <em class="sig-param">fn: numpy.array</em>, <em class="sig-param">support: numpy.array</em>, <em class="sig-param">zero_division: int = 0</em><span class="sig-paren">)</span> &#x2192; Tuple[numpy.array, numpy.array, numpy.array, numpy.array]<a class="reference internal" href="../_modules/catalyst/metrics/functional/_classification.html#get_aggregated_metrics"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#catalyst.metrics.functional._classification.get_aggregated_metrics" title="Permalink to this definition">¶</a></dt>
<dd><p>Count precision, recall, f1 scores per-class and with macro, weighted and micro average
with statistics.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>tp</strong> – array of shape (num_classes, ) of true positive statistics per class</p></li>
<li><p><strong>fp</strong> – array of shape (num_classes, ) of false positive statistics per class</p></li>
<li><p><strong>fn</strong> – array of shape (num_classes, ) of false negative statistics per class</p></li>
<li><p><strong>support</strong> – array of shape (num_classes, ) of samples count per class</p></li>
<li><p><strong>zero_division</strong> – int value, should be one of 0 or 1;
used for precision and recall computation</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>per-class, micro, macro, weighted averaging</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>arrays of metrics</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="catalyst.metrics.functional._classification.get_binary_metrics">
<code class="sig-prename descclassname">catalyst.metrics.functional._classification.</code><code class="sig-name descname">get_binary_metrics</code><span class="sig-paren">(</span><em class="sig-param">tp: int</em>, <em class="sig-param">fp: int</em>, <em class="sig-param">fn: int</em>, <em class="sig-param">zero_division: int</em><span class="sig-paren">)</span> &#x2192; Tuple[float, float, float]<a class="reference internal" href="../_modules/catalyst/metrics/functional/_classification.html#get_binary_metrics"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#catalyst.metrics.functional._classification.get_binary_metrics" title="Permalink to this definition">¶</a></dt>
<dd><dl class="simple">
<dt>Get precision, recall, f1 score metrics from true positive, false positive,</dt><dd><p>false negative statistics for binary classification</p>
</dd>
</dl>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>tp</strong> – true positive</p></li>
<li><p><strong>fp</strong> – false positive</p></li>
<li><p><strong>fn</strong> – false negative</p></li>
<li><p><strong>zero_division</strong> – int value, should be 0 or 1</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>precision, recall, f1 scores</p>
</dd>
</dl>
</dd></dl>

</section>
<section id="module-catalyst.metrics.functional._cmc_score">
<span id="cmc-score"></span><h3><a class="toc-backref" href="#id48">CMC Score</a><a class="headerlink" href="#module-catalyst.metrics.functional._cmc_score" title="Permalink to this headline">¶</a></h3>
<dl class="function">
<dt id="catalyst.metrics.functional._cmc_score.cmc_score_count">
<code class="sig-prename descclassname">catalyst.metrics.functional._cmc_score.</code><code class="sig-name descname">cmc_score_count</code><span class="sig-paren">(</span><em class="sig-param">distances: torch.Tensor</em>, <em class="sig-param">conformity_matrix: torch.Tensor</em>, <em class="sig-param">topk: int = 1</em><span class="sig-paren">)</span> &#x2192; float<a class="reference internal" href="../_modules/catalyst/metrics/functional/_cmc_score.html#cmc_score_count"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#catalyst.metrics.functional._cmc_score.cmc_score_count" title="Permalink to this definition">¶</a></dt>
<dd><p>Function to count CMC from distance matrix and conformity matrix.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>distances</strong> – distance matrix shape of (n_embeddings_x, n_embeddings_y)</p></li>
<li><p><strong>conformity_matrix</strong> – binary matrix with 1 on same label pos and 0 otherwise</p></li>
<li><p><strong>topk</strong> – number of top examples for cumulative score counting</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>cmc score</p>
</dd>
</dl>
<p>Examples:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">torch</span>
<span class="kn">from</span> <span class="nn">catalyst</span> <span class="kn">import</span> <span class="n">metrics</span>
<span class="n">metrics</span><span class="o">.</span><span class="n">cmc_score_count</span><span class="p">(</span>
    <span class="n">distances</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">]]),</span>
    <span class="n">conformity_matrix</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]]),</span>
    <span class="n">topk</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
<span class="p">)</span>
<span class="c1"># 0.0</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">torch</span>
<span class="kn">from</span> <span class="nn">catalyst</span> <span class="kn">import</span> <span class="n">metrics</span>
<span class="n">metrics</span><span class="o">.</span><span class="n">cmc_score_count</span><span class="p">(</span>
    <span class="n">distances</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">],</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.4</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]]),</span>
    <span class="n">conformity_matrix</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]]),</span>
    <span class="n">topk</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
<span class="p">)</span>
<span class="c1"># 0.33</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="catalyst.metrics.functional._cmc_score.cmc_score">
<code class="sig-prename descclassname">catalyst.metrics.functional._cmc_score.</code><code class="sig-name descname">cmc_score</code><span class="sig-paren">(</span><em class="sig-param">query_embeddings: torch.Tensor</em>, <em class="sig-param">gallery_embeddings: torch.Tensor</em>, <em class="sig-param">conformity_matrix: torch.Tensor</em>, <em class="sig-param">topk: int = 1</em><span class="sig-paren">)</span> &#x2192; float<a class="reference internal" href="../_modules/catalyst/metrics/functional/_cmc_score.html#cmc_score"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#catalyst.metrics.functional._cmc_score.cmc_score" title="Permalink to this definition">¶</a></dt>
<dd><p>Function to count CMC score from query and gallery embeddings.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>query_embeddings</strong> – tensor shape of (n_embeddings, embedding_dim)
embeddings of the objects in query</p></li>
<li><p><strong>gallery_embeddings</strong> – tensor shape of (n_embeddings, embedding_dim)
embeddings of the objects in gallery</p></li>
<li><p><strong>conformity_matrix</strong> – binary matrix with 1 on same label pos and 0 otherwise</p></li>
<li><p><strong>topk</strong> – number of top examples for cumulative score counting</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>cmc score</p>
</dd>
</dl>
<p>Example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">torch</span>
<span class="kn">from</span> <span class="nn">catalyst</span> <span class="kn">import</span> <span class="n">metrics</span>
<span class="n">metrics</span><span class="o">.</span><span class="n">cmc_score</span><span class="p">(</span>
    <span class="n">query_embeddings</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([</span>
        <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
    <span class="p">])</span><span class="o">.</span><span class="n">float</span><span class="p">(),</span>
    <span class="n">gallery_embeddings</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([</span>
        <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
    <span class="p">])</span><span class="o">.</span><span class="n">float</span><span class="p">(),</span>
    <span class="n">conformity_matrix</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([</span>
        <span class="p">[</span><span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">],</span>
        <span class="p">[</span><span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">],</span>
        <span class="p">[</span><span class="kc">False</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">],</span>
        <span class="p">[</span><span class="kc">False</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">],</span>
    <span class="p">]),</span>
    <span class="n">topk</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
<span class="p">)</span>
<span class="c1"># 1.0</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="catalyst.metrics.functional._cmc_score.masked_cmc_score">
<code class="sig-prename descclassname">catalyst.metrics.functional._cmc_score.</code><code class="sig-name descname">masked_cmc_score</code><span class="sig-paren">(</span><em class="sig-param">query_embeddings: torch.Tensor</em>, <em class="sig-param">gallery_embeddings: torch.Tensor</em>, <em class="sig-param">conformity_matrix: torch.Tensor</em>, <em class="sig-param">available_samples: torch.Tensor</em>, <em class="sig-param">topk: int = 1</em><span class="sig-paren">)</span> &#x2192; float<a class="reference internal" href="../_modules/catalyst/metrics/functional/_cmc_score.html#masked_cmc_score"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#catalyst.metrics.functional._cmc_score.masked_cmc_score" title="Permalink to this definition">¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>query_embeddings</strong> – tensor shape of (n_embeddings, embedding_dim)
embeddings of the objects in query</p></li>
<li><p><strong>gallery_embeddings</strong> – tensor shape of (n_embeddings, embedding_dim)
embeddings of the objects in gallery</p></li>
<li><p><strong>conformity_matrix</strong> – binary matrix with 1 on same label pos
and 0 otherwise</p></li>
<li><p><strong>available_samples</strong> – tensor of shape (query_size, gallery_size),
available_samples[i][j] == 1 means that j-th element of gallery
should be used while scoring i-th query one</p></li>
<li><p><strong>topk</strong> – number of top examples for cumulative score counting</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>cmc score with mask</p>
</dd>
<dt class="field-odd">Raises</dt>
<dd class="field-odd"><p><strong>ValueError</strong> – if there are items that have different labels and are
    unavailable for each other according to availability matrix</p>
</dd>
</dl>
<p>Example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">torch</span>
<span class="kn">from</span> <span class="nn">catalyst</span> <span class="kn">import</span> <span class="n">metrics</span>
<span class="n">metrics</span><span class="o">.</span><span class="n">masked_cmc_score</span><span class="p">(</span>
    <span class="n">query_embeddings</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([</span>
        <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
    <span class="p">])</span><span class="o">.</span><span class="n">float</span><span class="p">(),</span>
    <span class="n">gallery_embeddings</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([</span>
        <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
    <span class="p">])</span><span class="o">.</span><span class="n">float</span><span class="p">(),</span>
    <span class="n">conformity_matrix</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([</span>
        <span class="p">[</span><span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">],</span>
        <span class="p">[</span><span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">],</span>
        <span class="p">[</span><span class="kc">False</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">],</span>
        <span class="p">[</span><span class="kc">False</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">],</span>
    <span class="p">]),</span>
    <span class="n">available_samples</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([</span>
        <span class="p">[</span><span class="kc">False</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">],</span>
        <span class="p">[</span><span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">],</span>
        <span class="p">[</span><span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">True</span><span class="p">],</span>
        <span class="p">[</span><span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">],</span>
    <span class="p">]),</span>
    <span class="n">topk</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
<span class="p">)</span>
<span class="c1"># 0.75</span>
</pre></div>
</div>
</dd></dl>

</section>
<section id="module-catalyst.metrics.functional._f1_score">
<span id="f1-score"></span><h3><a class="toc-backref" href="#id49">F1 score</a><a class="headerlink" href="#module-catalyst.metrics.functional._f1_score" title="Permalink to this headline">¶</a></h3>
<dl class="function">
<dt id="catalyst.metrics.functional._f1_score.f1_score">
<code class="sig-prename descclassname">catalyst.metrics.functional._f1_score.</code><code class="sig-name descname">f1_score</code><span class="sig-paren">(</span><em class="sig-param">outputs: torch.Tensor</em>, <em class="sig-param">targets: torch.Tensor</em>, <em class="sig-param">eps: float = 1e-07</em>, <em class="sig-param">argmax_dim: int = -1</em>, <em class="sig-param">num_classes: Optional[int] = None</em><span class="sig-paren">)</span> &#x2192; Union[float, torch.Tensor]<a class="reference internal" href="../_modules/catalyst/metrics/functional/_f1_score.html#f1_score"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#catalyst.metrics.functional._f1_score.f1_score" title="Permalink to this definition">¶</a></dt>
<dd><p>Fbeta_score with beta=1.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>outputs</strong> – A list of predicted elements</p></li>
<li><p><strong>targets</strong> – A list of elements that are to be predicted</p></li>
<li><p><strong>eps</strong> – epsilon to avoid zero division</p></li>
<li><p><strong>argmax_dim</strong> – int, that specifies dimension for argmax transformation
in case of scores/probabilities in <code class="docutils literal notranslate"><span class="pre">outputs</span></code></p></li>
<li><p><strong>num_classes</strong> – int, that specifies number of classes if it known</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>F_1 score</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>float</p>
</dd>
</dl>
<p>Example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">torch</span>
<span class="kn">from</span> <span class="nn">catalyst</span> <span class="kn">import</span> <span class="n">metrics</span>
<span class="n">metrics</span><span class="o">.</span><span class="n">f1_score</span><span class="p">(</span>
    <span class="n">outputs</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([</span>
        <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
        <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
        <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
    <span class="p">]),</span>
    <span class="n">targets</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]),</span>
<span class="p">)</span>
<span class="c1"># tensor([1., 1., 1.]),  # per class fbeta</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="catalyst.metrics.functional._f1_score.fbeta_score">
<code class="sig-prename descclassname">catalyst.metrics.functional._f1_score.</code><code class="sig-name descname">fbeta_score</code><span class="sig-paren">(</span><em class="sig-param">outputs: torch.Tensor</em>, <em class="sig-param">targets: torch.Tensor</em>, <em class="sig-param">beta: float = 1.0</em>, <em class="sig-param">eps: float = 1e-07</em>, <em class="sig-param">argmax_dim: int = -1</em>, <em class="sig-param">num_classes: Optional[int] = None</em><span class="sig-paren">)</span> &#x2192; Union[float, torch.Tensor]<a class="reference internal" href="../_modules/catalyst/metrics/functional/_f1_score.html#fbeta_score"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#catalyst.metrics.functional._f1_score.fbeta_score" title="Permalink to this definition">¶</a></dt>
<dd><p>Counts fbeta score for given <code class="docutils literal notranslate"><span class="pre">outputs</span></code> and <code class="docutils literal notranslate"><span class="pre">targets</span></code>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>outputs</strong> – A list of predicted elements</p></li>
<li><p><strong>targets</strong> – A list of elements that are to be predicted</p></li>
<li><p><strong>beta</strong> – beta param for f_score</p></li>
<li><p><strong>eps</strong> – epsilon to avoid zero division</p></li>
<li><p><strong>argmax_dim</strong> – int, that specifies dimension for argmax transformation
in case of scores/probabilities in <code class="docutils literal notranslate"><span class="pre">outputs</span></code></p></li>
<li><p><strong>num_classes</strong> – int, that specifies number of classes if it known</p></li>
</ul>
</dd>
<dt class="field-even">Raises</dt>
<dd class="field-even"><p><strong>ValueError</strong> – If <code class="docutils literal notranslate"><span class="pre">beta</span></code> is a negative number.</p>
</dd>
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p>F_beta score.</p>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p>float</p>
</dd>
</dl>
<p>Example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">torch</span>
<span class="kn">from</span> <span class="nn">catalyst</span> <span class="kn">import</span> <span class="n">metrics</span>
<span class="n">metrics</span><span class="o">.</span><span class="n">fbeta_score</span><span class="p">(</span>
    <span class="n">outputs</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([</span>
        <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
        <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
        <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
    <span class="p">]),</span>
    <span class="n">targets</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]),</span>
    <span class="n">beta</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
<span class="p">)</span>
<span class="c1"># tensor([1., 1., 1.]),  # per class fbeta</span>
</pre></div>
</div>
</dd></dl>

</section>
<section id="module-catalyst.metrics.functional._focal">
<span id="focal"></span><h3><a class="toc-backref" href="#id50">Focal</a><a class="headerlink" href="#module-catalyst.metrics.functional._focal" title="Permalink to this headline">¶</a></h3>
<dl class="function">
<dt id="catalyst.metrics.functional._focal.sigmoid_focal_loss">
<code class="sig-prename descclassname">catalyst.metrics.functional._focal.</code><code class="sig-name descname">sigmoid_focal_loss</code><span class="sig-paren">(</span><em class="sig-param">outputs: torch.Tensor</em>, <em class="sig-param">targets: torch.Tensor</em>, <em class="sig-param">gamma: float = 2.0</em>, <em class="sig-param">alpha: float = 0.25</em>, <em class="sig-param">reduction: str = 'mean'</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/catalyst/metrics/functional/_focal.html#sigmoid_focal_loss"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#catalyst.metrics.functional._focal.sigmoid_focal_loss" title="Permalink to this definition">¶</a></dt>
<dd><p>Compute binary focal loss between target and output logits.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>outputs</strong> – tensor of arbitrary shape</p></li>
<li><p><strong>targets</strong> – tensor of the same shape as input</p></li>
<li><p><strong>gamma</strong> – gamma for focal loss</p></li>
<li><p><strong>alpha</strong> – alpha for focal loss</p></li>
<li><p><strong>reduction</strong> (<em>string</em><em>, </em><em>optional</em>) – specifies the reduction to apply to the output:
<code class="docutils literal notranslate"><span class="pre">&quot;none&quot;</span></code> | <code class="docutils literal notranslate"><span class="pre">&quot;mean&quot;</span></code> | <code class="docutils literal notranslate"><span class="pre">&quot;sum&quot;</span></code> | <code class="docutils literal notranslate"><span class="pre">&quot;batchwise_mean&quot;</span></code>.
<code class="docutils literal notranslate"><span class="pre">&quot;none&quot;</span></code>: no reduction will be applied,
<code class="docutils literal notranslate"><span class="pre">&quot;mean&quot;</span></code>: the sum of the output will be divided by the number of
elements in the output,
<code class="docutils literal notranslate"><span class="pre">&quot;sum&quot;</span></code>: the output will be summed.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>computed loss</p>
</dd>
</dl>
<p>Source: <a class="reference external" href="https://github.com/BloodAxe/pytorch-toolbelt">https://github.com/BloodAxe/pytorch-toolbelt</a></p>
</dd></dl>

<dl class="function">
<dt id="catalyst.metrics.functional._focal.reduced_focal_loss">
<code class="sig-prename descclassname">catalyst.metrics.functional._focal.</code><code class="sig-name descname">reduced_focal_loss</code><span class="sig-paren">(</span><em class="sig-param">outputs: torch.Tensor</em>, <em class="sig-param">targets: torch.Tensor</em>, <em class="sig-param">threshold: float = 0.5</em>, <em class="sig-param">gamma: float = 2.0</em>, <em class="sig-param">reduction='mean'</em><span class="sig-paren">)</span> &#x2192; torch.Tensor<a class="reference internal" href="../_modules/catalyst/metrics/functional/_focal.html#reduced_focal_loss"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#catalyst.metrics.functional._focal.reduced_focal_loss" title="Permalink to this definition">¶</a></dt>
<dd><p>Compute reduced focal loss between target and output logits.</p>
<p>It has been proposed in <a class="reference external" href="https://arxiv.org/abs/1903.01347">Reduced Focal Loss: 1st Place Solution to xView
object detection in Satellite Imagery</a> paper.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><code class="docutils literal notranslate"><span class="pre">size_average</span></code> and <code class="docutils literal notranslate"><span class="pre">reduce</span></code> params are in the process of being
deprecated, and in the meantime, specifying either of those two args
will override <code class="docutils literal notranslate"><span class="pre">reduction</span></code>.</p>
</div>
<p>Source: <a class="reference external" href="https://github.com/BloodAxe/pytorch-toolbelt">https://github.com/BloodAxe/pytorch-toolbelt</a></p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>outputs</strong> – tensor of arbitrary shape</p></li>
<li><p><strong>targets</strong> – tensor of the same shape as input</p></li>
<li><p><strong>threshold</strong> – threshold for focal reduction</p></li>
<li><p><strong>gamma</strong> – gamma for focal reduction</p></li>
<li><p><strong>reduction</strong> – specifies the reduction to apply to the output:
<code class="docutils literal notranslate"><span class="pre">&quot;none&quot;</span></code> | <code class="docutils literal notranslate"><span class="pre">&quot;mean&quot;</span></code> | <code class="docutils literal notranslate"><span class="pre">&quot;sum&quot;</span></code> | <code class="docutils literal notranslate"><span class="pre">&quot;batchwise_mean&quot;</span></code>.
<code class="docutils literal notranslate"><span class="pre">&quot;none&quot;</span></code>: no reduction will be applied,
<code class="docutils literal notranslate"><span class="pre">&quot;mean&quot;</span></code>: the sum of the output will be divided by the number of
elements in the output,
<code class="docutils literal notranslate"><span class="pre">&quot;sum&quot;</span></code>: the output will be summed.
<code class="docutils literal notranslate"><span class="pre">&quot;batchwise_mean&quot;</span></code> computes mean loss per sample in batch.
Default: “mean”</p></li>
</ul>
</dd>
</dl>
<dl class="simple">
<dt>Returns:  # noqa: DAR201</dt><dd><p>torch.Tensor: computed loss</p>
</dd>
</dl>
</dd></dl>

</section>
<section id="module-catalyst.metrics.functional._hitrate">
<span id="hitrate"></span><h3><a class="toc-backref" href="#id51">Hitrate</a><a class="headerlink" href="#module-catalyst.metrics.functional._hitrate" title="Permalink to this headline">¶</a></h3>
<dl class="function">
<dt id="catalyst.metrics.functional._hitrate.hitrate">
<code class="sig-prename descclassname">catalyst.metrics.functional._hitrate.</code><code class="sig-name descname">hitrate</code><span class="sig-paren">(</span><em class="sig-param">outputs: torch.Tensor, targets: torch.Tensor, topk: List[int], zero_division: int = 0</em><span class="sig-paren">)</span> &#x2192; List[torch.Tensor]<a class="reference internal" href="../_modules/catalyst/metrics/functional/_hitrate.html#hitrate"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#catalyst.metrics.functional._hitrate.hitrate" title="Permalink to this definition">¶</a></dt>
<dd><p>Calculate the hit rate (aka recall) score given
model outputs and targets.
Hit-rate is a metric for evaluating ranking systems.
Generate top-N recommendations and if one of the recommendation is
actually what user has rated, you consider that a hit.
By rate we mean any explicit form of user’s interactions.
Add up all of the hits for all users and then divide by number of users</p>
<p>Compute top-N recommendation for each user in the training stage
and intentionally remove one of this items fro the training data.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>outputs</strong> (<em>torch.Tensor</em>) – Tensor with predicted score
size: [batch_size, slate_length]
model outputs, logits</p></li>
<li><p><strong>targets</strong> (<em>torch.Tensor</em>) – Binary tensor with ground truth.
1 means the item is relevant
for the user and 0 not relevant
size: [batch_size, slate_length]
ground truth, labels</p></li>
<li><p><strong>topk</strong> (<em>List</em><em>[</em><em>int</em><em>]</em>) – Parameter fro evaluation on top-k items</p></li>
<li><p><strong>zero_division</strong> (<em>int</em>) – value, returns in the case of the divison by zero
should be one of 0 or 1</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>the hitrate score</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>hitrate_at_k (List[torch.Tensor])</p>
</dd>
</dl>
<p>Example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">torch</span>
<span class="kn">from</span> <span class="nn">catalyst</span> <span class="kn">import</span> <span class="n">metrics</span>
<span class="n">metrics</span><span class="o">.</span><span class="n">hitrate</span><span class="p">(</span>
    <span class="n">outputs</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">([[</span><span class="mf">4.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">],</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">,</span> <span class="mf">4.0</span><span class="p">]]),</span>
    <span class="n">targets</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">([[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">]]),</span>
    <span class="n">topk</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span>
<span class="p">)</span>
<span class="c1"># [tensor(0.), tensor(0.2500), tensor(0.2500), tensor(0.5000)]</span>
</pre></div>
</div>
</dd></dl>

</section>
<section id="module-catalyst.metrics.functional._mrr">
<span id="mrr"></span><h3><a class="toc-backref" href="#id52">MRR</a><a class="headerlink" href="#module-catalyst.metrics.functional._mrr" title="Permalink to this headline">¶</a></h3>
<dl class="function">
<dt id="catalyst.metrics.functional._mrr.reciprocal_rank">
<code class="sig-prename descclassname">catalyst.metrics.functional._mrr.</code><code class="sig-name descname">reciprocal_rank</code><span class="sig-paren">(</span><em class="sig-param">outputs: torch.Tensor</em>, <em class="sig-param">targets: torch.Tensor</em>, <em class="sig-param">k: int</em><span class="sig-paren">)</span> &#x2192; torch.Tensor<a class="reference internal" href="../_modules/catalyst/metrics/functional/_mrr.html#reciprocal_rank"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#catalyst.metrics.functional._mrr.reciprocal_rank" title="Permalink to this definition">¶</a></dt>
<dd><p>Calculate the Reciprocal Rank (MRR)
score given model outputs and targets
Data aggregated in batches.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>outputs</strong> – Tensor weith predicted score
size: [batch_size, slate_length]
model outputs, logits</p></li>
<li><p><strong>targets</strong> – Binary tensor with ground truth.
1 means the item is relevant
and 0 if it’s not relevant
size: [batch_size, slate_length]
ground truth, labels</p></li>
<li><p><strong>k</strong> – Parameter for evaluation on top-k items</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>MRR score</p>
</dd>
</dl>
<p>Examples:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">torch</span>
<span class="kn">from</span> <span class="nn">catalyst</span> <span class="kn">import</span> <span class="n">metrics</span>
<span class="n">metrics</span><span class="o">.</span><span class="n">reciprocal_rank</span><span class="p">(</span>
    <span class="n">outputs</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">([</span>
        <span class="p">[</span><span class="mf">4.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">],</span>
        <span class="p">[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">,</span> <span class="mf">4.0</span><span class="p">],</span>
    <span class="p">]),</span>
    <span class="n">targets</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">([</span>
        <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">],</span>
        <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">],</span>
    <span class="p">]),</span>
    <span class="n">k</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
<span class="p">)</span>
<span class="c1"># tensor([[0.], [1.]])</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">torch</span>
<span class="kn">from</span> <span class="nn">catalyst</span> <span class="kn">import</span> <span class="n">metrics</span>
<span class="n">metrics</span><span class="o">.</span><span class="n">reciprocal_rank</span><span class="p">(</span>
    <span class="n">outputs</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">([</span>
        <span class="p">[</span><span class="mf">4.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">],</span>
        <span class="p">[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">,</span> <span class="mf">4.0</span><span class="p">],</span>
    <span class="p">]),</span>
    <span class="n">targets</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">([</span>
        <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">],</span>
        <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">],</span>
    <span class="p">]),</span>
    <span class="n">k</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
<span class="p">)</span>
<span class="c1"># tensor([[0.5000], [1.0000]])</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="catalyst.metrics.functional._mrr.mrr">
<code class="sig-prename descclassname">catalyst.metrics.functional._mrr.</code><code class="sig-name descname">mrr</code><span class="sig-paren">(</span><em class="sig-param">outputs: torch.Tensor, targets: torch.Tensor, topk: List[int]</em><span class="sig-paren">)</span> &#x2192; List[torch.Tensor]<a class="reference internal" href="../_modules/catalyst/metrics/functional/_mrr.html#mrr"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#catalyst.metrics.functional._mrr.mrr" title="Permalink to this definition">¶</a></dt>
<dd><p>Calculate the Mean Reciprocal Rank (MRR)
score given model outputs and targets
Data aggregated in batches.</p>
<p>The MRR&#64;k is the mean overall batch of the
reciprocal rank, that is the rank of the highest
ranked relevant item, if any in the top <em>k</em>, 0 otherwise.
<a class="reference external" href="https://en.wikipedia.org/wiki/Mean_reciprocal_rank">https://en.wikipedia.org/wiki/Mean_reciprocal_rank</a></p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>outputs</strong> – Tensor weith predicted score
size: [batch_size, slate_length]
model outputs, logits</p></li>
<li><p><strong>targets</strong> – Binary tensor with ground truth.
1 means the item is relevant
and 0 if it’s not relevant
size: [batch_szie, slate_length]
ground truth, labels</p></li>
<li><p><strong>topk</strong> – Parameter fro evaluation on top-k items</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>MRR score</p>
</dd>
</dl>
<p>Example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">torch</span>
<span class="kn">from</span> <span class="nn">catalyst</span> <span class="kn">import</span> <span class="n">metrics</span>
<span class="n">metrics</span><span class="o">.</span><span class="n">mrr</span><span class="p">(</span>
    <span class="n">outputs</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">([</span>
        <span class="p">[</span><span class="mf">4.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">],</span>
        <span class="p">[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">,</span> <span class="mf">4.0</span><span class="p">],</span>
    <span class="p">]),</span>
    <span class="n">targets</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">([</span>
        <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">],</span>
        <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">],</span>
    <span class="p">]),</span>
    <span class="n">topk</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span>
<span class="p">)</span>
<span class="c1"># [tensor(0.5000), tensor(0.7500)]</span>
</pre></div>
</div>
</dd></dl>

</section>
<section id="module-catalyst.metrics.functional._ndcg">
<span id="ndcg"></span><h3><a class="toc-backref" href="#id53">NDCG</a><a class="headerlink" href="#module-catalyst.metrics.functional._ndcg" title="Permalink to this headline">¶</a></h3>
<dl class="function">
<dt id="catalyst.metrics.functional._ndcg.dcg">
<code class="sig-prename descclassname">catalyst.metrics.functional._ndcg.</code><code class="sig-name descname">dcg</code><span class="sig-paren">(</span><em class="sig-param">outputs: torch.Tensor</em>, <em class="sig-param">targets: torch.Tensor</em>, <em class="sig-param">gain_function='exp_rank'</em><span class="sig-paren">)</span> &#x2192; torch.Tensor<a class="reference internal" href="../_modules/catalyst/metrics/functional/_ndcg.html#dcg"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#catalyst.metrics.functional._ndcg.dcg" title="Permalink to this definition">¶</a></dt>
<dd><p>Computes Discounted cumulative gain (DCG)
<a class="reference external" href="mailto:DCG&#37;&#52;&#48;topk">DCG<span>&#64;</span>topk</a> for the specified values of <cite>k</cite>.
Graded relevance as a measure of  usefulness,
or gain, from examining a set of items.
Gain may be reduced at lower ranks.
Reference:
<a class="reference external" href="https://en.wikipedia.org/wiki/Discounted_cumulative_gain">https://en.wikipedia.org/wiki/Discounted_cumulative_gain</a></p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>outputs</strong> – model outputs, logits
with shape [batch_size; slate_length]</p></li>
<li><p><strong>targets</strong> – ground truth, labels
with shape [batch_size; slate_length]</p></li>
<li><p><strong>gain_function</strong> – String indicates the gain function for the ground truth labels.
Two options available:
- <cite>exp_rank</cite>: torch.pow(2, x) - 1
- <cite>linear_rank</cite>: x
On the default, <cite>exp_rank</cite> is used
to emphasize on retrieving the relevant documents.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>The discounted gains tensor</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>dcg_score (torch.Tensor)</p>
</dd>
<dt class="field-even">Raises</dt>
<dd class="field-even"><p><strong>ValueError</strong> – gain function can be either <cite>pow_rank</cite> or <cite>rank</cite></p>
</dd>
</dl>
<p>Examples:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">catalyst</span> <span class="kn">import</span> <span class="n">metrics</span>
<span class="n">metrics</span><span class="o">.</span><span class="n">dcg</span><span class="p">(</span>
    <span class="n">outputs</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([</span>
        <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
    <span class="p">]),</span>
    <span class="n">targets</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">([</span>
        <span class="p">[</span><span class="mf">2.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">],</span>
    <span class="p">]),</span>
    <span class="n">gain_function</span><span class="o">=</span><span class="s2">&quot;linear_rank&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="c1"># tensor([[2.0000, 2.0000, 0.6309, 0.0000]])</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">catalyst</span> <span class="kn">import</span> <span class="n">metrics</span>
<span class="n">metrics</span><span class="o">.</span><span class="n">dcg</span><span class="p">(</span>
    <span class="n">outputs</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([</span>
        <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
    <span class="p">]),</span>
    <span class="n">targets</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">([</span>
        <span class="p">[</span><span class="mf">2.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">],</span>
    <span class="p">]),</span>
    <span class="n">gain_function</span><span class="o">=</span><span class="s2">&quot;linear_rank&quot;</span><span class="p">,</span>
<span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<span class="c1"># tensor(4.6309)</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">catalyst</span> <span class="kn">import</span> <span class="n">metrics</span>
<span class="n">metrics</span><span class="o">.</span><span class="n">dcg</span><span class="p">(</span>
    <span class="n">outputs</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([</span>
        <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
    <span class="p">]),</span>
    <span class="n">targets</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">([</span>
        <span class="p">[</span><span class="mf">2.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">],</span>
    <span class="p">]),</span>
    <span class="n">gain_function</span><span class="o">=</span><span class="s2">&quot;exp_rank&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="c1"># tensor([[3.0000, 1.8928, 0.5000, 0.0000]])</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">catalyst</span> <span class="kn">import</span> <span class="n">metrics</span>
<span class="n">metrics</span><span class="o">.</span><span class="n">dcg</span><span class="p">(</span>
    <span class="n">outputs</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([</span>
        <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
    <span class="p">]),</span>
    <span class="n">targets</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">([</span>
        <span class="p">[</span><span class="mf">2.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">],</span>
    <span class="p">]),</span>
    <span class="n">gain_function</span><span class="o">=</span><span class="s2">&quot;exp_rank&quot;</span><span class="p">,</span>
<span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<span class="c1"># tensor(5.3928)</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="catalyst.metrics.functional._ndcg.ndcg">
<code class="sig-prename descclassname">catalyst.metrics.functional._ndcg.</code><code class="sig-name descname">ndcg</code><span class="sig-paren">(</span><em class="sig-param">outputs: torch.Tensor, targets: torch.Tensor, topk: List[int], gain_function='exp_rank'</em><span class="sig-paren">)</span> &#x2192; List[torch.Tensor]<a class="reference internal" href="../_modules/catalyst/metrics/functional/_ndcg.html#ndcg"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#catalyst.metrics.functional._ndcg.ndcg" title="Permalink to this definition">¶</a></dt>
<dd><p>Computes <a class="reference external" href="mailto:nDCG&#37;&#52;&#48;topk">nDCG<span>&#64;</span>topk</a> for the specified values of <cite>topk</cite>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>outputs</strong> (<em>torch.Tensor</em>) – model outputs, logits
with shape [batch_size; slate_size]</p></li>
<li><p><strong>targets</strong> (<em>torch.Tensor</em>) – ground truth, labels
with shape [batch_size; slate_size]</p></li>
<li><p><strong>gain_function</strong> – callable, gain function for the ground truth labels.
Two options available:
- <cite>exp_rank</cite>: torch.pow(2, x) - 1
- <cite>linear_rank</cite>: x
On the default, <cite>exp_rank</cite> is used
to emphasize on retrieving the relevant documents.</p></li>
<li><p><strong>topk</strong> (<em>List</em><em>[</em><em>int</em><em>]</em>) – Parameter fro evaluation on top-k items</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>tuple with computed <a class="reference external" href="mailto:ndcg&#37;&#52;&#48;topk">ndcg<span>&#64;</span>topk</a></p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>results (Tuple[float])</p>
</dd>
</dl>
<p>Examples:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">torch</span>
<span class="kn">from</span> <span class="nn">catalyst</span> <span class="kn">import</span> <span class="n">metrics</span>
<span class="n">metrics</span><span class="o">.</span><span class="n">ndcg</span><span class="p">(</span>
    <span class="n">outputs</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([</span>
        <span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">],</span>
        <span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">],</span>
    <span class="p">]),</span>
    <span class="n">targets</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">([</span>
        <span class="p">[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">],</span>
        <span class="p">[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">],</span>
    <span class="p">]),</span>
    <span class="n">topk</span><span class="o">=</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
    <span class="n">gain_function</span><span class="o">=</span><span class="s2">&quot;exp_rank&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="c1"># [tensor(0.6131)]</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">torch</span>
<span class="kn">from</span> <span class="nn">catalyst</span> <span class="kn">import</span> <span class="n">metrics</span>
<span class="n">metrics</span><span class="o">.</span><span class="n">ndcg</span><span class="p">(</span>
    <span class="n">outputs</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([</span>
        <span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">],</span>
        <span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">],</span>
    <span class="p">]),</span>
    <span class="n">targets</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">([</span>
        <span class="p">[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">],</span>
        <span class="p">[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">],</span>
    <span class="p">]),</span>
    <span class="n">topk</span><span class="o">=</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
    <span class="n">gain_function</span><span class="o">=</span><span class="s2">&quot;exp_rank&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="c1"># [tensor(0.5000)]</span>
</pre></div>
</div>
</dd></dl>

</section>
<section id="module-catalyst.metrics.functional._precision">
<span id="precision"></span><h3><a class="toc-backref" href="#id54">Precision</a><a class="headerlink" href="#module-catalyst.metrics.functional._precision" title="Permalink to this headline">¶</a></h3>
<dl class="function">
<dt id="catalyst.metrics.functional._precision.precision">
<code class="sig-prename descclassname">catalyst.metrics.functional._precision.</code><code class="sig-name descname">precision</code><span class="sig-paren">(</span><em class="sig-param">outputs: torch.Tensor</em>, <em class="sig-param">targets: torch.Tensor</em>, <em class="sig-param">argmax_dim: int = -1</em>, <em class="sig-param">eps: float = 1e-07</em>, <em class="sig-param">num_classes: Optional[int] = None</em><span class="sig-paren">)</span> &#x2192; Union[float, torch.Tensor]<a class="reference internal" href="../_modules/catalyst/metrics/functional/_precision.html#precision"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#catalyst.metrics.functional._precision.precision" title="Permalink to this definition">¶</a></dt>
<dd><p>Multiclass precision score.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>outputs</strong> – estimated targets as predicted by a model
with shape [bs; …, (num_classes or 1)]</p></li>
<li><p><strong>targets</strong> – ground truth (correct) target values
with shape [bs; …, 1]</p></li>
<li><p><strong>argmax_dim</strong> – int, that specifies dimension for argmax transformation
in case of scores/probabilities in <code class="docutils literal notranslate"><span class="pre">outputs</span></code></p></li>
<li><p><strong>eps</strong> – float. Epsilon to avoid zero division.</p></li>
<li><p><strong>num_classes</strong> – int, that specifies number of classes if it known</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>precision for every class</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>Tensor</p>
</dd>
</dl>
<p>Examples:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">torch</span>
<span class="kn">from</span> <span class="nn">catalyst</span> <span class="kn">import</span> <span class="n">metrics</span>
<span class="n">metrics</span><span class="o">.</span><span class="n">precision</span><span class="p">(</span>
    <span class="n">outputs</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([</span>
        <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
        <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
        <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
    <span class="p">]),</span>
    <span class="n">targets</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]),</span>
<span class="p">)</span>
<span class="c1"># tensor([1., 1., 1.])</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">torch</span>
<span class="kn">from</span> <span class="nn">catalyst</span> <span class="kn">import</span> <span class="n">metrics</span>
<span class="n">metrics</span><span class="o">.</span><span class="n">precision</span><span class="p">(</span>
    <span class="n">outputs</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]]),</span>
    <span class="n">targets</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]]),</span>
<span class="p">)</span>
<span class="c1"># tensor([0.5000, 0.5000]</span>
</pre></div>
</div>
</dd></dl>

</section>
<section id="id13">
<h3><a class="toc-backref" href="#id55">R2Squared</a><a class="headerlink" href="#id13" title="Permalink to this headline">¶</a></h3>
<span class="target" id="module-catalyst.metrics.functional._r2_squared"></span><dl class="function">
<dt id="catalyst.metrics.functional._r2_squared.r2_squared">
<code class="sig-prename descclassname">catalyst.metrics.functional._r2_squared.</code><code class="sig-name descname">r2_squared</code><span class="sig-paren">(</span><em class="sig-param">outputs: torch.Tensor</em>, <em class="sig-param">targets: torch.Tensor</em><span class="sig-paren">)</span> &#x2192; Sequence[torch.Tensor]<a class="reference internal" href="../_modules/catalyst/metrics/functional/_r2_squared.html#r2_squared"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#catalyst.metrics.functional._r2_squared.r2_squared" title="Permalink to this definition">¶</a></dt>
<dd><p>Computes regression r2 squared.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>outputs</strong> – model outputs
with shape [bs; 1]</p></li>
<li><p><strong>targets</strong> – ground truth
with shape [bs; 1]</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>float of computed r2 squared</p>
</dd>
</dl>
<p>Examples:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">torch</span>
<span class="kn">from</span> <span class="nn">catalyst</span> <span class="kn">import</span> <span class="n">metrics</span>
<span class="n">metrics</span><span class="o">.</span><span class="n">r2_squared</span><span class="p">(</span>
    <span class="n">outputs</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]),</span>
    <span class="n">targets</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]),</span>
<span class="p">)</span>
<span class="c1"># tensor([1.])</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">torch</span>
<span class="kn">from</span> <span class="nn">catalyst</span> <span class="kn">import</span> <span class="n">metrics</span>
<span class="n">metrics</span><span class="o">.</span><span class="n">r2_squared</span><span class="p">(</span>
    <span class="n">outputs</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([</span><span class="mf">2.5</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">8</span><span class="p">]),</span>
    <span class="n">targets</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([</span><span class="mi">3</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">7</span><span class="p">]),</span>
<span class="p">)</span>
<span class="c1"># tensor([0.9486])</span>
</pre></div>
</div>
</dd></dl>

</section>
<section id="module-catalyst.metrics.functional._recall">
<span id="recall"></span><h3><a class="toc-backref" href="#id56">Recall</a><a class="headerlink" href="#module-catalyst.metrics.functional._recall" title="Permalink to this headline">¶</a></h3>
<dl class="function">
<dt id="catalyst.metrics.functional._recall.recall">
<code class="sig-prename descclassname">catalyst.metrics.functional._recall.</code><code class="sig-name descname">recall</code><span class="sig-paren">(</span><em class="sig-param">outputs: torch.Tensor</em>, <em class="sig-param">targets: torch.Tensor</em>, <em class="sig-param">argmax_dim: int = -1</em>, <em class="sig-param">eps: float = 1e-07</em>, <em class="sig-param">num_classes: Optional[int] = None</em><span class="sig-paren">)</span> &#x2192; Union[float, torch.Tensor]<a class="reference internal" href="../_modules/catalyst/metrics/functional/_recall.html#recall"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#catalyst.metrics.functional._recall.recall" title="Permalink to this definition">¶</a></dt>
<dd><p>Multiclass recall score.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>outputs</strong> – estimated targets as predicted by a model
with shape [bs; …, (num_classes or 1)]</p></li>
<li><p><strong>targets</strong> – ground truth (correct) target values
with shape [bs; …, 1]</p></li>
<li><p><strong>argmax_dim</strong> – int, that specifies dimension for argmax transformation
in case of scores/probabilities in <code class="docutils literal notranslate"><span class="pre">outputs</span></code></p></li>
<li><p><strong>eps</strong> – float. Epsilon to avoid zero division.</p></li>
<li><p><strong>num_classes</strong> – int, that specifies number of classes if it known</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>recall for every class</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>Tensor</p>
</dd>
</dl>
<p>Examples:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">torch</span>
<span class="kn">from</span> <span class="nn">catalyst</span> <span class="kn">import</span> <span class="n">metrics</span>
<span class="n">metrics</span><span class="o">.</span><span class="n">recall</span><span class="p">(</span>
    <span class="n">outputs</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([</span>
        <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
        <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
        <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
    <span class="p">]),</span>
    <span class="n">targets</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]),</span>
<span class="p">)</span>
<span class="c1"># tensor([1., 1., 1.])</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">torch</span>
<span class="kn">from</span> <span class="nn">catalyst</span> <span class="kn">import</span> <span class="n">metrics</span>
<span class="n">metrics</span><span class="o">.</span><span class="n">recall</span><span class="p">(</span>
    <span class="n">outputs</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]]),</span>
    <span class="n">targets</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]]),</span>
<span class="p">)</span>
<span class="c1"># tensor([0.5000, 0.5000]</span>
</pre></div>
</div>
</dd></dl>

</section>
<section id="module-catalyst.metrics.functional._segmentation">
<span id="segmentation"></span><h3><a class="toc-backref" href="#id57">Segmentation</a><a class="headerlink" href="#module-catalyst.metrics.functional._segmentation" title="Permalink to this headline">¶</a></h3>
<dl class="function">
<dt id="catalyst.metrics.functional._segmentation.iou">
<code class="sig-prename descclassname">catalyst.metrics.functional._segmentation.</code><code class="sig-name descname">iou</code><span class="sig-paren">(</span><em class="sig-param">outputs: torch.Tensor</em>, <em class="sig-param">targets: torch.Tensor</em>, <em class="sig-param">class_dim: int = 1</em>, <em class="sig-param">threshold: float = None</em>, <em class="sig-param">mode: str = 'per-class'</em>, <em class="sig-param">weights: Optional[List[float]] = None</em>, <em class="sig-param">eps: float = 1e-07</em><span class="sig-paren">)</span> &#x2192; torch.Tensor<a class="reference internal" href="../_modules/catalyst/metrics/functional/_segmentation.html#iou"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#catalyst.metrics.functional._segmentation.iou" title="Permalink to this definition">¶</a></dt>
<dd><p>Computes the iou/jaccard score, iou score = intersection / union = tp / (tp + fp + fn)</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>outputs</strong> – [N; K; …] tensor that for each of the N examples
indicates the probability of the example belonging to each of
the K classes, according to the model.</p></li>
<li><p><strong>targets</strong> – binary [N; K; …] tensor that encodes which of the K
classes are associated with the N-th input</p></li>
<li><p><strong>class_dim</strong> – indicates class dimention (K) for
<code class="docutils literal notranslate"><span class="pre">outputs</span></code> and <code class="docutils literal notranslate"><span class="pre">targets</span></code> tensors (default = 1), if
mode = “micro” means nothing</p></li>
<li><p><strong>threshold</strong> – threshold for outputs binarization</p></li>
<li><p><strong>mode</strong> – class summation strategy. Must be one of [‘micro’, ‘macro’,
‘weighted’, ‘per-class’]. If mode=’micro’, classes are ignored,
and metric are calculated generally. If mode=’macro’, metric are
calculated per-class and than are averaged over all classes. If
mode=’weighted’, metric are calculated per-class and than summed
over all classes with weights. If mode=’per-class’, metric are
calculated separately for all classes</p></li>
<li><p><strong>weights</strong> – class weights(for mode=”weighted”)</p></li>
<li><p><strong>eps</strong> – epsilon to avoid zero division</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>IoU (Jaccard) score for each class(if mode=’weighted’) or aggregated IOU</p>
</dd>
</dl>
<p>Example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">torch</span>
<span class="kn">from</span> <span class="nn">catalyst</span> <span class="kn">import</span> <span class="n">metrics</span>

<span class="n">size</span> <span class="o">=</span> <span class="mi">4</span>
<span class="n">half_size</span> <span class="o">=</span> <span class="n">size</span> <span class="o">//</span> <span class="mi">2</span>
<span class="n">shape</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span> <span class="n">size</span><span class="p">)</span>
<span class="n">empty</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">shape</span><span class="p">)</span>
<span class="n">full</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">shape</span><span class="p">)</span>
<span class="n">left</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">shape</span><span class="p">)</span>
<span class="n">left</span><span class="p">[:,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="n">half_size</span><span class="p">:]</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">right</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">shape</span><span class="p">)</span>
<span class="n">right</span><span class="p">[:,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="p">:</span><span class="n">half_size</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">top_left</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">shape</span><span class="p">)</span>
<span class="n">top_left</span><span class="p">[:,</span> <span class="p">:,</span> <span class="p">:</span><span class="n">half_size</span><span class="p">,</span> <span class="p">:</span><span class="n">half_size</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">pred</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">cat</span><span class="p">([</span><span class="n">empty</span><span class="p">,</span> <span class="n">left</span><span class="p">,</span> <span class="n">empty</span><span class="p">,</span> <span class="n">full</span><span class="p">,</span> <span class="n">left</span><span class="p">,</span> <span class="n">top_left</span><span class="p">],</span> <span class="n">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">targets</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">cat</span><span class="p">([</span><span class="n">full</span><span class="p">,</span> <span class="n">right</span><span class="p">,</span> <span class="n">empty</span><span class="p">,</span> <span class="n">full</span><span class="p">,</span> <span class="n">left</span><span class="p">,</span> <span class="n">left</span><span class="p">],</span> <span class="n">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="n">metrics</span><span class="o">.</span><span class="n">iou</span><span class="p">(</span>
    <span class="n">outputs</span><span class="o">=</span><span class="n">pred</span><span class="p">,</span>
    <span class="n">targets</span><span class="o">=</span><span class="n">targets</span><span class="p">,</span>
    <span class="n">class_dim</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">threshold</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
    <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;per-class&quot;</span>
<span class="p">)</span>
<span class="c1"># tensor([0.0000, 0.0000, 1.0000, 1.0000, 1.0000, 0.5])</span>

<span class="n">metrics</span><span class="o">.</span><span class="n">iou</span><span class="p">(</span>
    <span class="n">outputs</span><span class="o">=</span><span class="n">pred</span><span class="p">,</span>
    <span class="n">targets</span><span class="o">=</span><span class="n">targets</span><span class="p">,</span>
    <span class="n">class_dim</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">threshold</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
    <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;macro&quot;</span>
<span class="p">)</span>
<span class="c1"># tensor(0.5833)</span>

<span class="n">metrics</span><span class="o">.</span><span class="n">iou</span><span class="p">(</span>
    <span class="n">outputs</span><span class="o">=</span><span class="n">pred</span><span class="p">,</span>
    <span class="n">targets</span><span class="o">=</span><span class="n">targets</span><span class="p">,</span>
    <span class="n">class_dim</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">threshold</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
    <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;micro&quot;</span>
<span class="p">)</span>
<span class="c1"># tensor(0.4375)</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="catalyst.metrics.functional._segmentation.dice">
<code class="sig-prename descclassname">catalyst.metrics.functional._segmentation.</code><code class="sig-name descname">dice</code><span class="sig-paren">(</span><em class="sig-param">outputs: torch.Tensor</em>, <em class="sig-param">targets: torch.Tensor</em>, <em class="sig-param">class_dim: int = 1</em>, <em class="sig-param">threshold: float = None</em>, <em class="sig-param">mode: str = 'per-class'</em>, <em class="sig-param">weights: Optional[List[float]] = None</em>, <em class="sig-param">eps: float = 1e-07</em><span class="sig-paren">)</span> &#x2192; torch.Tensor<a class="reference internal" href="../_modules/catalyst/metrics/functional/_segmentation.html#dice"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#catalyst.metrics.functional._segmentation.dice" title="Permalink to this definition">¶</a></dt>
<dd><p>Computes the dice score,
dice score = 2 * intersection / (intersection + union)) =     = 2 * tp / (2 * tp + fp + fn)</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>outputs</strong> – [N; K; …] tensor that for each of the N examples
indicates the probability of the example belonging to each of
the K classes, according to the model.</p></li>
<li><p><strong>targets</strong> – binary [N; K; …] tensor that encodes which of the K
classes are associated with the N-th input</p></li>
<li><p><strong>class_dim</strong> – indicates class dimention (K) for
<code class="docutils literal notranslate"><span class="pre">outputs</span></code> and <code class="docutils literal notranslate"><span class="pre">targets</span></code> tensors (default = 1), if
mode = “micro” means nothing</p></li>
<li><p><strong>threshold</strong> – threshold for outputs binarization</p></li>
<li><p><strong>mode</strong> – class summation strategy. Must be one of [‘micro’, ‘macro’,
‘weighted’, ‘per-class’]. If mode=’micro’, classes are ignored,
and metric are calculated generally. If mode=’macro’, metric are
calculated per-class and than are averaged over all classes. If
mode=’weighted’, metric are calculated per-class and than summed
over all classes with weights. If mode=’per-class’, metric are
calculated separately for all classes</p></li>
<li><p><strong>weights</strong> – class weights(for mode=”weighted”)</p></li>
<li><p><strong>eps</strong> – epsilon to avoid zero division</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>Dice score for each class(if mode=’weighted’) or aggregated Dice</p>
</dd>
</dl>
<p>Example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">torch</span>
<span class="kn">from</span> <span class="nn">catalyst</span> <span class="kn">import</span> <span class="n">metrics</span>

<span class="n">size</span> <span class="o">=</span> <span class="mi">4</span>
<span class="n">half_size</span> <span class="o">=</span> <span class="n">size</span> <span class="o">//</span> <span class="mi">2</span>
<span class="n">shape</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span> <span class="n">size</span><span class="p">)</span>
<span class="n">empty</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">shape</span><span class="p">)</span>
<span class="n">full</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">shape</span><span class="p">)</span>
<span class="n">left</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">shape</span><span class="p">)</span>
<span class="n">left</span><span class="p">[:,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="n">half_size</span><span class="p">:]</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">right</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">shape</span><span class="p">)</span>
<span class="n">right</span><span class="p">[:,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="p">:</span><span class="n">half_size</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">top_left</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">shape</span><span class="p">)</span>
<span class="n">top_left</span><span class="p">[:,</span> <span class="p">:,</span> <span class="p">:</span><span class="n">half_size</span><span class="p">,</span> <span class="p">:</span><span class="n">half_size</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">pred</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">cat</span><span class="p">([</span><span class="n">empty</span><span class="p">,</span> <span class="n">left</span><span class="p">,</span> <span class="n">empty</span><span class="p">,</span> <span class="n">full</span><span class="p">,</span> <span class="n">left</span><span class="p">,</span> <span class="n">top_left</span><span class="p">],</span> <span class="n">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">targets</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">cat</span><span class="p">([</span><span class="n">full</span><span class="p">,</span> <span class="n">right</span><span class="p">,</span> <span class="n">empty</span><span class="p">,</span> <span class="n">full</span><span class="p">,</span> <span class="n">left</span><span class="p">,</span> <span class="n">left</span><span class="p">],</span> <span class="n">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="n">metrics</span><span class="o">.</span><span class="n">dice</span><span class="p">(</span>
    <span class="n">outputs</span><span class="o">=</span><span class="n">pred</span><span class="p">,</span>
    <span class="n">targets</span><span class="o">=</span><span class="n">targets</span><span class="p">,</span>
    <span class="n">class_dim</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">threshold</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
    <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;per-class&quot;</span>
<span class="p">)</span>
<span class="c1"># tensor([0.0000, 0.0000, 1.0000, 1.0000, 1.0000, 0.6667])</span>

<span class="n">metrics</span><span class="o">.</span><span class="n">dice</span><span class="p">(</span>
    <span class="n">outputs</span><span class="o">=</span><span class="n">pred</span><span class="p">,</span>
    <span class="n">targets</span><span class="o">=</span><span class="n">targets</span><span class="p">,</span>
    <span class="n">class_dim</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">threshold</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
    <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;macro&quot;</span>
<span class="p">)</span>
<span class="c1"># tensor(0.6111)</span>

<span class="n">metrics</span><span class="o">.</span><span class="n">dice</span><span class="p">(</span>
    <span class="n">outputs</span><span class="o">=</span><span class="n">pred</span><span class="p">,</span>
    <span class="n">targets</span><span class="o">=</span><span class="n">targets</span><span class="p">,</span>
    <span class="n">class_dim</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">threshold</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
    <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;micro&quot;</span>
<span class="p">)</span>
<span class="c1"># tensor(0.6087)</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="catalyst.metrics.functional._segmentation.trevsky">
<code class="sig-prename descclassname">catalyst.metrics.functional._segmentation.</code><code class="sig-name descname">trevsky</code><span class="sig-paren">(</span><em class="sig-param">outputs: torch.Tensor</em>, <em class="sig-param">targets: torch.Tensor</em>, <em class="sig-param">alpha: float</em>, <em class="sig-param">beta: Optional[float] = None</em>, <em class="sig-param">class_dim: int = 1</em>, <em class="sig-param">threshold: float = None</em>, <em class="sig-param">mode: str = 'per-class'</em>, <em class="sig-param">weights: Optional[List[float]] = None</em>, <em class="sig-param">eps: float = 1e-07</em><span class="sig-paren">)</span> &#x2192; torch.Tensor<a class="reference internal" href="../_modules/catalyst/metrics/functional/_segmentation.html#trevsky"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#catalyst.metrics.functional._segmentation.trevsky" title="Permalink to this definition">¶</a></dt>
<dd><p>Computes the trevsky score,
trevsky score = tp / (tp + fp * beta + fn * alpha)</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>outputs</strong> – [N; K; …] tensor that for each of the N examples
indicates the probability of the example belonging to each of
the K classes, according to the model.</p></li>
<li><p><strong>targets</strong> – binary [N; K; …] tensor that encodes which of the K
classes are associated with the N-th input</p></li>
<li><p><strong>alpha</strong> – false negative coefficient, bigger alpha bigger penalty for
false negative. Must be in (0, 1)</p></li>
<li><p><strong>beta</strong> – false positive coefficient, bigger alpha bigger penalty for false
positive. Must be in (0, 1), if None beta = (1 - alpha)</p></li>
<li><p><strong>class_dim</strong> – indicates class dimention (K) for
<code class="docutils literal notranslate"><span class="pre">outputs</span></code> and <code class="docutils literal notranslate"><span class="pre">targets</span></code> tensors (default = 1)</p></li>
<li><p><strong>threshold</strong> – threshold for outputs binarization</p></li>
<li><p><strong>mode</strong> – class summation strategy. Must be one of [‘micro’, ‘macro’,
‘weighted’, ‘per-class’]. If mode=’micro’, classes are ignored,
and metric are calculated generally. If mode=’macro’, metric are
calculated per-class and than are averaged over all classes. If
mode=’weighted’, metric are calculated per-class and than summed
over all classes with weights. If mode=’per-class’, metric are
calculated separately for all classes</p></li>
<li><p><strong>weights</strong> – class weights(for mode=”weighted”)</p></li>
<li><p><strong>eps</strong> – epsilon to avoid zero division</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>Trevsky score for each class(if mode=’weighted’) or aggregated score</p>
</dd>
</dl>
<p>Example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">torch</span>
<span class="kn">from</span> <span class="nn">catalyst</span> <span class="kn">import</span> <span class="n">metrics</span>

<span class="n">size</span> <span class="o">=</span> <span class="mi">4</span>
<span class="n">half_size</span> <span class="o">=</span> <span class="n">size</span> <span class="o">//</span> <span class="mi">2</span>
<span class="n">shape</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span> <span class="n">size</span><span class="p">)</span>
<span class="n">empty</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">shape</span><span class="p">)</span>
<span class="n">full</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">shape</span><span class="p">)</span>
<span class="n">left</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">shape</span><span class="p">)</span>
<span class="n">left</span><span class="p">[:,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="n">half_size</span><span class="p">:]</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">right</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">shape</span><span class="p">)</span>
<span class="n">right</span><span class="p">[:,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="p">:</span><span class="n">half_size</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">top_left</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">shape</span><span class="p">)</span>
<span class="n">top_left</span><span class="p">[:,</span> <span class="p">:,</span> <span class="p">:</span><span class="n">half_size</span><span class="p">,</span> <span class="p">:</span><span class="n">half_size</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">pred</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">cat</span><span class="p">([</span><span class="n">empty</span><span class="p">,</span> <span class="n">left</span><span class="p">,</span> <span class="n">empty</span><span class="p">,</span> <span class="n">full</span><span class="p">,</span> <span class="n">left</span><span class="p">,</span> <span class="n">top_left</span><span class="p">],</span> <span class="n">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">targets</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">cat</span><span class="p">([</span><span class="n">full</span><span class="p">,</span> <span class="n">right</span><span class="p">,</span> <span class="n">empty</span><span class="p">,</span> <span class="n">full</span><span class="p">,</span> <span class="n">left</span><span class="p">,</span> <span class="n">left</span><span class="p">],</span> <span class="n">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="n">metrics</span><span class="o">.</span><span class="n">trevsky</span><span class="p">(</span>
    <span class="n">outputs</span><span class="o">=</span><span class="n">pred</span><span class="p">,</span>
    <span class="n">targets</span><span class="o">=</span><span class="n">targets</span><span class="p">,</span>
    <span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span>
    <span class="n">class_dim</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">threshold</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
    <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;per-class&quot;</span>
<span class="p">)</span>
<span class="c1"># tensor([0.0000, 0.0000, 1.0000, 1.0000, 1.0000, 0.8333])</span>

<span class="n">metrics</span><span class="o">.</span><span class="n">trevsky</span><span class="p">(</span>
    <span class="n">outputs</span><span class="o">=</span><span class="n">pred</span><span class="p">,</span>
    <span class="n">targets</span><span class="o">=</span><span class="n">targets</span><span class="p">,</span>
    <span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span>
    <span class="n">class_dim</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">threshold</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
    <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;macro&quot;</span>
<span class="p">)</span>
<span class="c1"># tensor(0.6389)</span>

<span class="n">metrics</span><span class="o">.</span><span class="n">trevsky</span><span class="p">(</span>
    <span class="n">outputs</span><span class="o">=</span><span class="n">pred</span><span class="p">,</span>
    <span class="n">targets</span><span class="o">=</span><span class="n">targets</span><span class="p">,</span>
    <span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span>
    <span class="n">class_dim</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">threshold</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
    <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;micro&quot;</span>
<span class="p">)</span>
<span class="c1"># tensor(0.7000)</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="catalyst.metrics.functional._segmentation.get_segmentation_statistics">
<code class="sig-prename descclassname">catalyst.metrics.functional._segmentation.</code><code class="sig-name descname">get_segmentation_statistics</code><span class="sig-paren">(</span><em class="sig-param">outputs: torch.Tensor</em>, <em class="sig-param">targets: torch.Tensor</em>, <em class="sig-param">class_dim: int = 1</em>, <em class="sig-param">threshold: float = None</em><span class="sig-paren">)</span> &#x2192; Tuple[torch.Tensor, torch.Tensor, torch.Tensor]<a class="reference internal" href="../_modules/catalyst/metrics/functional/_segmentation.html#get_segmentation_statistics"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#catalyst.metrics.functional._segmentation.get_segmentation_statistics" title="Permalink to this definition">¶</a></dt>
<dd><p>Computes true positive, false positive, false negative
for a multilabel segmentation problem.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>outputs</strong> – [N; K; …] tensor that for each of the N examples
indicates the probability of the example belonging to each of
the K classes, according to the model.</p></li>
<li><p><strong>targets</strong> – binary [N; K; …] tensor that encodes which of the K
classes are associated with the N-th input</p></li>
<li><p><strong>class_dim</strong> – indicates class dimention (K) for
<code class="docutils literal notranslate"><span class="pre">outputs</span></code> and <code class="docutils literal notranslate"><span class="pre">targets</span></code> tensors (default = 1)</p></li>
<li><p><strong>threshold</strong> – threshold for outputs binarization</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>Segmentation stats</p>
</dd>
</dl>
<p>Example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">torch</span>
<span class="kn">from</span> <span class="nn">catalyst</span> <span class="kn">import</span> <span class="n">metrics</span>

<span class="n">size</span> <span class="o">=</span> <span class="mi">4</span>
<span class="n">half_size</span> <span class="o">=</span> <span class="n">size</span> <span class="o">//</span> <span class="mi">2</span>
<span class="n">shape</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span> <span class="n">size</span><span class="p">)</span>
<span class="n">empty</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">shape</span><span class="p">)</span>
<span class="n">full</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">shape</span><span class="p">)</span>
<span class="n">left</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">shape</span><span class="p">)</span>
<span class="n">left</span><span class="p">[:,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="n">half_size</span><span class="p">:]</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">right</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">shape</span><span class="p">)</span>
<span class="n">right</span><span class="p">[:,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="p">:</span><span class="n">half_size</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">top_left</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">shape</span><span class="p">)</span>
<span class="n">top_left</span><span class="p">[:,</span> <span class="p">:,</span> <span class="p">:</span><span class="n">half_size</span><span class="p">,</span> <span class="p">:</span><span class="n">half_size</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">pred</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">cat</span><span class="p">([</span><span class="n">empty</span><span class="p">,</span> <span class="n">left</span><span class="p">,</span> <span class="n">empty</span><span class="p">,</span> <span class="n">full</span><span class="p">,</span> <span class="n">left</span><span class="p">,</span> <span class="n">top_left</span><span class="p">],</span> <span class="n">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">targets</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">cat</span><span class="p">([</span><span class="n">full</span><span class="p">,</span> <span class="n">right</span><span class="p">,</span> <span class="n">empty</span><span class="p">,</span> <span class="n">full</span><span class="p">,</span> <span class="n">left</span><span class="p">,</span> <span class="n">left</span><span class="p">],</span> <span class="n">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="n">metrics</span><span class="o">.</span><span class="n">get_segmentation_statistics</span><span class="p">(</span>
    <span class="n">outputs</span><span class="o">=</span><span class="n">pred</span><span class="p">,</span>
    <span class="n">targets</span><span class="o">=</span><span class="n">targets</span><span class="p">,</span>
    <span class="n">class_dim</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">threshold</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
<span class="p">)</span>
<span class="c1"># (</span>
<span class="c1">#     tensor([ 0.,  0.,  0., 16.,  8.,  4.]),  # per class TP</span>
<span class="c1">#     tensor([0., 8., 0., 0., 0., 0.]),        # per class FP</span>
<span class="c1">#     tensor([16.,  8.,  0.,  0.,  0.,  4.]),  # per class TN</span>
<span class="c1"># )</span>
</pre></div>
</div>
</dd></dl>

</section>
<section id="module-catalyst.metrics.functional._misc">
<span id="misc"></span><h3><a class="toc-backref" href="#id58">Misc</a><a class="headerlink" href="#module-catalyst.metrics.functional._misc" title="Permalink to this headline">¶</a></h3>
<dl class="function">
<dt id="catalyst.metrics.functional._misc.check_consistent_length">
<code class="sig-prename descclassname">catalyst.metrics.functional._misc.</code><code class="sig-name descname">check_consistent_length</code><span class="sig-paren">(</span><em class="sig-param">*tensors</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/catalyst/metrics/functional/_misc.html#check_consistent_length"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#catalyst.metrics.functional._misc.check_consistent_length" title="Permalink to this definition">¶</a></dt>
<dd><p>Check that all arrays have consistent first dimensions.
Checks whether all objects in arrays have the same shape or length.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>tensors</strong> – list or tensors of input objects.
Objects that will be checked for consistent length.</p>
</dd>
<dt class="field-even">Raises</dt>
<dd class="field-even"><p><strong>ValueError</strong> – “Inconsistent numbers of samples”</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="catalyst.metrics.functional._misc.process_multilabel_components">
<code class="sig-prename descclassname">catalyst.metrics.functional._misc.</code><code class="sig-name descname">process_multilabel_components</code><span class="sig-paren">(</span><em class="sig-param">outputs: torch.Tensor</em>, <em class="sig-param">targets: torch.Tensor</em>, <em class="sig-param">weights: Optional[torch.Tensor] = None</em><span class="sig-paren">)</span> &#x2192; Tuple[torch.Tensor, torch.Tensor, torch.Tensor, int]<a class="reference internal" href="../_modules/catalyst/metrics/functional/_misc.html#process_multilabel_components"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#catalyst.metrics.functional._misc.process_multilabel_components" title="Permalink to this definition">¶</a></dt>
<dd><p>General preprocessing for multilabel-based metrics.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>outputs</strong> – NxK tensor that for each of the N examples
indicates the probability of the example belonging to each of
the K classes, according to the model.</p></li>
<li><p><strong>targets</strong> – binary NxK tensor that encodes which of the K
classes are associated with the N-th input
(eg: a row [0, 1, 0, 1] indicates that the example is
associated with classes 2 and 4)</p></li>
<li><p><strong>weights</strong> – importance for each sample</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>processed <code class="docutils literal notranslate"><span class="pre">outputs</span></code> and <code class="docutils literal notranslate"><span class="pre">targets</span></code>
with [batch_size; num_classes] shape</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="catalyst.metrics.functional._misc.process_recsys_components">
<code class="sig-prename descclassname">catalyst.metrics.functional._misc.</code><code class="sig-name descname">process_recsys_components</code><span class="sig-paren">(</span><em class="sig-param">outputs: torch.Tensor</em>, <em class="sig-param">targets: torch.Tensor</em><span class="sig-paren">)</span> &#x2192; torch.Tensor<a class="reference internal" href="../_modules/catalyst/metrics/functional/_misc.html#process_recsys_components"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#catalyst.metrics.functional._misc.process_recsys_components" title="Permalink to this definition">¶</a></dt>
<dd><p>General pre-processing for calculation recsys metrics</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>outputs</strong> (<em>torch.Tensor</em>) – Tensor with predicted scores
size: [batch_size, slate_length]
model outputs, logits</p></li>
<li><p><strong>targets</strong> (<em>torch.Tensor</em>) – Binary tensor with ground truth.
1 means the item is relevant
for the user and 0 not relevant
size: [batch_szie, slate_length]
ground truth, labels</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>targets tensor sorted by outputs</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>targets_sorted_by_outputs (torch.Tensor)</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="catalyst.metrics.functional._misc.get_binary_statistics">
<code class="sig-prename descclassname">catalyst.metrics.functional._misc.</code><code class="sig-name descname">get_binary_statistics</code><span class="sig-paren">(</span><em class="sig-param">outputs: torch.Tensor</em>, <em class="sig-param">targets: torch.Tensor</em>, <em class="sig-param">label: int = 1</em><span class="sig-paren">)</span> &#x2192; Tuple[torch.Tensor, torch.Tensor, torch.Tensor, torch.Tensor, torch.Tensor]<a class="reference internal" href="../_modules/catalyst/metrics/functional/_misc.html#get_binary_statistics"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#catalyst.metrics.functional._misc.get_binary_statistics" title="Permalink to this definition">¶</a></dt>
<dd><p>Computes the number of true negative, false positive,
false negative, true positive and support
for a binary classification problem for a given label.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>outputs</strong> – estimated targets as predicted by a model
with shape [bs; …, 1]</p></li>
<li><p><strong>targets</strong> – ground truth (correct) target values
with shape [bs; …, 1]</p></li>
<li><p><strong>label</strong> – integer, that specifies label of interest for statistics compute</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>stats</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>Tuple[Tensor, Tensor, Tensor, Tensor, Tensor]</p>
</dd>
</dl>
<p>Example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">torch</span>
<span class="kn">from</span> <span class="nn">catalyst</span> <span class="kn">import</span> <span class="n">metrics</span>
<span class="n">y_pred</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]])</span>
<span class="n">y_true</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]])</span>
<span class="n">tn</span><span class="p">,</span> <span class="n">fp</span><span class="p">,</span> <span class="n">fn</span><span class="p">,</span> <span class="n">tp</span><span class="p">,</span> <span class="n">support</span> <span class="o">=</span> <span class="n">metrics</span><span class="o">.</span><span class="n">get_binary_statistics</span><span class="p">(</span><span class="n">y_pred</span><span class="p">,</span> <span class="n">y_true</span><span class="p">)</span>
<span class="c1"># tensor(2) tensor(2) tensor(2) tensor(2) tensor(4)</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="catalyst.metrics.functional._misc.get_multiclass_statistics">
<code class="sig-prename descclassname">catalyst.metrics.functional._misc.</code><code class="sig-name descname">get_multiclass_statistics</code><span class="sig-paren">(</span><em class="sig-param">outputs: torch.Tensor</em>, <em class="sig-param">targets: torch.Tensor</em>, <em class="sig-param">argmax_dim: int = -1</em>, <em class="sig-param">num_classes: Optional[int] = None</em><span class="sig-paren">)</span> &#x2192; Tuple[torch.Tensor, torch.Tensor, torch.Tensor, torch.Tensor, torch.Tensor, int]<a class="reference internal" href="../_modules/catalyst/metrics/functional/_misc.html#get_multiclass_statistics"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#catalyst.metrics.functional._misc.get_multiclass_statistics" title="Permalink to this definition">¶</a></dt>
<dd><p>Computes the number of true negative, false positive,
false negative, true positive and support
for a multiclass classification problem.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>outputs</strong> – estimated targets as predicted by a model
with shape [bs; …, (num_classes or 1)]</p></li>
<li><p><strong>targets</strong> – ground truth (correct) target values
with shape [bs; …, 1]</p></li>
<li><p><strong>argmax_dim</strong> – int, that specifies dimension for argmax transformation
in case of scores/probabilities in <code class="docutils literal notranslate"><span class="pre">outputs</span></code></p></li>
<li><p><strong>num_classes</strong> – int, that specifies number of classes if it known</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>stats</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>Tuple[Tensor, Tensor, Tensor, Tensor, Tensor]</p>
</dd>
</dl>
<p>Example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">torch</span>
<span class="kn">from</span> <span class="nn">catalyst</span> <span class="kn">import</span> <span class="n">metrics</span>
<span class="n">y_pred</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
<span class="n">y_true</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
<span class="n">tn</span><span class="p">,</span> <span class="n">fp</span><span class="p">,</span> <span class="n">fn</span><span class="p">,</span> <span class="n">tp</span><span class="p">,</span> <span class="n">support</span> <span class="o">=</span> <span class="n">metrics</span><span class="o">.</span><span class="n">get_multiclass_statistics</span><span class="p">(</span><span class="n">y_pred</span><span class="p">,</span> <span class="n">y_true</span><span class="p">)</span>
<span class="c1"># (</span>
<span class="c1">#     tensor([3., 3., 3., 2., 3.]),</span>
<span class="c1">#     tensor([0., 0., 1., 1., 0.]),</span>
<span class="c1">#     tensor([0., 0., 0., 1., 1.]),</span>
<span class="c1">#     tensor([1., 1., 0., 0., 0.]),</span>
<span class="c1">#     tensor([1., 1., 0., 1., 1.])</span>
<span class="c1"># )</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="catalyst.metrics.functional._misc.get_multilabel_statistics">
<code class="sig-prename descclassname">catalyst.metrics.functional._misc.</code><code class="sig-name descname">get_multilabel_statistics</code><span class="sig-paren">(</span><em class="sig-param">outputs: torch.Tensor</em>, <em class="sig-param">targets: torch.Tensor</em><span class="sig-paren">)</span> &#x2192; Tuple[torch.Tensor, torch.Tensor, torch.Tensor, torch.Tensor, torch.Tensor, int]<a class="reference internal" href="../_modules/catalyst/metrics/functional/_misc.html#get_multilabel_statistics"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#catalyst.metrics.functional._misc.get_multilabel_statistics" title="Permalink to this definition">¶</a></dt>
<dd><p>Computes the number of true negative, false positive,
false negative, true positive and support
for a multilabel classification problem.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>outputs</strong> – estimated targets as predicted by a model
with shape [bs; …, (num_classes or 1)]</p></li>
<li><p><strong>targets</strong> – ground truth (correct) target values
with shape [bs; …, 1]</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>stats</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>Tuple[Tensor, Tensor, Tensor, Tensor, Tensor]</p>
</dd>
</dl>
<p>Examples:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">torch</span>
<span class="kn">from</span> <span class="nn">catalyst</span> <span class="kn">import</span> <span class="n">metrics</span>
<span class="n">y_pred</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]])</span>
<span class="n">y_true</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]])</span>
<span class="n">tn</span><span class="p">,</span> <span class="n">fp</span><span class="p">,</span> <span class="n">fn</span><span class="p">,</span> <span class="n">tp</span><span class="p">,</span> <span class="n">support</span> <span class="o">=</span> <span class="n">metrics</span><span class="o">.</span><span class="n">get_multilabel_statistics</span><span class="p">(</span><span class="n">y_pred</span><span class="p">,</span> <span class="n">y_true</span><span class="p">)</span>
<span class="c1"># (</span>
<span class="c1">#     tensor([2., 0., 0., 0.]),</span>
<span class="c1">#     tensor([0., 1., 1., 0.]),</span>
<span class="c1">#     tensor([0., 1., 1., 0.]),</span>
<span class="c1">#     tensor([0., 0., 0., 2.]),</span>
<span class="c1">#     tensor([0., 1., 1., 2.]),</span>
<span class="c1"># )</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">torch</span>
<span class="kn">from</span> <span class="nn">catalyst</span> <span class="kn">import</span> <span class="n">metrics</span>
<span class="n">y_pred</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]])</span>
<span class="n">y_true</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
<span class="n">tn</span><span class="p">,</span> <span class="n">fp</span><span class="p">,</span> <span class="n">fn</span><span class="p">,</span> <span class="n">tp</span><span class="p">,</span> <span class="n">support</span> <span class="o">=</span> <span class="n">metrics</span><span class="o">.</span><span class="n">get_multilabel_statistics</span><span class="p">(</span><span class="n">y_pred</span><span class="p">,</span> <span class="n">y_true</span><span class="p">)</span>
<span class="c1"># (</span>
<span class="c1">#     tensor([2., 2., 2.]),</span>
<span class="c1">#     tensor([0., 0., 0.]),</span>
<span class="c1">#     tensor([0., 0., 0.]),</span>
<span class="c1">#     tensor([1., 1., 1.]),</span>
<span class="c1">#     tensor([1., 1., 1.]),</span>
<span class="c1"># )</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">torch</span>
<span class="kn">from</span> <span class="nn">catalyst</span> <span class="kn">import</span> <span class="n">metrics</span>
<span class="n">y_pred</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]])</span>
<span class="n">y_true</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">functional</span><span class="o">.</span><span class="n">one_hot</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]))</span>
<span class="n">tn</span><span class="p">,</span> <span class="n">fp</span><span class="p">,</span> <span class="n">fn</span><span class="p">,</span> <span class="n">tp</span><span class="p">,</span> <span class="n">support</span> <span class="o">=</span> <span class="n">metrics</span><span class="o">.</span><span class="n">get_multilabel_statistics</span><span class="p">(</span><span class="n">y_pred</span><span class="p">,</span> <span class="n">y_true</span><span class="p">)</span>
<span class="c1"># (</span>
<span class="c1">#     tensor([2., 2., 2.]),</span>
<span class="c1">#     tensor([0., 0., 0.]),</span>
<span class="c1">#     tensor([0., 0., 0.]),</span>
<span class="c1">#     tensor([1., 1., 1.]),</span>
<span class="c1">#     tensor([1., 1., 1.]),</span>
<span class="c1"># )</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="catalyst.metrics.functional._misc.get_default_topk_args">
<code class="sig-prename descclassname">catalyst.metrics.functional._misc.</code><code class="sig-name descname">get_default_topk_args</code><span class="sig-paren">(</span><em class="sig-param">num_classes: int</em><span class="sig-paren">)</span> &#x2192; Sequence[int]<a class="reference internal" href="../_modules/catalyst/metrics/functional/_misc.html#get_default_topk_args"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#catalyst.metrics.functional._misc.get_default_topk_args" title="Permalink to this definition">¶</a></dt>
<dd><p>Calculate list params for <code class="docutils literal notranslate"><span class="pre">Accuracy&#64;k</span></code>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>num_classes</strong> – number of classes</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>array of accuracy arguments</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>iterable</p>
</dd>
</dl>
<p class="rubric">Examples</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">get_default_topk_args</span><span class="p">(</span><span class="n">num_classes</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
<span class="go">[1, 3]</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">get_default_topk_args</span><span class="p">(</span><span class="n">num_classes</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>
<span class="go">[1, 3, 5]</span>
</pre></div>
</div>
</dd></dl>

</section>
</section>
</section>


             </article>
             
            </div>
            <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="runners.html" class="btn btn-neutral float-right" title="Runners" accesskey="n" rel="next">Next <img src="../_static/images/chevron-right-orange.svg" class="next-page"></a>
      
      
        <a href="loggers.html" class="btn btn-neutral" title="Loggers" accesskey="p" rel="prev"><img src="../_static/images/chevron-right-orange.svg" class="previous-page"> Previous</a>
      
    </div>
  

  <hr>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2021, Scitator.

    </p>
  </div>
    
      <div>
        Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
      </div>
     

</footer>

          </div>
        </div>

        <div class="catalyst-content-right" id="catalyst-content-right">
          <div class="catalyst-right-menu" id="catalyst-right-menu">
            <div class="catalyst-side-scroll" id="catalyst-side-scroll-right">
              <ul>
<li><a class="reference internal" href="#">Metrics</a><ul>
<li><a class="reference internal" href="#metric-interfaces">Metric Interfaces</a><ul>
<li><a class="reference internal" href="#imetric">IMetric</a></li>
<li><a class="reference internal" href="#icallbackbatchmetric">ICallbackBatchMetric</a></li>
<li><a class="reference internal" href="#icallbackloadermetric">ICallbackLoaderMetric</a></li>
</ul>
</li>
<li><a class="reference internal" href="#metric-sub-interfaces">Metric Sub-Interfaces</a><ul>
<li><a class="reference internal" href="#accumulativemetric">AccumulativeMetric</a></li>
<li><a class="reference internal" href="#additivemetric">AdditiveMetric</a></li>
<li><a class="reference internal" href="#functionalbatchmetric">FunctionalBatchMetric</a></li>
<li><a class="reference internal" href="#functionalloadermetric">FunctionalLoaderMetric</a></li>
<li><a class="reference internal" href="#regionbasedmetric">RegionBasedMetric</a></li>
<li><a class="reference internal" href="#topkmetric">TopKMetric</a></li>
</ul>
</li>
<li><a class="reference internal" href="#metric-api">Metric API</a><ul>
<li><a class="reference internal" href="#accuracymetric">AccuracyMetric</a></li>
<li><a class="reference internal" href="#aucmetric">AUCMetric</a></li>
<li><a class="reference internal" href="#binaryprecisionrecallf1metric">BinaryPrecisionRecallF1Metric</a></li>
<li><a class="reference internal" href="#confusionmatrixmetric">ConfusionMatrixMetric</a></li>
<li><a class="reference internal" href="#cmcmetric">CMCMetric</a></li>
<li><a class="reference internal" href="#dicemetric">DiceMetric</a></li>
<li><a class="reference internal" href="#hitratemetric">HitrateMetric</a></li>
<li><a class="reference internal" href="#ioumetric">IOUMetric</a></li>
<li><a class="reference internal" href="#mapmetric">MAPMetric</a></li>
<li><a class="reference internal" href="#multiclassprecisionrecallf1supportmetric">MulticlassPrecisionRecallF1SupportMetric</a></li>
<li><a class="reference internal" href="#multilabelaccuracymetric">MultilabelAccuracyMetric</a></li>
<li><a class="reference internal" href="#multilabelprecisionrecallf1supportmetric">MultilabelPrecisionRecallF1SupportMetric</a></li>
<li><a class="reference internal" href="#mrrmetric">MRRMetric</a></li>
<li><a class="reference internal" href="#ndcgmetric">NDCGMetric</a></li>
<li><a class="reference internal" href="#r2squared">R2Squared</a></li>
<li><a class="reference internal" href="#reidcmcmetric">ReidCMCMetric</a></li>
<li><a class="reference internal" href="#trevskymetric">TrevskyMetric</a></li>
</ul>
</li>
<li><a class="reference internal" href="#functional-api">Functional API</a><ul>
<li><a class="reference internal" href="#module-catalyst.metrics.functional._accuracy">Accuracy</a></li>
<li><a class="reference internal" href="#module-catalyst.metrics.functional._auc">AUC</a></li>
<li><a class="reference internal" href="#module-catalyst.metrics.functional._average_precision">Average Precision</a></li>
<li><a class="reference internal" href="#module-catalyst.metrics.functional._classification">Classification</a></li>
<li><a class="reference internal" href="#module-catalyst.metrics.functional._cmc_score">CMC Score</a></li>
<li><a class="reference internal" href="#module-catalyst.metrics.functional._f1_score">F1 score</a></li>
<li><a class="reference internal" href="#module-catalyst.metrics.functional._focal">Focal</a></li>
<li><a class="reference internal" href="#module-catalyst.metrics.functional._hitrate">Hitrate</a></li>
<li><a class="reference internal" href="#module-catalyst.metrics.functional._mrr">MRR</a></li>
<li><a class="reference internal" href="#module-catalyst.metrics.functional._ndcg">NDCG</a></li>
<li><a class="reference internal" href="#module-catalyst.metrics.functional._precision">Precision</a></li>
<li><a class="reference internal" href="#id13">R2Squared</a></li>
<li><a class="reference internal" href="#module-catalyst.metrics.functional._recall">Recall</a></li>
<li><a class="reference internal" href="#module-catalyst.metrics.functional._segmentation">Segmentation</a></li>
<li><a class="reference internal" href="#module-catalyst.metrics.functional._misc">Misc</a></li>
</ul>
</li>
</ul>
</li>
</ul>

            </div>
          </div>
        </div>
      </section>
    </div>

  


  

     
       <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
         <script type="text/javascript" src="../_static/jquery.js"></script>
         <script type="text/javascript" src="../_static/underscore.js"></script>
         <script type="text/javascript" src="../_static/doctools.js"></script>
         <script type="text/javascript" src="../_static/language_data.js"></script>
         <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
     

  

  <script type="text/javascript" src="../_static/js/vendor/popper.min.js"></script>
  <script type="text/javascript" src="../_static/js/vendor/bootstrap.min.js"></script>
  <script type="text/javascript" src="../_static/js/theme.js"></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

  <!-- Begin Footer -->

  <footer class="site-footer" id="site-footer">
    <div class="container footer-container">
      <div class="footer-logo-wrapper">
        <a href="https://catalyst-team.com/" class="footer-logo"></a>
      </div>

      <div class="footer-links-wrapper">
        <div class="footer-links-col">
          <ul>
            <li class="list-title"><a href="https://github.com/catalyst-team/catalyst#step-by-step-guide">Getting started</a></li>
            <li><a class="nav-dropdown-item" href="https://catalyst-team.github.io/catalyst/getting_started/quickstart.html">Quickstart</a></li>
            <li><a class="nav-dropdown-item" href="https://github.com/catalyst-team/catalyst#minimal-examples">Examples</a></li>
            <li><a class="nav-dropdown-item" href="https://medium.com/pytorch/catalyst-a-pytorch-framework-for-accelerated-deep-learning-r-d-ad9621e4ca88?source=friends_link&sk=885b4409aecab505db0a63b06f19dcef">Blogpost</a></li>
          </ul>
        </div>

        <div class="footer-links-col">
          <ul>
            <li class="list-title"><a href="https://catalyst-team.com/#projects">Projects</a></li>
            <li><a class="nav-dropdown-item" href="https://github.com/catalyst-team/catalyst">Catalyst</a></li>
            <li><a class="nav-dropdown-item" href="https://github.com/catalyst-team/codestyle">Codestyle</a></li>
            <li><a class="nav-dropdown-item" href="https://github.com/catalyst-team/dl-course">Course</a></li>
          </ul>
        </div>

        <div class="footer-links-col">
          <ul>
            <li class="list-title"><a href="https://catalyst-team.com/">Support</a></li>
            <li><a href="https://github.com/catalyst-team/catalyst#acknowledgments" target="_blank">Acknowledgments</a></li>
            <li><a href="https://github.com/catalyst-team/catalyst/blob/master/CONTRIBUTING.md" target="_blank">Contributing</a></li>
            <li><a href="https://opencollective.com/catalyst" target="_blank">Open Collective</a></li>
            <li><a href="https://www.patreon.com/catalyst_team" target="_blank">Patreon</a></li>
          </ul>
        </div>

        <div class="footer-links-col follow-us-col">
          <div class="footer-social-icons">
            <a href="https://t.me/catalyst_team" target="_blank" class="telegram"></a>
            <a href="https://twitter.com/CatalystTeam" target="_blank" class="twitter"></a>
            <a href="https://join.slack.com/t/catalyst-team-devs/shared_invite/zt-d9miirnn-z86oKDzFMKlMG4fgFdZafw" target="_blank" class="ods"></a>
          </div>
        </div>
      </div>
    </div>
  </footer>


  <!-- End Footer -->

  <!-- Begin Mobile Menu -->

  <div class="mobile-main-menu">
    <div class="container-fluid">
      <div class="container">
        <div class="mobile-main-menu-header-container">
          <a class="header-logo" href="https://catalyst-team.com/" aria-label="Catalyst"></a>
          <a class="main-menu-close-button" href="#" data-behavior="close-mobile-menu"></a>
        </div>
      </div>
    </div>

    <div class="mobile-main-menu-links-container">
      <div class="main-menu">
        <ul>
          <li>
            <a href="">Get Started</a>
          </li>

          <li>
            <a href="https://github.com/catalyst-team/catalyst">Github</a>
          </li>
        </ul>
      </div>
    </div>
  </div>

  <!-- End Mobile Menu -->

  <script type="text/javascript" src="../_static/js/vendor/anchor.min.js"></script>

  <script type="text/javascript">
    $(document).ready(function() {
      mobileMenu.bind();
      mobileTOC.bind();
      catalystAnchors.bind();
      sideMenus.bind();
      scrollToAnchor.bind();
      highlightNavigation.bind();
      mainMenuDropdown.bind();

      // Add class to links that have code blocks, since we cannot create links in code blocks
      $("article.catalyst-article a span.pre").each(function(e) {
        $(this).closest("a").addClass("has-code");
      });
    })
  </script>
</body>
</html>